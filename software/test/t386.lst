Sections:
00: ".pgtbl" (0-A)
01: ".bss" (0-A)
02: ".data" (0-A)
03: ".rodata" (0-6)
04: ".text" (0-1845)


Source: "t386.asm"
                      	     1: # t386.asm rf386 cpu test
                      	     2: # Port to vasm standard syntax including mods.
                      	     3: # (c) 2024 Robert Finch <robfinch@finitron.ca>
                      	     4: #
                      	     5: # Original work from test386.asm
                      	     6: #   Copyright (C) 2012-2015 Jeff Parsons <Jeff@pcjs.org>
                      	     7: #   Copyright (C) 2017-2021 Marco Bortolin <barotto@gmail.com>
                      	     8: #
                      	     9: #   This file is a derivative work of PCjs
                      	    10: #   https://www.pcjs.org/software/pcx86/test/cpu/80386/test386.asm
                      	    11: #
                      	    12: #   test386.asm is free software: you can redistribute it and/or modify it under
                      	    13: #   the terms of the GNU General Public License as published by the Free
                      	    14: #   Software Foundation, either version 3 of the License, or (at your option)
                      	    15: #   any later version.
                      	    16: #
                      	    17: #   test386.asm is distributed in the hope that it will be useful, but WITHOUT ANY
                      	    18: #   WARRANTY without even the implied warranty of MERCHANTABILITY or FITNESS
                      	    19: #   FOR A PARTICULAR PURPOSE.  See the GNU General Public License for more
                      	    20: #   details.
                      	    21: #
                      	    22: #   You should have received a copy of the GNU General Public License along with
                      	    23: #   test386.asm.  If not see <http://www.gnu.org/licenses/gpl.html>.
                      	    24: #
                      	    25: #   This program was originally developed for IBMulator
                      	    26: #   https://barotto.github.io/IBMulator
                      	    27: #
                      	    28: #   Overview
                      	    29: #   --------
                      	    30: #   This file is designed to run as a test ROM, loaded in place of the BIOS.
                      	    31: #   Its pourpose is to test the CPU, reporting its status to the POST port and
                      	    32: #   its computational results in ASCII form to various configurable ports.
                      	    33: #   A 80386 or later CPU is required. This ROM is designed to test an emulator
                      	    34: #   CPU and was never tested on real hardware.
                      	    35: #
                      	    36: #   It must be installed at physical address 0xffff0000 and aliased at physical
                      	    37: #   address 0xffff0000.  The jump at resetVector should align with the CPU reset
                      	    38: #   address 0xfffffff0, which will transfer control to f000:0045.  From that
                      	    39: #   point on, all memory accesses should remain within the first 1MB.
                      	    40: #
                      	    41: 
                      	    42: #
                      	    43: # WARNING
                      	    44: #
                      	    45: #   A word of caution before you start developing.
                      	    46: #   NASM (2.11.08) generates [ebp + ebp] for [ebp*2] (i.e. no base register),
                      	    47: #   which are not the same thing: [ebp+ebp] references the SS segment, [ebp*2]
                      	    48: #   references the DS segment.
                      	    49: #   NASM developers think [ebp*2] and [ebp+ebp] are the same, but that is true
                      	    50: #   only assuming a flat memory model. Until the time NASM authors realize their
                      	    51: #   mistake (any assumption of a flat memory model should be optional), you can
                      	    52: #   disable this behaviour by writing: [nosplit ebp*2].
                      	    53: #
                      	    54: #	NASM Assembly            Translated               Assembled
                      	    55: #	mov eax,[ebp*2]          mov eax,[ebp+ebp*1+0x0]  8B442D00
                      	    56: #	mov eax,[nosplit ebp*2]  mov eax,[ebp*2+0x0]      8B046D00000000
                      	    57: #
                      	    58: 
                      	    59: .macro cpyright
                      	    60: 	.ascii "t386.asm (c) 2024 Robert Finch (C) 2012-2015 Jeff Parsons, (C) 2017-2021 Marco Bortolin ",0
                      	    61: .endm
                      	    62: .macro RELEASE
                      	    63: 	.ascii "??/??/24",0
                      	    64: .endm
                      	    65: 
                      	    66: 	.set POST_PORT,0x190
                      	    67: 
                      	    68: #
                      	    69: # memory map:
                      	    70: #  FFF80000-FFF8FFFF page table
                      	    71: #  FFF90000-FFF903FF real mode IDT
                      	    72: #  FFF90400-FFF904FF protected mode IDT
                      	    73: #  FFF90500-FFF9077F protected mode GDT
                      	    74: #  FFF90800-FFF90FFF protected mode LDT
                      	    75: #  FFFA0000-FFFAFFFF read only data
                      	    76: #  FFFC0000-FFFCFFFF stack
                      	    77: #  FFF01000-FFF01FFF page directory
                      	    78: #  FFF94000-FFF94FFF TSS
                      	    79: #  20000-9FFFF tests
                      	    80: #
                      	    81: 
                      	    82: .set realmd_mask,0x0000ffff
                      	    83: .set rodata_seg,0x0fffa000
                      	    84: .set start_rodata,0xfffa0000
                      	    85: .set TEST_BASE,0xFFFC0000
                      	    86: .set TEST_BASE1,TEST_BASE+0x0000
                      	    87: .set TEST_BASE2,TEST_BASE+0x2000
                      	    88: 
                      	    89: 	.section .pgtbl
00:00000000 00        	    90: 	.space 10
00:00000001 *
                      	    91: 
                      	    92: 	.bss
01:00000000 00        	    93: 	.space	10
01:00000001 *
                      	    94: 
                      	    95: 	.data
02:00000000 00        	    96: 	.space	10
02:00000001 *
                      	    97: 
                      	    98: 	.rodata
                      	    99: idt_addr:
03:00000000 0004      	   100: 	.2byte 0x400
03:00000002 0000F9FF  	   101: 	.4byte 0xFFF90000		# Linear address of table
                      	   102: 
                      	   103: #	.org	0xF0000
                      	   104: 	.text
                      	   105: 	.code16
                      	   106: #	.align	0
                      	   107: .extern	_bootrom
                      	   108: .extern _Fibonacci
                      	   109: 
                      	   110: #
                      	   111: #   Real mode segments
                      	   112: #
                      	   113: .set C_SEG_REAL,0x0000
                      	   114: .set S_SEG_REAL,0xC000
                      	   115: .set IDT_SEG_REAL,0x9000
                      	   116: .set IDT_SEG_PROT,0x9040
                      	   117: .set GDT_SEG_REAL,0x9050
                      	   118: .set GDT_SEG_LIMIT,0x2FF
                      	   119: .set D1_SEG_REAL,TEST_BASE1 >> 4
                      	   120: .set D2_SEG_REAL,TEST_BASE2 >> 4
                      	   121: 
                      	   122: .set ESP_REAL,0x7ffc
                      	   123: 
                      	   124: 
                      	   125: .include "x86_e.asm"

Source: "x86_e.asm"
                      	     1: .set PS_CF,0x0001
                      	     2: .set PS_PF,0x0004
                      	     3: .set PS_AF,0x0010
                      	     4: .set PS_ZF,0x0040
                      	     5: .set PS_SF,0x0080
                      	     6: .set PS_TF,0x0100
                      	     7: .set PS_IF,0x0200
                      	     8: .set PS_DF,0x0400
                      	     9: .set PS_OF,0x0800
                      	    10: .set PS_ARITH,(PS_CF | PS_PF | PS_AF | PS_ZF | PS_SF | PS_OF)
                      	    11: .set PS_LOGIC,(PS_CF | PS_PF | PS_ZF | PS_SF | PS_OF)
                      	    12: .set PS_MULTIPLY,(PS_CF | PS_OF) # only CF and OF are "defined" following MUL or IMUL
                      	    13: .set PS_DIVIDE,0 # none of the Processor Status flags are "defined" following DIV or IDIV
                      	    14: .set PS_SHIFTS_1,(PS_CF | PS_SF | PS_ZF | PS_PF | PS_OF)
                      	    15: .set PS_SHIFTS_R,(PS_CF | PS_SF | PS_ZF | PS_PF)
                      	    16: 
                      	    17: .set CR0_MSW_PE,0x0001
                      	    18: .set CR0_PG,0x80000000	# set if paging enabled
                      	    19: 
                      	    20: .set ACC_TYPE_GATE386_INT,0x0E00
                      	    21: .set ACC_TYPE_GATE386_CALL,0x0C00
                      	    22: .set ACC_TYPE_SEG,0x1000
                      	    23: .set ACC_PRESENT,0x8000
                      	    24: .set ACC_TYPE_CODE_R,0x1a00
                      	    25: .set ACC_TYPE_CONFORMING,0x0400
                      	    26: .set ACC_TYPE_DATA_R,0x1000
                      	    27: .set ACC_TYPE_DATA_W,0x1200
                      	    28: .set ACC_TYPE_LDT,0x0200
                      	    29: .set ACC_TYPE_TSS,0x0900
                      	    30: 
                      	    31: .set ACC_DPL_0,0x0000
                      	    32: .set ACC_DPL_1,0x2000
                      	    33: .set ACC_DPL_2,0x4000
                      	    34: .set ACC_DPL_3,0x6000
                      	    35: 
                      	    36: .set EXT_NONE,0x0000
                      	    37: .set EXT_16BIT,EXT_NONE
                      	    38: .set EXT_32BIT,0x0040 # size bit
                      	    39: .set EXT_PAGE,0x0080 # granularity bit
                      	    40: 
                      	    41: #PTE_FRAME     equ 0xfffff000
                      	    42: #PTE_DIRTY     equ 0x00000040 ; page has been modified
                      	    43: #PTE_ACCESSED  equ 0x00000020 ; page has been accessed
                      	    44: #PTE_USER      equ 0x00000004 ; set for user level (CPL 3), clear for supervisor level (CPL 0-2)
                      	    45: #PTE_WRITE     equ 0x00000002 ; set for read/write, clear for read-only (affects CPL 3 only)
                      	    46: #PTE_PRESENT   equ 0x00000001 ; set for present page, clear for not-present page
                      	    47: 
                      	    48: #PTE_PRESENT_BIT   equ 0000001b
                      	    49: #PTE_WRITE_BIT     equ 0000010b
                      	    50: #PTE_USER_BIT      equ 0000100b
                      	    51: #PTE_ACCESSED_BIT  equ 0100000b
                      	    52: #PTE_DIRTY_BIT     equ 1000000b
                      	    53: 
                      	    54: .set EX_DE,0
                      	    55: .set EX_DB,1
                      	    56: .set EX_BP,3
                      	    57: .set EX_OF,4
                      	    58: .set EX_BR,5
                      	    59: .set EX_UD,6
                      	    60: .set EX_NM,7
                      	    61: .set EX_DF,8
                      	    62: .set EX_MP,9
                      	    63: .set EX_TS,10
                      	    64: .set EX_NP,11
                      	    65: .set EX_SS,12
                      	    66: .set EX_GP,13
                      	    67: .set EX_PF,14
                      	    68: .set EX_MF,15
                      	    69: 

Source: "t386.asm"
                      	   126: .include "macros_m.asm"

Source: "macros_m.asm"
                      	     1: #
                      	     2: #   Output a byte to the POST port, destroys al and dx
                      	     3: #
                      	     4: .macro POST arg1
                      	     5: 	movb \arg1,%al
                      	     6: 	movw $POST_PORT,%dx
                      	     7: 	out %al,%dx
                      	     8: .endm
                      	     9: 
                      	    10: #
                      	    11: # Initializes an interrupt gate in system memory.
                      	    12: # This is the body of procedures used in 16 and 32-bit code segments.
                      	    13: #
                      	    14: #    7                             0 7                             0
                      	    15: #   â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•¤â•â•â•â•â•â
                      	    16: # +7â•‘                          OFFSET 31-16                         â•‘+6
                      	    17: #   â•Ÿâ”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â
                      	    18: # +5â•‘ P â”‚  DPL  â”‚ 0 â”‚ 1   1   1   0 â”‚            UNUSED             â•‘+4
                      	    19: #   â•Ÿâ”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”€â”€â
                      	    20: # +3â•‘                           SELECTOR                            â•‘+2
                      	    21: #   â•Ÿâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â
                      	    22: # +1â•‘                          OFFSET 15-0                          â•‘ 0
                      	    23: #   â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•§â•â•â•â•â•â
                      	    24: #    15                                                            0
                      	    25: #
                      	    26: # DS:EBX pointer to IDT
                      	    27: # EAX vector
                      	    28: # ESI selector
                      	    29: # EDI offset
                      	    30: # DX DPL (use ACC_DPL_* equs)
                      	    31: #
                      	    32: .macro initIntGate
                      	    33: 	shl $3,%eax
                      	    34: 	add	%eax,%ebx
                      	    35: 	movw %di,(%ebx)
                      	    36: 	movw %si,2(%ebx)
                      	    37: 	orw $ACC_TYPE_GATE386_INT | ACC_PRESENT, %dx
                      	    38: 	movw %dx,4(%ebx)
                      	    39: 	shr $16,%edi
                      	    40: 	movw %di,6(%ebx)
                      	    41: .endm
                      	    42: 
                      	    43: #
                      	    44: # Set a descriptor in system memory.
                      	    45: # This is the body of procedures used in 16 and 32-bit code segments.
                      	    46: #
                      	    47: #    7                             0 7                             0
                      	    48: #   â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•¤â•â•â•â•¤â•â
                      	    49: # +7â•‘            BASE 31-24         â”‚ G â”‚B/Dâ”‚ 0 â”‚AVLâ”‚  LIMIT 19-16  â•‘+6
                      	    50: #   â•Ÿâ”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”¼â”€â”€â”€â”´â”€â
                      	    51: # +5â•‘ P â”‚  DPL  â”‚ S â”‚    TYPE    (A)â”‚          BASE 23-16           â•‘+4
                      	    52: #   â•Ÿâ”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”€â”€â
                      	    53: # +3â•‘                           BASE 15-0                           â•‘+2
                      	    54: #   â•Ÿâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â
                      	    55: # +1â•‘                           LIMIT 15-0                          â•‘ 0
                      	    56: #   â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•§â•â•â•â•â•â
                      	    57: #    15                                                            0
                      	    58: #
                      	    59: # DS:EBX pointer to the descriptor table
                      	    60: # EAX segment selector
                      	    61: # ESI base
                      	    62: # EDI limit
                      	    63: # DL ext nibble (upper 4 bits)
                      	    64: # DH acc byte (P|DPL|S|TYPE|A)
                      	    65: #
                      	    66: .macro initDescriptor
                      	    67: 	and $0xFFF8,%eax
                      	    68: 	add %eax,%ebx
                      	    69: 	movw %di,(%ebx)						# LIMIT 15-0
                      	    70: 	movw %si,2(%ebx)					# BASE 15-0
                      	    71: 	shr $16,%esi
                      	    72: 	mov %si,%ax								# AX := BASE 31-16
                      	    73: 	movb %al,4(%ebx)					# BASE 23-16
                      	    74: 	movb %dh,5(%ebx)					# acc byte
                      	    75: 	shr $16,%edi
                      	    76: 	mov %di,%cx
                      	    77: 	and $0x0f,%cl
                      	    78: 	movb %cl,6(%ebx)					# LIMIT 19-16
                      	    79: 	and $0xf0,%dl
                      	    80: 	orb %dl,6(%ebx)						# ext nybble
                      	    81: 	movb %ah,7(%ebx)					# BASE 31-24
                      	    82: .endm
                      	    83: 
                      	    84: 
                      	    85: .macro advTestBase
                      	    86: 	.set TEST_BASE1,TEST_BASE1+0x1000
                      	    87: 	.set TEST_BASE2,TEST_BASE2+0x1000
                      	    88: .endm
                      	    89: 

Source: "t386.asm"
                      	   127: .include "shift_m.asm"

Source: "shift_m.asm"
                      	     1: #
                      	     2: #   Executes a byte shift operation and checks the resulting flags.
                      	     3: #
                      	     4: #   %1 operation
                      	     5: #   %2 al: byte operand
                      	     6: #   %3 cl: shift count
                      	     7: #   %4 flags: value of flags before %1 execution
                      	     8: #   %5 flags: expected value of flags after %1 execution (cmp with PS_ARITH mask)
                      	     9: #
                      	    10: #   Uses: AX, CL, Flags
                      	    11: #
                      	    12: 
                      	    13: .macro testShiftBFlags arg1,arg2,arg3,arg4,arg5
                      	    14: 	mov \arg4,%ax
                      	    15: 	push %ax
                      	    16: 	popf
                      	    17: 	mov $0xff,%ah
                      	    18: 	mov \arg2,%al
                      	    19: 	mov \arg3,%cl
                      	    20: 	\arg1 %cl,%al
                      	    21: 	pushf
                      	    22: 	pop %ax
                      	    23: 	and $PS_ARITH,%ax
                      	    24: 	cmp \arg5,%ax
                      	    25: 	jne error
                      	    26: .endm
                      	    27: 
                      	    28: #
                      	    29: #   Executes a word shift operation and checks the resulting flags.
                      	    30: #
                      	    31: #   %1 operation
                      	    32: #   %2 ax: word operand
                      	    33: #   %3 cl: shift count
                      	    34: #   %4 flags: value of flags before %1 execution
                      	    35: #   %5 flags: expected value of flags after %1 execution (cmp with PS_ARITH mask)
                      	    36: #
                      	    37: #   Uses: AX, CL, Flags
                      	    38: #
                      	    39: .macro testShiftWFlags arg1,arg2,arg3,arg4,arg5
                      	    40: 	mov \arg4,%ax
                      	    41: 	push %ax
                      	    42: 	popf
                      	    43: 	mov \arg2,%ax
                      	    44: 	mov \arg3,%cl
                      	    45: 	\arg1 %cl,%ax
                      	    46: 	pushf
                      	    47: 	pop %ax
                      	    48: 	and $PS_ARITH,%ax
                      	    49: 	cmp \arg5,%ax
                      	    50: 	jne error
                      	    51: .endm
                      	    52: 

Source: "t386.asm"
                      	   128: 
                      	   129: _start:
04:00000000 EB59      	   130: 	jmp _start1
                      	   131: header:
                      	   132: 	cpyright
04:00000002 743338362E	     1M 	.ascii "t386.asm (c) 2024 Robert Finch (C) 2012-2015 Jeff Parsons, (C) 2017-2021 Marco Bortolin ",0
04:00000007 61736D2028
04:0000000C 6329203230
04:00000011 323420526F
04:00000016 6265727420
04:0000001B 46696E6368
04:00000020 2028432920
04:00000025 323031322D
04:0000002A 3230313520
04:0000002F 4A65666620
04:00000034 506172736F
04:00000039 6E732C2028
04:0000003E 4329203230
04:00000043 31372D3230
04:00000048 3231204D61
04:0000004D 72636F2042
04:00000052 6F72746F6C
04:00000057 696E20
04:0000005A 00
                      	   133: 
                      	   134: _start1:
04:0000005B FA        	   135: 	cli	
                      	   136: # init IDT
                      	   137: #	mov $17,%cx
                      	   138: #	movl $error,%edx
                      	   139: #	movl $0xfff90000,%eax
                      	   140: #	movl $error,%edx
                      	   141: #.aloop:
                      	   142: #	movw %dx,(%eax)
                      	   143: #	movw $0xf000,2(%eax)
                      	   144: ##	movw $error,(,%eax,4)
                      	   145: ##	movw $0xf000,2(,%eax,4)
                      	   146: #	addl $4,%eax
                      	   147: #	loop .aloop
                      	   148: 
                      	   149: #	mov $ESP_REAL,%esp
                      	   150: 
                      	   151: # ==============================================================================
                      	   152: #	Real mode tests
                      	   153: # ==============================================================================
                      	   154: 
                      	   155: .include "real_m.asm"

Source: "real_m.asm"
                      	     1: #
                      	     2: # Advances the base address of data segments used by tests, D1_SEG_REAL and
                      	     3: # D2_SEG_REAL.
                      	     4: #
                      	     5: # Loads DS with D1_SEG_REAL and ES with D2_SEG_REAL.
                      	     6: #
                      	     7: .macro advTestSegReal
                      	     8: 	advTestBase
                      	     9: 	.set D1_SEG_REAL,TEST_BASE1 >> 4
                      	    10: 	.set D2_SEG_REAL,TEST_BASE2 >> 4
                      	    11: 	mov $D1_SEG_REAL,%dx
                      	    12: 	mov %dx,%ds
                      	    13: 	mov $D2_SEG_REAL,%dx
                      	    14: 	mov %dx,%es
                      	    15: .endm
                      	    16: 
                      	    17: #
                      	    18: # Initializes the real mode IDT with C_SEG_REAL:error
                      	    19: # This code is called in real mode.
                      	    20: #
                      	    21: .macro initRealModeIDT
                      	    22: 	mov $IDT_SEG_REAL,%ax
                      	    23: 	mov %ax,%ds
                      	    24: 	xor %di,%di
                      	    25: 	mov $17,%cx
                      	    26: aloop\@:
                      	    27: 	movw $error,(%di)
                      	    28: 	movw $C_SEG_REAL,2(%di)
                      	    29: 	add $4,%di
                      	    30: 	loop aloop\@
                      	    31: .endm
                      	    32: 
                      	    33: 
                      	    34: #
                      	    35: # Exception handling testing in real mode
                      	    36: #
                      	    37: 
                      	    38: # Initialises an exc handler
                      	    39: # %1: vector
                      	    40: # %2: handler IP
                      	    41: # Trashes AX,DS
                      	    42: 
                      	    43: .macro realModeExcInit arg1,arg2
                      	    44: 	mov $IDT_SEG_REAL,%ax
                      	    45: 	mov %ax,%ds
                      	    46: 	movw $\arg2,\arg1*4
                      	    47: 	movw $C_SEG_REAL,\arg1*4+2
                      	    48: .endm
                      	    49: 
                      	    50: # Checks exc result and restores the default handler
                      	    51: # %1: vector
                      	    52: # %2: expected pushed value of IP
                      	    53: # Trashes AX,DS
                      	    54: 
                      	    55: .macro realModeExcCheck arg1,arg2
                      	    56: 	cmp $ESP_REAL-6,%sp
                      	    57: 	jne error
                      	    58: 	cmpw $C_SEG_REAL,%ss:ESP_REAL-4
                      	    59: 	cmpw $\arg2,%ss:ESP_REAL-6
                      	    60: 	jne error
                      	    61: 	mov $0,%ax
                      	    62: 	mov %ax,%ds
                      	    63: 	movw $error,\arg1*4
                      	    64: 	movw $C_SEG_REAL,\arg1*4+2
                      	    65: .endm
                      	    66: 
                      	    67: 
                      	    68: # Tests a fault
                      	    69: # %1: vector
                      	    70: # %2: instruction to execute that causes a fault
                      	    71: 
                      	    72: .macro realModeFaultTest arg1,arg2,arg3
                      	    73: 	realModeExcInit \arg1,continue\@
                      	    74: 	mov $S_SEG_REAL,%ax
                      	    75: 	mov %ax,%ss
                      	    76: 	mov $ESP_REAL,%sp
                      	    77: test\@:
                      	    78: 	\arg2,%\arg3
                      	    79: 	jmp error
                      	    80: continue\@:
                      	    81: 	realModeExcCheck \arg1,test\@
                      	    82: .endm
                      	    83: 

Source: "t386.asm"
                      	   156: #-------------------------------------------------------------------------------
                      	   157: 	POST $0x00
04:0000005C B000      	     1M 	movb $0x00,%al
04:0000005E BA9001    	     2M 	movw $POST_PORT,%dx
04:00000061 EE        	     3M 	out %al,%dx
                      	   158: #-------------------------------------------------------------------------------
                      	   159: #
                      	   160: #   Real mode initialisation
                      	   161: #
04:00000062 B800A0    	   162: 	mov $rodata_seg & realmd_mask,%ax
04:00000065 8ED8      	   163: 	mov %ax,%ds
04:00000067 0F011E0000	   164: 	lidt idt_addr-start_rodata
                      	   165: 	initRealModeIDT
04:0000006C B80090    	     1M 	mov $IDT_SEG_REAL,%ax
04:0000006F 8ED8      	     2M 	mov %ax,%ds
04:00000071 31FF      	     3M 	xor %di,%di
04:00000073 B91100    	     4M 	mov $17,%cx
                      	     5M aloop7:
04:00000076 C7052A18  	     6M 	movw $error,(%di)
04:0000007A C745020000	     7M 	movw $C_SEG_REAL,2(%di)
04:0000007F 83C704    	     8M 	add $4,%di
04:00000082 E2F2      	     9M 	loop aloop7
04:00000084 B800C0    	   166: 	mov $S_SEG_REAL,%ax
04:00000087 8ED0      	   167: 	mov %ax,%ss
04:00000089 BCFC7F    	   168: 	mov $ESP_REAL,%sp
04:0000008C C7C200C0  	   169: 	mov $D1_SEG_REAL,%dx
04:00000090 8EDA      	   170: 	mov %dx,%ds
04:00000092 C7C200C2  	   171: 	mov $D2_SEG_REAL,%dx
04:00000096 8EC2      	   172: 	mov %dx,%es
                      	   173: 
                      	   174: #-------------------------------------------------------------------------------
                      	   175: 	POST $0x01
04:00000098 B001      	     1M 	movb $0x01,%al
04:0000009A BA9001    	     2M 	movw $POST_PORT,%dx
04:0000009D EE        	     3M 	out %al,%dx
                      	   176: #-------------------------------------------------------------------------------
                      	   177: #
                      	   178: #   Conditional jumps
                      	   179: #
                      	   180: .include "jcc_m.asm"

Source: "jcc_m.asm"
                      	     1: #
                      	     2: # Tests conditional relative jumps.
                      	     3: # Uses: AX, ECX, Flags
                      	     4: #
                      	     5: # Opcodes tested, with positive and negative offsets:
                      	     6: #
                      	     7: # rel8  rel16/32 mnemonic condition
                      	     8: # 70    0F80     JO       OF=1
                      	     9: # 71    0F81     JNO      OF=0
                      	    10: # 72    0F82     JC       CF=1
                      	    11: # 73    0F83     JNC      CF=0
                      	    12: # 74    0F84     JZ       ZF=1
                      	    13: # 75    0F85     JNZ      ZF=0
                      	    14: # 76    0F86     JBE      CF=1 || ZF=1
                      	    15: # 77    0F87     JA       CF=0 && ZF=0
                      	    16: # 78    0F88     JS       SF=1
                      	    17: # 79    0F89     JNS      SF=0
                      	    18: # 7A    0F8A     JP       PF=1
                      	    19: # 7B    0F8B     JNP      PF=0
                      	    20: # 7C    0F8C     JL       SF!=OF
                      	    21: # 7D    0F8D     JNL      SF=OF
                      	    22: # 7E    0F8E     JLE      ZF=1 || SF!=OF
                      	    23: # 7F    0F8F     JNLE     ZF=0 && SF=OF
                      	    24: # E3             JCXZ     CX=0
                      	    25: # E3             JECXZ    ECX=0
                      	    26: #
                      	    27: .macro testJcc arg1
                      	    28: 	mov $PS_CF,%ah
                      	    29: 	sahf         # dont use the stack (pushf/popf)
                      	    30: 	jnc err1\@ 	# 73 / 0F83   JNC  CF=0
                      	    31: 	jc jcok\@ 	# 72 / 0F82   JC   CF=1
                      	    32: 	hlt
                      	    33: jz\@:
                      	    34: 	mov $PS_ZF,%ah
                      	    35: 	sahf
                      	    36: 	jnz err1\@ 	# 75 / 0F85   JNZ  ZF=0
                      	    37: 	jz jzok\@ 	# 74 / 0F84   JZ   ZF=1
                      	    38: 	hlt
                      	    39: jp\@:
                      	    40: 	mov $PS_PF,%ah
                      	    41: 	sahf
                      	    42: 	jnp err1\@ 	# 7B / 0F8B   JNP  PF=0
                      	    43: 	jp jpok\@ 	# 7A / 0F8A   JP   PF=1
                      	    44: 	hlt
                      	    45: js\@:
                      	    46: 	mov $PS_SF,%ah
                      	    47: 	sahf
                      	    48: 	jns err1\@ 	# 79 / 0F89   JNS  SF=0
                      	    49: 	js jsok\@ 	# 78 / 0F88   JS   SF=1
                      	    50: 	hlt
                      	    51: jna\@:
                      	    52: 	mov $PS_ZF|PS_CF,%ah
                      	    53: 	sahf
                      	    54: 	ja err1\@  	# 77 / 0F87   JA   CF=0 && ZF=0
                      	    55: 	jna jnaok\@ # 76 / 0F86   JBE  CF=1 || ZF=1
                      	    56: next1\@:
                      	    57: 	jmp jnc\@
                      	    58: 
                      	    59: .if \arg1==16
                      	    60: 	.rept 128
                      	    61: 		hlt
                      	    62: 	.endr
                      	    63: .endif
                      	    64: 
                      	    65: err1\@:
                      	    66: 	hlt
                      	    67: 
                      	    68: # test negative offsets
                      	    69: jcok\@:   jc   jz\@
                      	    70: jzok\@:   jz   jp\@
                      	    71: jpok\@:   jp   js\@
                      	    72: jsok\@:   js   jna\@
                      	    73: jnaok\@:  jna  next1\@
                      	    74: 
                      	    75: 
                      	    76: jnc\@:
                      	    77: 	mov $PS_SF|PS_ZF|PS_AF|PS_PF,%ah
                      	    78: 	sahf
                      	    79: 	mov $0,%ax
                      	    80: 	sahf
                      	    81: 	jnc   jncok\@ # 73 / 0F83   JNC  CF=0
                      	    82: 	hlt
                      	    83: jnz\@:
                      	    84: 	mov $PS_SF|PS_AF|PS_PF|PS_CF,%ah
                      	    85: 	sahf
                      	    86: 	jnz   jnzok\@ # 75 / 0F85   JNZ  ZF=0
                      	    87: 	hlt
                      	    88: jnp\@:
                      	    89: 	mov $PS_SF|PS_ZF|PS_AF|PS_CF,%ah
                      	    90: 	sahf
                      	    91: 	jnp   jnpok\@ # 7B / 0F8B   JNP  PF=0
                      	    92: 	hlt
                      	    93: jns\@:
                      	    94: 	mov $PS_ZF|PS_AF|PS_PF|PS_CF,%ah
                      	    95: 	sahf
                      	    96: 	jns jnsok\@ # 79 /  0F89  JNS  SF=0
                      	    97: 	hlt
                      	    98: ja\@:
                      	    99: 	mov $PS_SF|PS_AF|PS_PF,%ah
                      	   100: 	sahf
                      	   101: 	ja    jaok\@  # 77 / 0F87   JA   CF=0 && ZF=0
                      	   102: 	hlt
                      	   103: next2\@:
                      	   104: 	jmp   jo\@
                      	   105: 
                      	   106: .if \arg1==16
                      	   107: 	.rept 128
                      	   108: 		hlt
                      	   109: 	.endr
                      	   110: .endif
                      	   111: 
                      	   112: # test negative offsets
                      	   113: jncok\@:  jnc  jnz\@
                      	   114: jnzok\@:  jnz  jnp\@
                      	   115: jnpok\@:  jnp  jns\@
                      	   116: jnsok\@:  jns  ja\@
                      	   117: jaok\@:   ja   next2\@
                      	   118: 
                      	   119: jo\@:
                      	   120: 	mov $0,%ah
                      	   121: 	sahf
                      	   122: 	mov $0b1000000,%al
                      	   123: 	shl $1,%al   	# OF = high-order bit of AL <> (CF), ZF=0,SF=1,OF=1
                      	   124: 	jno err2\@
                      	   125: 	jo jook\@
                      	   126: 	hlt
                      	   127: jnl\@:
                      	   128: 	jl err2\@   	# 7C / 0F8C   JL   SF!=OF
                      	   129: 	jnl jnlok\@  	# 7D / 0F8D   JNL  SF=OF
                      	   130: 	hlt
                      	   131: jnle\@:
                      	   132: 	jle err2\@   	# 7E / 0F8E   JLE  ZF=1 || SF!=OF
                      	   133: 	jnle jnleok\@ # 7F / 0F8F   JNLE ZF=0 && SF=OF
                      	   134: 	hlt
                      	   135: jl\@:
                      	   136: 	mov $PS_ZF,%ah
                      	   137: 	sahf          # ZF=1,SF=0,OF=1
                      	   138: 	jl jlok\@   	# 7C / 0F8C   JL   SF!=OF
                      	   139: 	hlt
                      	   140: jle\@:
                      	   141: 	jle jleok\@  	# 7E / 0F8E   JLE  ZF=1 || SF!=OF
                      	   142: 	hlt
                      	   143: jcxz\@:
                      	   144: .if \arg1==8
                      	   145: 	mov $1,%ecx
                      	   146: 	jcxz err2\@      	# E3   JCXZ  CX=0
                      	   147: 	mov $0x10000,%ecx
                      	   148: 	jcxz jcxzok\@
                      	   149: jecxz\@:
                      	   150: 	jecxz err2\@
                      	   151: 	mov $0,%ecx
                      	   152: 	jecxz jecxzok\@ 	# E3   JECXZ   ECX=0
                      	   153: jecxze\@:
                      	   154: .endif
                      	   155: 	jmp exit\@
                      	   156: 
                      	   157: .if \arg1==16
                      	   158: 	.rept 128
                      	   159: 		hlt
                      	   160: 	.endr
                      	   161: .endif
                      	   162: 
                      	   163: err2\@:
                      	   164: 	hlt
                      	   165: 
                      	   166: # test negative offsets
                      	   167: jook\@:   jo   jnl\@
                      	   168: jnlok\@:  jnl  jnle\@
                      	   169: jnleok\@: jnle jl\@
                      	   170: jlok\@:   jl   jle\@
                      	   171: jleok\@:  jle  jcxz\@
                      	   172: .if \arg1==8
                      	   173: jcxzok\@:  jcxz  jecxz\@
                      	   174: jecxzok\@: jecxz jecxze\@
                      	   175: .endif
                      	   176: 
                      	   177: exit\@:
                      	   178: .endm
                      	   179: 

Source: "t386.asm"
                      	   181: 	testJcc 8
04:0000009E B401      	     1M 	mov $PS_CF,%ah
04:000000A0 9E        	     2M 	sahf         # dont use the stack (pushf/popf)
04:000000A1 7324      	     3M 	jnc err110 	# 73 / 0F83   JNC  CF=0
04:000000A3 7223      	     4M 	jc jcok10 	# 72 / 0F82   JC   CF=1
04:000000A5 F4        	     5M 	hlt
                      	     6M jz10:
04:000000A6 B440      	     7M 	mov $PS_ZF,%ah
04:000000A8 9E        	     8M 	sahf
04:000000A9 751C      	     9M 	jnz err110 	# 75 / 0F85   JNZ  ZF=0
04:000000AB 741D      	    10M 	jz jzok10 	# 74 / 0F84   JZ   ZF=1
04:000000AD F4        	    11M 	hlt
                      	    12M jp10:
04:000000AE B404      	    13M 	mov $PS_PF,%ah
04:000000B0 9E        	    14M 	sahf
04:000000B1 7B14      	    15M 	jnp err110 	# 7B / 0F8B   JNP  PF=0
04:000000B3 7A17      	    16M 	jp jpok10 	# 7A / 0F8A   JP   PF=1
04:000000B5 F4        	    17M 	hlt
                      	    18M js10:
04:000000B6 B480      	    19M 	mov $PS_SF,%ah
04:000000B8 9E        	    20M 	sahf
04:000000B9 790C      	    21M 	jns err110 	# 79 / 0F89   JNS  SF=0
04:000000BB 7811      	    22M 	js jsok10 	# 78 / 0F88   JS   SF=1
04:000000BD F4        	    23M 	hlt
                      	    24M jna10:
04:000000BE B441      	    25M 	mov $PS_ZF|PS_CF,%ah
04:000000C0 9E        	    26M 	sahf
04:000000C1 7704      	    27M 	ja err110  	# 77 / 0F87   JA   CF=0 && ZF=0
04:000000C3 760B      	    28M 	jna jnaok10 # 76 / 0F86   JBE  CF=1 || ZF=1
                      	    29M next110:
04:000000C5 EB0B      	    30M 	jmp jnc10
                      	    31M 
                      	    32M .if 8==16
                      	    33M 	.rept 128
                      	    34M 		hlt
                      	    35M 	.endr
                      	    36M .endif
                      	    37M 
                      	    38M err110:
04:000000C7 F4        	    39M 	hlt
                      	    40M 
                      	    41M # test negative offsets
04:000000C8 72DC      	    42M jcok10:   jc   jz10
04:000000CA 74E2      	    43M jzok10:   jz   jp10
04:000000CC 7AE8      	    44M jpok10:   jp   js10
04:000000CE 78EE      	    45M jsok10:   js   jna10
04:000000D0 76F3      	    46M jnaok10:  jna  next110
                      	    47M 
                      	    48M 
                      	    49M jnc10:
04:000000D2 B4D4      	    50M 	mov $PS_SF|PS_ZF|PS_AF|PS_PF,%ah
04:000000D4 9E        	    51M 	sahf
04:000000D5 B80000    	    52M 	mov $0,%ax
04:000000D8 9E        	    53M 	sahf
04:000000D9 731B      	    54M 	jnc   jncok10 # 73 / 0F83   JNC  CF=0
04:000000DB F4        	    55M 	hlt
                      	    56M jnz10:
04:000000DC B495      	    57M 	mov $PS_SF|PS_AF|PS_PF|PS_CF,%ah
04:000000DE 9E        	    58M 	sahf
04:000000DF 7517      	    59M 	jnz   jnzok10 # 75 / 0F85   JNZ  ZF=0
04:000000E1 F4        	    60M 	hlt
                      	    61M jnp10:
04:000000E2 B4D1      	    62M 	mov $PS_SF|PS_ZF|PS_AF|PS_CF,%ah
04:000000E4 9E        	    63M 	sahf
04:000000E5 7B13      	    64M 	jnp   jnpok10 # 7B / 0F8B   JNP  PF=0
04:000000E7 F4        	    65M 	hlt
                      	    66M jns10:
04:000000E8 B455      	    67M 	mov $PS_ZF|PS_AF|PS_PF|PS_CF,%ah
04:000000EA 9E        	    68M 	sahf
04:000000EB 790F      	    69M 	jns jnsok10 # 79 /  0F89  JNS  SF=0
04:000000ED F4        	    70M 	hlt
                      	    71M ja10:
04:000000EE B494      	    72M 	mov $PS_SF|PS_AF|PS_PF,%ah
04:000000F0 9E        	    73M 	sahf
04:000000F1 770B      	    74M 	ja    jaok10  # 77 / 0F87   JA   CF=0 && ZF=0
04:000000F3 F4        	    75M 	hlt
                      	    76M next210:
04:000000F4 EB0A      	    77M 	jmp   jo10
                      	    78M 
                      	    79M .if 8==16
                      	    80M 	.rept 128
                      	    81M 		hlt
                      	    82M 	.endr
                      	    83M .endif
                      	    84M 
                      	    85M # test negative offsets
04:000000F6 73E4      	    86M jncok10:  jnc  jnz10
04:000000F8 75E8      	    87M jnzok10:  jnz  jnp10
04:000000FA 7BEC      	    88M jnpok10:  jnp  jns10
04:000000FC 79F0      	    89M jnsok10:  jns  ja10
04:000000FE 77F4      	    90M jaok10:   ja   next210
                      	    91M 
                      	    92M jo10:
04:00000100 B400      	    93M 	mov $0,%ah
04:00000102 9E        	    94M 	sahf
04:00000103 B040      	    95M 	mov $0b1000000,%al
04:00000105 C0E001    	    96M 	shl $1,%al   	# OF = high-order bit of AL <> (CF), ZF=0,SF=1,OF=1
04:00000108 7132      	    97M 	jno err210
04:0000010A 7031      	    98M 	jo jook10
04:0000010C F4        	    99M 	hlt
                      	   100M jnl10:
04:0000010D 7C2D      	   101M 	jl err210   	# 7C / 0F8C   JL   SF!=OF
04:0000010F 7D2E      	   102M 	jnl jnlok10  	# 7D / 0F8D   JNL  SF=OF
04:00000111 F4        	   103M 	hlt
                      	   104M jnle10:
04:00000112 7E28      	   105M 	jle err210   	# 7E / 0F8E   JLE  ZF=1 || SF!=OF
04:00000114 7F2B      	   106M 	jnle jnleok10 # 7F / 0F8F   JNLE ZF=0 && SF=OF
04:00000116 F4        	   107M 	hlt
                      	   108M jl10:
04:00000117 B440      	   109M 	mov $PS_ZF,%ah
04:00000119 9E        	   110M 	sahf          # ZF=1,SF=0,OF=1
04:0000011A 7C27      	   111M 	jl jlok10   	# 7C / 0F8C   JL   SF!=OF
04:0000011C F4        	   112M 	hlt
                      	   113M jle10:
04:0000011D 7E26      	   114M 	jle jleok10  	# 7E / 0F8E   JLE  ZF=1 || SF!=OF
04:0000011F F4        	   115M 	hlt
                      	   116M jcxz10:
                      	   117M .if 8==8
04:00000120 66B9010000	   118M 	mov $1,%ecx
04:00000125 00
04:00000126 E314      	   119M 	jcxz err210      	# E3   JCXZ  CX=0
04:00000128 66B9000001	   120M 	mov $0x10000,%ecx
04:0000012D 00
04:0000012E E317      	   121M 	jcxz jcxzok10
                      	   122M jecxz10:
04:00000130 E30A      	   123M 	jecxz err210
04:00000132 66B9000000	   124M 	mov $0,%ecx
04:00000137 00
04:00000138 E30F      	   125M 	jecxz jecxzok10 	# E3   JECXZ   ECX=0
                      	   126M jecxze10:
                      	   127M .endif
04:0000013A EB0F      	   128M 	jmp exit10
                      	   129M 
                      	   130M .if 8==16
                      	   131M 	.rept 128
                      	   132M 		hlt
                      	   133M 	.endr
                      	   134M .endif
                      	   135M 
                      	   136M err210:
04:0000013C F4        	   137M 	hlt
                      	   138M 
                      	   139M # test negative offsets
04:0000013D 70CE      	   140M jook10:   jo   jnl10
04:0000013F 7DD1      	   141M jnlok10:  jnl  jnle10
04:00000141 7FD4      	   142M jnleok10: jnle jl10
04:00000143 7CD8      	   143M jlok10:   jl   jle10
04:00000145 7ED9      	   144M jleok10:  jle  jcxz10
                      	   145M .if 8==8
04:00000147 E3E7      	   146M jcxzok10:  jcxz  jecxz10
04:00000149 E3EF      	   147M jecxzok10: jecxz jecxze10
                      	   148M .endif
                      	   149M 
                      	   150M exit10:
                      	   182: 	testJcc 16
04:0000014B B401      	     1M 	mov $PS_CF,%ah
04:0000014D 9E        	     2M 	sahf         # dont use the stack (pushf/popf)
04:0000014E 0F83B700  	     3M 	jnc err111 	# 73 / 0F83   JNC  CF=0
04:00000152 0F82B400  	     4M 	jc jcok11 	# 72 / 0F82   JC   CF=1
04:00000156 F4        	     5M 	hlt
                      	     6M jz11:
04:00000157 B440      	     7M 	mov $PS_ZF,%ah
04:00000159 9E        	     8M 	sahf
04:0000015A 0F85AB00  	     9M 	jnz err111 	# 75 / 0F85   JNZ  ZF=0
04:0000015E 0F84AC00  	    10M 	jz jzok11 	# 74 / 0F84   JZ   ZF=1
04:00000162 F4        	    11M 	hlt
                      	    12M jp11:
04:00000163 B404      	    13M 	mov $PS_PF,%ah
04:00000165 9E        	    14M 	sahf
04:00000166 0F8B9F00  	    15M 	jnp err111 	# 7B / 0F8B   JNP  PF=0
04:0000016A 0F8AA400  	    16M 	jp jpok11 	# 7A / 0F8A   JP   PF=1
04:0000016E F4        	    17M 	hlt
                      	    18M js11:
04:0000016F B480      	    19M 	mov $PS_SF,%ah
04:00000171 9E        	    20M 	sahf
04:00000172 0F899300  	    21M 	jns err111 	# 79 / 0F89   JNS  SF=0
04:00000176 0F889C00  	    22M 	js jsok11 	# 78 / 0F88   JS   SF=1
04:0000017A F4        	    23M 	hlt
                      	    24M jna11:
04:0000017B B441      	    25M 	mov $PS_ZF|PS_CF,%ah
04:0000017D 9E        	    26M 	sahf
04:0000017E 0F878700  	    27M 	ja err111  	# 77 / 0F87   JA   CF=0 && ZF=0
04:00000182 0F869400  	    28M 	jna jnaok11 # 76 / 0F86   JBE  CF=1 || ZF=1
                      	    29M next111:
04:00000186 E99500    	    30M 	jmp jnc11
                      	    31M 
                      	    32M .if 16==16
                      	    33M 	.rept 128
                      	    34M 		hlt
                      	    35M 	.endr
04:00000189 F4        	     1M 		hlt
                      	     2M 	
04:0000018A F4        	     1M 		hlt
                      	     2M 	
04:0000018B F4        	     1M 		hlt
                      	     2M 	
04:0000018C F4        	     1M 		hlt
                      	     2M 	
04:0000018D F4        	     1M 		hlt
                      	     2M 	
04:0000018E F4        	     1M 		hlt
                      	     2M 	
04:0000018F F4        	     1M 		hlt
                      	     2M 	
04:00000190 F4        	     1M 		hlt
                      	     2M 	
04:00000191 F4        	     1M 		hlt
                      	     2M 	
04:00000192 F4        	     1M 		hlt
                      	     2M 	
04:00000193 F4        	     1M 		hlt
                      	     2M 	
04:00000194 F4        	     1M 		hlt
                      	     2M 	
04:00000195 F4        	     1M 		hlt
                      	     2M 	
04:00000196 F4        	     1M 		hlt
                      	     2M 	
04:00000197 F4        	     1M 		hlt
                      	     2M 	
04:00000198 F4        	     1M 		hlt
                      	     2M 	
04:00000199 F4        	     1M 		hlt
                      	     2M 	
04:0000019A F4        	     1M 		hlt
                      	     2M 	
04:0000019B F4        	     1M 		hlt
                      	     2M 	
04:0000019C F4        	     1M 		hlt
                      	     2M 	
04:0000019D F4        	     1M 		hlt
                      	     2M 	
04:0000019E F4        	     1M 		hlt
                      	     2M 	
04:0000019F F4        	     1M 		hlt
                      	     2M 	
04:000001A0 F4        	     1M 		hlt
                      	     2M 	
04:000001A1 F4        	     1M 		hlt
                      	     2M 	
04:000001A2 F4        	     1M 		hlt
                      	     2M 	
04:000001A3 F4        	     1M 		hlt
                      	     2M 	
04:000001A4 F4        	     1M 		hlt
                      	     2M 	
04:000001A5 F4        	     1M 		hlt
                      	     2M 	
04:000001A6 F4        	     1M 		hlt
                      	     2M 	
04:000001A7 F4        	     1M 		hlt
                      	     2M 	
04:000001A8 F4        	     1M 		hlt
                      	     2M 	
04:000001A9 F4        	     1M 		hlt
                      	     2M 	
04:000001AA F4        	     1M 		hlt
                      	     2M 	
04:000001AB F4        	     1M 		hlt
                      	     2M 	
04:000001AC F4        	     1M 		hlt
                      	     2M 	
04:000001AD F4        	     1M 		hlt
                      	     2M 	
04:000001AE F4        	     1M 		hlt
                      	     2M 	
04:000001AF F4        	     1M 		hlt
                      	     2M 	
04:000001B0 F4        	     1M 		hlt
                      	     2M 	
04:000001B1 F4        	     1M 		hlt
                      	     2M 	
04:000001B2 F4        	     1M 		hlt
                      	     2M 	
04:000001B3 F4        	     1M 		hlt
                      	     2M 	
04:000001B4 F4        	     1M 		hlt
                      	     2M 	
04:000001B5 F4        	     1M 		hlt
                      	     2M 	
04:000001B6 F4        	     1M 		hlt
                      	     2M 	
04:000001B7 F4        	     1M 		hlt
                      	     2M 	
04:000001B8 F4        	     1M 		hlt
                      	     2M 	
04:000001B9 F4        	     1M 		hlt
                      	     2M 	
04:000001BA F4        	     1M 		hlt
                      	     2M 	
04:000001BB F4        	     1M 		hlt
                      	     2M 	
04:000001BC F4        	     1M 		hlt
                      	     2M 	
04:000001BD F4        	     1M 		hlt
                      	     2M 	
04:000001BE F4        	     1M 		hlt
                      	     2M 	
04:000001BF F4        	     1M 		hlt
                      	     2M 	
04:000001C0 F4        	     1M 		hlt
                      	     2M 	
04:000001C1 F4        	     1M 		hlt
                      	     2M 	
04:000001C2 F4        	     1M 		hlt
                      	     2M 	
04:000001C3 F4        	     1M 		hlt
                      	     2M 	
04:000001C4 F4        	     1M 		hlt
                      	     2M 	
04:000001C5 F4        	     1M 		hlt
                      	     2M 	
04:000001C6 F4        	     1M 		hlt
                      	     2M 	
04:000001C7 F4        	     1M 		hlt
                      	     2M 	
04:000001C8 F4        	     1M 		hlt
                      	     2M 	
04:000001C9 F4        	     1M 		hlt
                      	     2M 	
04:000001CA F4        	     1M 		hlt
                      	     2M 	
04:000001CB F4        	     1M 		hlt
                      	     2M 	
04:000001CC F4        	     1M 		hlt
                      	     2M 	
04:000001CD F4        	     1M 		hlt
                      	     2M 	
04:000001CE F4        	     1M 		hlt
                      	     2M 	
04:000001CF F4        	     1M 		hlt
                      	     2M 	
04:000001D0 F4        	     1M 		hlt
                      	     2M 	
04:000001D1 F4        	     1M 		hlt
                      	     2M 	
04:000001D2 F4        	     1M 		hlt
                      	     2M 	
04:000001D3 F4        	     1M 		hlt
                      	     2M 	
04:000001D4 F4        	     1M 		hlt
                      	     2M 	
04:000001D5 F4        	     1M 		hlt
                      	     2M 	
04:000001D6 F4        	     1M 		hlt
                      	     2M 	
04:000001D7 F4        	     1M 		hlt
                      	     2M 	
04:000001D8 F4        	     1M 		hlt
                      	     2M 	
04:000001D9 F4        	     1M 		hlt
                      	     2M 	
04:000001DA F4        	     1M 		hlt
                      	     2M 	
04:000001DB F4        	     1M 		hlt
                      	     2M 	
04:000001DC F4        	     1M 		hlt
                      	     2M 	
04:000001DD F4        	     1M 		hlt
                      	     2M 	
04:000001DE F4        	     1M 		hlt
                      	     2M 	
04:000001DF F4        	     1M 		hlt
                      	     2M 	
04:000001E0 F4        	     1M 		hlt
                      	     2M 	
04:000001E1 F4        	     1M 		hlt
                      	     2M 	
04:000001E2 F4        	     1M 		hlt
                      	     2M 	
04:000001E3 F4        	     1M 		hlt
                      	     2M 	
04:000001E4 F4        	     1M 		hlt
                      	     2M 	
04:000001E5 F4        	     1M 		hlt
                      	     2M 	
04:000001E6 F4        	     1M 		hlt
                      	     2M 	
04:000001E7 F4        	     1M 		hlt
                      	     2M 	
04:000001E8 F4        	     1M 		hlt
                      	     2M 	
04:000001E9 F4        	     1M 		hlt
                      	     2M 	
04:000001EA F4        	     1M 		hlt
                      	     2M 	
04:000001EB F4        	     1M 		hlt
                      	     2M 	
04:000001EC F4        	     1M 		hlt
                      	     2M 	
04:000001ED F4        	     1M 		hlt
                      	     2M 	
04:000001EE F4        	     1M 		hlt
                      	     2M 	
04:000001EF F4        	     1M 		hlt
                      	     2M 	
04:000001F0 F4        	     1M 		hlt
                      	     2M 	
04:000001F1 F4        	     1M 		hlt
                      	     2M 	
04:000001F2 F4        	     1M 		hlt
                      	     2M 	
04:000001F3 F4        	     1M 		hlt
                      	     2M 	
04:000001F4 F4        	     1M 		hlt
                      	     2M 	
04:000001F5 F4        	     1M 		hlt
                      	     2M 	
04:000001F6 F4        	     1M 		hlt
                      	     2M 	
04:000001F7 F4        	     1M 		hlt
                      	     2M 	
04:000001F8 F4        	     1M 		hlt
                      	     2M 	
04:000001F9 F4        	     1M 		hlt
                      	     2M 	
04:000001FA F4        	     1M 		hlt
                      	     2M 	
04:000001FB F4        	     1M 		hlt
                      	     2M 	
04:000001FC F4        	     1M 		hlt
                      	     2M 	
04:000001FD F4        	     1M 		hlt
                      	     2M 	
04:000001FE F4        	     1M 		hlt
                      	     2M 	
04:000001FF F4        	     1M 		hlt
                      	     2M 	
04:00000200 F4        	     1M 		hlt
                      	     2M 	
04:00000201 F4        	     1M 		hlt
                      	     2M 	
04:00000202 F4        	     1M 		hlt
                      	     2M 	
04:00000203 F4        	     1M 		hlt
                      	     2M 	
04:00000204 F4        	     1M 		hlt
                      	     2M 	
04:00000205 F4        	     1M 		hlt
                      	     2M 	
04:00000206 F4        	     1M 		hlt
                      	     2M 	
04:00000207 F4        	     1M 		hlt
                      	     2M 	
04:00000208 F4        	     1M 		hlt
                      	     2M 	
                      	    36M .endif
                      	    37M 
                      	    38M err111:
04:00000209 F4        	    39M 	hlt
                      	    40M 
                      	    41M # test negative offsets
04:0000020A 0F8249FF  	    42M jcok11:   jc   jz11
04:0000020E 0F8451FF  	    43M jzok11:   jz   jp11
04:00000212 0F8A59FF  	    44M jpok11:   jp   js11
04:00000216 0F8861FF  	    45M jsok11:   js   jna11
04:0000021A 0F8668FF  	    46M jnaok11:  jna  next111
                      	    47M 
                      	    48M 
                      	    49M jnc11:
04:0000021E B4D4      	    50M 	mov $PS_SF|PS_ZF|PS_AF|PS_PF,%ah
04:00000220 9E        	    51M 	sahf
04:00000221 B80000    	    52M 	mov $0,%ax
04:00000224 9E        	    53M 	sahf
04:00000225 0F83A400  	    54M 	jnc   jncok11 # 73 / 0F83   JNC  CF=0
04:00000229 F4        	    55M 	hlt
                      	    56M jnz11:
04:0000022A B495      	    57M 	mov $PS_SF|PS_AF|PS_PF|PS_CF,%ah
04:0000022C 9E        	    58M 	sahf
04:0000022D 0F85A000  	    59M 	jnz   jnzok11 # 75 / 0F85   JNZ  ZF=0
04:00000231 F4        	    60M 	hlt
                      	    61M jnp11:
04:00000232 B4D1      	    62M 	mov $PS_SF|PS_ZF|PS_AF|PS_CF,%ah
04:00000234 9E        	    63M 	sahf
04:00000235 0F8B9C00  	    64M 	jnp   jnpok11 # 7B / 0F8B   JNP  PF=0
04:00000239 F4        	    65M 	hlt
                      	    66M jns11:
04:0000023A B455      	    67M 	mov $PS_ZF|PS_AF|PS_PF|PS_CF,%ah
04:0000023C 9E        	    68M 	sahf
04:0000023D 0F899800  	    69M 	jns jnsok11 # 79 /  0F89  JNS  SF=0
04:00000241 F4        	    70M 	hlt
                      	    71M ja11:
04:00000242 B494      	    72M 	mov $PS_SF|PS_AF|PS_PF,%ah
04:00000244 9E        	    73M 	sahf
04:00000245 0F879400  	    74M 	ja    jaok11  # 77 / 0F87   JA   CF=0 && ZF=0
04:00000249 F4        	    75M 	hlt
                      	    76M next211:
04:0000024A E99400    	    77M 	jmp   jo11
                      	    78M 
                      	    79M .if 16==16
                      	    80M 	.rept 128
                      	    81M 		hlt
                      	    82M 	.endr
04:0000024D F4        	     1M 		hlt
                      	     2M 	
04:0000024E F4        	     1M 		hlt
                      	     2M 	
04:0000024F F4        	     1M 		hlt
                      	     2M 	
04:00000250 F4        	     1M 		hlt
                      	     2M 	
04:00000251 F4        	     1M 		hlt
                      	     2M 	
04:00000252 F4        	     1M 		hlt
                      	     2M 	
04:00000253 F4        	     1M 		hlt
                      	     2M 	
04:00000254 F4        	     1M 		hlt
                      	     2M 	
04:00000255 F4        	     1M 		hlt
                      	     2M 	
04:00000256 F4        	     1M 		hlt
                      	     2M 	
04:00000257 F4        	     1M 		hlt
                      	     2M 	
04:00000258 F4        	     1M 		hlt
                      	     2M 	
04:00000259 F4        	     1M 		hlt
                      	     2M 	
04:0000025A F4        	     1M 		hlt
                      	     2M 	
04:0000025B F4        	     1M 		hlt
                      	     2M 	
04:0000025C F4        	     1M 		hlt
                      	     2M 	
04:0000025D F4        	     1M 		hlt
                      	     2M 	
04:0000025E F4        	     1M 		hlt
                      	     2M 	
04:0000025F F4        	     1M 		hlt
                      	     2M 	
04:00000260 F4        	     1M 		hlt
                      	     2M 	
04:00000261 F4        	     1M 		hlt
                      	     2M 	
04:00000262 F4        	     1M 		hlt
                      	     2M 	
04:00000263 F4        	     1M 		hlt
                      	     2M 	
04:00000264 F4        	     1M 		hlt
                      	     2M 	
04:00000265 F4        	     1M 		hlt
                      	     2M 	
04:00000266 F4        	     1M 		hlt
                      	     2M 	
04:00000267 F4        	     1M 		hlt
                      	     2M 	
04:00000268 F4        	     1M 		hlt
                      	     2M 	
04:00000269 F4        	     1M 		hlt
                      	     2M 	
04:0000026A F4        	     1M 		hlt
                      	     2M 	
04:0000026B F4        	     1M 		hlt
                      	     2M 	
04:0000026C F4        	     1M 		hlt
                      	     2M 	
04:0000026D F4        	     1M 		hlt
                      	     2M 	
04:0000026E F4        	     1M 		hlt
                      	     2M 	
04:0000026F F4        	     1M 		hlt
                      	     2M 	
04:00000270 F4        	     1M 		hlt
                      	     2M 	
04:00000271 F4        	     1M 		hlt
                      	     2M 	
04:00000272 F4        	     1M 		hlt
                      	     2M 	
04:00000273 F4        	     1M 		hlt
                      	     2M 	
04:00000274 F4        	     1M 		hlt
                      	     2M 	
04:00000275 F4        	     1M 		hlt
                      	     2M 	
04:00000276 F4        	     1M 		hlt
                      	     2M 	
04:00000277 F4        	     1M 		hlt
                      	     2M 	
04:00000278 F4        	     1M 		hlt
                      	     2M 	
04:00000279 F4        	     1M 		hlt
                      	     2M 	
04:0000027A F4        	     1M 		hlt
                      	     2M 	
04:0000027B F4        	     1M 		hlt
                      	     2M 	
04:0000027C F4        	     1M 		hlt
                      	     2M 	
04:0000027D F4        	     1M 		hlt
                      	     2M 	
04:0000027E F4        	     1M 		hlt
                      	     2M 	
04:0000027F F4        	     1M 		hlt
                      	     2M 	
04:00000280 F4        	     1M 		hlt
                      	     2M 	
04:00000281 F4        	     1M 		hlt
                      	     2M 	
04:00000282 F4        	     1M 		hlt
                      	     2M 	
04:00000283 F4        	     1M 		hlt
                      	     2M 	
04:00000284 F4        	     1M 		hlt
                      	     2M 	
04:00000285 F4        	     1M 		hlt
                      	     2M 	
04:00000286 F4        	     1M 		hlt
                      	     2M 	
04:00000287 F4        	     1M 		hlt
                      	     2M 	
04:00000288 F4        	     1M 		hlt
                      	     2M 	
04:00000289 F4        	     1M 		hlt
                      	     2M 	
04:0000028A F4        	     1M 		hlt
                      	     2M 	
04:0000028B F4        	     1M 		hlt
                      	     2M 	
04:0000028C F4        	     1M 		hlt
                      	     2M 	
04:0000028D F4        	     1M 		hlt
                      	     2M 	
04:0000028E F4        	     1M 		hlt
                      	     2M 	
04:0000028F F4        	     1M 		hlt
                      	     2M 	
04:00000290 F4        	     1M 		hlt
                      	     2M 	
04:00000291 F4        	     1M 		hlt
                      	     2M 	
04:00000292 F4        	     1M 		hlt
                      	     2M 	
04:00000293 F4        	     1M 		hlt
                      	     2M 	
04:00000294 F4        	     1M 		hlt
                      	     2M 	
04:00000295 F4        	     1M 		hlt
                      	     2M 	
04:00000296 F4        	     1M 		hlt
                      	     2M 	
04:00000297 F4        	     1M 		hlt
                      	     2M 	
04:00000298 F4        	     1M 		hlt
                      	     2M 	
04:00000299 F4        	     1M 		hlt
                      	     2M 	
04:0000029A F4        	     1M 		hlt
                      	     2M 	
04:0000029B F4        	     1M 		hlt
                      	     2M 	
04:0000029C F4        	     1M 		hlt
                      	     2M 	
04:0000029D F4        	     1M 		hlt
                      	     2M 	
04:0000029E F4        	     1M 		hlt
                      	     2M 	
04:0000029F F4        	     1M 		hlt
                      	     2M 	
04:000002A0 F4        	     1M 		hlt
                      	     2M 	
04:000002A1 F4        	     1M 		hlt
                      	     2M 	
04:000002A2 F4        	     1M 		hlt
                      	     2M 	
04:000002A3 F4        	     1M 		hlt
                      	     2M 	
04:000002A4 F4        	     1M 		hlt
                      	     2M 	
04:000002A5 F4        	     1M 		hlt
                      	     2M 	
04:000002A6 F4        	     1M 		hlt
                      	     2M 	
04:000002A7 F4        	     1M 		hlt
                      	     2M 	
04:000002A8 F4        	     1M 		hlt
                      	     2M 	
04:000002A9 F4        	     1M 		hlt
                      	     2M 	
04:000002AA F4        	     1M 		hlt
                      	     2M 	
04:000002AB F4        	     1M 		hlt
                      	     2M 	
04:000002AC F4        	     1M 		hlt
                      	     2M 	
04:000002AD F4        	     1M 		hlt
                      	     2M 	
04:000002AE F4        	     1M 		hlt
                      	     2M 	
04:000002AF F4        	     1M 		hlt
                      	     2M 	
04:000002B0 F4        	     1M 		hlt
                      	     2M 	
04:000002B1 F4        	     1M 		hlt
                      	     2M 	
04:000002B2 F4        	     1M 		hlt
                      	     2M 	
04:000002B3 F4        	     1M 		hlt
                      	     2M 	
04:000002B4 F4        	     1M 		hlt
                      	     2M 	
04:000002B5 F4        	     1M 		hlt
                      	     2M 	
04:000002B6 F4        	     1M 		hlt
                      	     2M 	
04:000002B7 F4        	     1M 		hlt
                      	     2M 	
04:000002B8 F4        	     1M 		hlt
                      	     2M 	
04:000002B9 F4        	     1M 		hlt
                      	     2M 	
04:000002BA F4        	     1M 		hlt
                      	     2M 	
04:000002BB F4        	     1M 		hlt
                      	     2M 	
04:000002BC F4        	     1M 		hlt
                      	     2M 	
04:000002BD F4        	     1M 		hlt
                      	     2M 	
04:000002BE F4        	     1M 		hlt
                      	     2M 	
04:000002BF F4        	     1M 		hlt
                      	     2M 	
04:000002C0 F4        	     1M 		hlt
                      	     2M 	
04:000002C1 F4        	     1M 		hlt
                      	     2M 	
04:000002C2 F4        	     1M 		hlt
                      	     2M 	
04:000002C3 F4        	     1M 		hlt
                      	     2M 	
04:000002C4 F4        	     1M 		hlt
                      	     2M 	
04:000002C5 F4        	     1M 		hlt
                      	     2M 	
04:000002C6 F4        	     1M 		hlt
                      	     2M 	
04:000002C7 F4        	     1M 		hlt
                      	     2M 	
04:000002C8 F4        	     1M 		hlt
                      	     2M 	
04:000002C9 F4        	     1M 		hlt
                      	     2M 	
04:000002CA F4        	     1M 		hlt
                      	     2M 	
04:000002CB F4        	     1M 		hlt
                      	     2M 	
04:000002CC F4        	     1M 		hlt
                      	     2M 	
                      	    83M .endif
                      	    84M 
                      	    85M # test negative offsets
04:000002CD 0F8359FF  	    86M jncok11:  jnc  jnz11
04:000002D1 0F855DFF  	    87M jnzok11:  jnz  jnp11
04:000002D5 0F8B61FF  	    88M jnpok11:  jnp  jns11
04:000002D9 0F8965FF  	    89M jnsok11:  jns  ja11
04:000002DD 0F8769FF  	    90M jaok11:   ja   next211
                      	    91M 
                      	    92M jo11:
04:000002E1 B400      	    93M 	mov $0,%ah
04:000002E3 9E        	    94M 	sahf
04:000002E4 B040      	    95M 	mov $0b1000000,%al
04:000002E6 C0E001    	    96M 	shl $1,%al   	# OF = high-order bit of AL <> (CF), ZF=0,SF=1,OF=1
04:000002E9 0F81A700  	    97M 	jno err211
04:000002ED 0F80A400  	    98M 	jo jook11
04:000002F1 F4        	    99M 	hlt
                      	   100M jnl11:
04:000002F2 0F8C9E00  	   101M 	jl err211   	# 7C / 0F8C   JL   SF!=OF
04:000002F6 0F8D9F00  	   102M 	jnl jnlok11  	# 7D / 0F8D   JNL  SF=OF
04:000002FA F4        	   103M 	hlt
                      	   104M jnle11:
04:000002FB 0F8E9500  	   105M 	jle err211   	# 7E / 0F8E   JLE  ZF=1 || SF!=OF
04:000002FF 0F8F9A00  	   106M 	jnle jnleok11 # 7F / 0F8F   JNLE ZF=0 && SF=OF
04:00000303 F4        	   107M 	hlt
                      	   108M jl11:
04:00000304 B440      	   109M 	mov $PS_ZF,%ah
04:00000306 9E        	   110M 	sahf          # ZF=1,SF=0,OF=1
04:00000307 0F8C9600  	   111M 	jl jlok11   	# 7C / 0F8C   JL   SF!=OF
04:0000030B F4        	   112M 	hlt
                      	   113M jle11:
04:0000030C 0F8E9500  	   114M 	jle jleok11  	# 7E / 0F8E   JLE  ZF=1 || SF!=OF
04:00000310 F4        	   115M 	hlt
                      	   116M jcxz11:
                      	   117M .if 16==8
                      	   118M 	mov $1,%ecx
                      	   119M 	jcxz err211      	# E3   JCXZ  CX=0
                      	   120M 	mov $0x10000,%ecx
                      	   121M 	jcxz jcxzok11
                      	   122M jecxz11:
                      	   123M 	jecxz err211
                      	   124M 	mov $0,%ecx
                      	   125M 	jecxz jecxzok11 	# E3   JECXZ   ECX=0
                      	   126M jecxze11:
                      	   127M .endif
04:00000311 E99500    	   128M 	jmp exit11
                      	   129M 
                      	   130M .if 16==16
                      	   131M 	.rept 128
                      	   132M 		hlt
                      	   133M 	.endr
04:00000314 F4        	     1M 		hlt
                      	     2M 	
04:00000315 F4        	     1M 		hlt
                      	     2M 	
04:00000316 F4        	     1M 		hlt
                      	     2M 	
04:00000317 F4        	     1M 		hlt
                      	     2M 	
04:00000318 F4        	     1M 		hlt
                      	     2M 	
04:00000319 F4        	     1M 		hlt
                      	     2M 	
04:0000031A F4        	     1M 		hlt
                      	     2M 	
04:0000031B F4        	     1M 		hlt
                      	     2M 	
04:0000031C F4        	     1M 		hlt
                      	     2M 	
04:0000031D F4        	     1M 		hlt
                      	     2M 	
04:0000031E F4        	     1M 		hlt
                      	     2M 	
04:0000031F F4        	     1M 		hlt
                      	     2M 	
04:00000320 F4        	     1M 		hlt
                      	     2M 	
04:00000321 F4        	     1M 		hlt
                      	     2M 	
04:00000322 F4        	     1M 		hlt
                      	     2M 	
04:00000323 F4        	     1M 		hlt
                      	     2M 	
04:00000324 F4        	     1M 		hlt
                      	     2M 	
04:00000325 F4        	     1M 		hlt
                      	     2M 	
04:00000326 F4        	     1M 		hlt
                      	     2M 	
04:00000327 F4        	     1M 		hlt
                      	     2M 	
04:00000328 F4        	     1M 		hlt
                      	     2M 	
04:00000329 F4        	     1M 		hlt
                      	     2M 	
04:0000032A F4        	     1M 		hlt
                      	     2M 	
04:0000032B F4        	     1M 		hlt
                      	     2M 	
04:0000032C F4        	     1M 		hlt
                      	     2M 	
04:0000032D F4        	     1M 		hlt
                      	     2M 	
04:0000032E F4        	     1M 		hlt
                      	     2M 	
04:0000032F F4        	     1M 		hlt
                      	     2M 	
04:00000330 F4        	     1M 		hlt
                      	     2M 	
04:00000331 F4        	     1M 		hlt
                      	     2M 	
04:00000332 F4        	     1M 		hlt
                      	     2M 	
04:00000333 F4        	     1M 		hlt
                      	     2M 	
04:00000334 F4        	     1M 		hlt
                      	     2M 	
04:00000335 F4        	     1M 		hlt
                      	     2M 	
04:00000336 F4        	     1M 		hlt
                      	     2M 	
04:00000337 F4        	     1M 		hlt
                      	     2M 	
04:00000338 F4        	     1M 		hlt
                      	     2M 	
04:00000339 F4        	     1M 		hlt
                      	     2M 	
04:0000033A F4        	     1M 		hlt
                      	     2M 	
04:0000033B F4        	     1M 		hlt
                      	     2M 	
04:0000033C F4        	     1M 		hlt
                      	     2M 	
04:0000033D F4        	     1M 		hlt
                      	     2M 	
04:0000033E F4        	     1M 		hlt
                      	     2M 	
04:0000033F F4        	     1M 		hlt
                      	     2M 	
04:00000340 F4        	     1M 		hlt
                      	     2M 	
04:00000341 F4        	     1M 		hlt
                      	     2M 	
04:00000342 F4        	     1M 		hlt
                      	     2M 	
04:00000343 F4        	     1M 		hlt
                      	     2M 	
04:00000344 F4        	     1M 		hlt
                      	     2M 	
04:00000345 F4        	     1M 		hlt
                      	     2M 	
04:00000346 F4        	     1M 		hlt
                      	     2M 	
04:00000347 F4        	     1M 		hlt
                      	     2M 	
04:00000348 F4        	     1M 		hlt
                      	     2M 	
04:00000349 F4        	     1M 		hlt
                      	     2M 	
04:0000034A F4        	     1M 		hlt
                      	     2M 	
04:0000034B F4        	     1M 		hlt
                      	     2M 	
04:0000034C F4        	     1M 		hlt
                      	     2M 	
04:0000034D F4        	     1M 		hlt
                      	     2M 	
04:0000034E F4        	     1M 		hlt
                      	     2M 	
04:0000034F F4        	     1M 		hlt
                      	     2M 	
04:00000350 F4        	     1M 		hlt
                      	     2M 	
04:00000351 F4        	     1M 		hlt
                      	     2M 	
04:00000352 F4        	     1M 		hlt
                      	     2M 	
04:00000353 F4        	     1M 		hlt
                      	     2M 	
04:00000354 F4        	     1M 		hlt
                      	     2M 	
04:00000355 F4        	     1M 		hlt
                      	     2M 	
04:00000356 F4        	     1M 		hlt
                      	     2M 	
04:00000357 F4        	     1M 		hlt
                      	     2M 	
04:00000358 F4        	     1M 		hlt
                      	     2M 	
04:00000359 F4        	     1M 		hlt
                      	     2M 	
04:0000035A F4        	     1M 		hlt
                      	     2M 	
04:0000035B F4        	     1M 		hlt
                      	     2M 	
04:0000035C F4        	     1M 		hlt
                      	     2M 	
04:0000035D F4        	     1M 		hlt
                      	     2M 	
04:0000035E F4        	     1M 		hlt
                      	     2M 	
04:0000035F F4        	     1M 		hlt
                      	     2M 	
04:00000360 F4        	     1M 		hlt
                      	     2M 	
04:00000361 F4        	     1M 		hlt
                      	     2M 	
04:00000362 F4        	     1M 		hlt
                      	     2M 	
04:00000363 F4        	     1M 		hlt
                      	     2M 	
04:00000364 F4        	     1M 		hlt
                      	     2M 	
04:00000365 F4        	     1M 		hlt
                      	     2M 	
04:00000366 F4        	     1M 		hlt
                      	     2M 	
04:00000367 F4        	     1M 		hlt
                      	     2M 	
04:00000368 F4        	     1M 		hlt
                      	     2M 	
04:00000369 F4        	     1M 		hlt
                      	     2M 	
04:0000036A F4        	     1M 		hlt
                      	     2M 	
04:0000036B F4        	     1M 		hlt
                      	     2M 	
04:0000036C F4        	     1M 		hlt
                      	     2M 	
04:0000036D F4        	     1M 		hlt
                      	     2M 	
04:0000036E F4        	     1M 		hlt
                      	     2M 	
04:0000036F F4        	     1M 		hlt
                      	     2M 	
04:00000370 F4        	     1M 		hlt
                      	     2M 	
04:00000371 F4        	     1M 		hlt
                      	     2M 	
04:00000372 F4        	     1M 		hlt
                      	     2M 	
04:00000373 F4        	     1M 		hlt
                      	     2M 	
04:00000374 F4        	     1M 		hlt
                      	     2M 	
04:00000375 F4        	     1M 		hlt
                      	     2M 	
04:00000376 F4        	     1M 		hlt
                      	     2M 	
04:00000377 F4        	     1M 		hlt
                      	     2M 	
04:00000378 F4        	     1M 		hlt
                      	     2M 	
04:00000379 F4        	     1M 		hlt
                      	     2M 	
04:0000037A F4        	     1M 		hlt
                      	     2M 	
04:0000037B F4        	     1M 		hlt
                      	     2M 	
04:0000037C F4        	     1M 		hlt
                      	     2M 	
04:0000037D F4        	     1M 		hlt
                      	     2M 	
04:0000037E F4        	     1M 		hlt
                      	     2M 	
04:0000037F F4        	     1M 		hlt
                      	     2M 	
04:00000380 F4        	     1M 		hlt
                      	     2M 	
04:00000381 F4        	     1M 		hlt
                      	     2M 	
04:00000382 F4        	     1M 		hlt
                      	     2M 	
04:00000383 F4        	     1M 		hlt
                      	     2M 	
04:00000384 F4        	     1M 		hlt
                      	     2M 	
04:00000385 F4        	     1M 		hlt
                      	     2M 	
04:00000386 F4        	     1M 		hlt
                      	     2M 	
04:00000387 F4        	     1M 		hlt
                      	     2M 	
04:00000388 F4        	     1M 		hlt
                      	     2M 	
04:00000389 F4        	     1M 		hlt
                      	     2M 	
04:0000038A F4        	     1M 		hlt
                      	     2M 	
04:0000038B F4        	     1M 		hlt
                      	     2M 	
04:0000038C F4        	     1M 		hlt
                      	     2M 	
04:0000038D F4        	     1M 		hlt
                      	     2M 	
04:0000038E F4        	     1M 		hlt
                      	     2M 	
04:0000038F F4        	     1M 		hlt
                      	     2M 	
04:00000390 F4        	     1M 		hlt
                      	     2M 	
04:00000391 F4        	     1M 		hlt
                      	     2M 	
04:00000392 F4        	     1M 		hlt
                      	     2M 	
04:00000393 F4        	     1M 		hlt
                      	     2M 	
                      	   134M .endif
                      	   135M 
                      	   136M err211:
04:00000394 F4        	   137M 	hlt
                      	   138M 
                      	   139M # test negative offsets
04:00000395 0F8059FF  	   140M jook11:   jo   jnl11
04:00000399 0F8D5EFF  	   141M jnlok11:  jnl  jnle11
04:0000039D 0F8F63FF  	   142M jnleok11: jnle jl11
04:000003A1 0F8C67FF  	   143M jlok11:   jl   jle11
04:000003A5 0F8E68FF  	   144M jleok11:  jle  jcxz11
                      	   145M .if 16==8
                      	   146M jcxzok11:  jcxz  jecxz11
                      	   147M jecxzok11: jecxz jecxze11
                      	   148M .endif
                      	   149M 
                      	   150M exit11:
                      	   183: 
                      	   184: #
                      	   185: #   Loops
                      	   186: #
                      	   187: .include "loop_m.asm"

Source: "loop_m.asm"
                      	     1: #
                      	     2: #   Test of loop, loopz, loopnz
                      	     3: #   Use: EAX, ECX, Flags
                      	     4: #
                      	     5: 
                      	     6: .macro testLoop
                      	     7: 
                      	     8: 	mov $0x20000,%ecx
                      	     9: 	mov $0,%eax
                      	    10: loop16\@:
                      	    11: 	inc %eax
                      	    12: 	loopw loop16\@
                      	    13: 	cmp $0x10000,%eax
                      	    14: 	jne error
                      	    15: 	cmp $0x20000,%ecx
                      	    16: 	jne error
                      	    17: 
                      	    18: 	mov $0x20000,%ecx
                      	    19: 	mov $0,%eax
                      	    20: loop32\@:
                      	    21: 	inc %eax
                      	    22: 	loopl loop32\@
                      	    23: 	cmp $0x20000,%eax
                      	    24: 	jne error
                      	    25: 	cmp $0,%ecx
                      	    26: 	jne error
                      	    27: 
                      	    28: .endm
                      	    29: 
                      	    30: .macro testLoopZ
                      	    31: 
                      	    32: 	mov $0xFFFF,%cx
                      	    33: 	mov $0,%ax
                      	    34: loop16a\@:
                      	    35: 	inc %ax
                      	    36: 	cmp $0,%ah
                      	    37: 	loopzw loop16a\@
                      	    38: 	cmp $0x0100,%ax
                      	    39: 	jne error
                      	    40: 	cmp $0xFEFF,%cx
                      	    41: 	jne error
                      	    42: 
                      	    43: 	mov $0x00FF,%cx
                      	    44: 	mov $0,%ax
                      	    45: loop16b\@:
                      	    46: 	inc %ax
                      	    47: 	cmp $0,%ah
                      	    48: 	loopzw loop16b\@
                      	    49: 	cmp $0x00FF,%ax
                      	    50: 	jne error
                      	    51: 	cmp $0,%cx
                      	    52: 	jne error
                      	    53: 
                      	    54: 	mov $0x20000,%ecx
                      	    55: 	mov $0,%eax
                      	    56: loop32\@:
                      	    57: 	inc %eax
                      	    58: 	test $0x10000,%eax
                      	    59: 	loopzl loop32\@
                      	    60: 	cmp $0x10000,%eax
                      	    61: 	jne error
                      	    62: 	cmp $0x10000,%ecx
                      	    63: 	jne error
                      	    64: 
                      	    65: .endm
                      	    66: 
                      	    67: .macro testLoopNZ
                      	    68: 
                      	    69: 	mov $0xFFFF,%cx
                      	    70: 	mov $0,%ax
                      	    71: loop16a\@:
                      	    72: 	inc %ax
                      	    73: 	test $0xFF,%al
                      	    74: 	loopnzw loop16a\@
                      	    75: 	cmp $0x0100,%ax
                      	    76: 	jne error
                      	    77: 	cmp $0xFEFF,%cx
                      	    78: 	jne error
                      	    79: 
                      	    80: 	mov $0x00FF,%cx
                      	    81: 	mov $0,%ax
                      	    82: loop16b\@:
                      	    83: 	inc %ax
                      	    84: 	test $0xFF,%al
                      	    85: 	loopnzw loop16b\@
                      	    86: 	cmp $0x00FF,%ax
                      	    87: 	jne error
                      	    88: 	cmp $0,%cx
                      	    89: 	jne error
                      	    90: 
                      	    91: 	mov $0x10000,%ecx
                      	    92: 	mov $0,%eax
                      	    93: loop32\@:
                      	    94: 	inc %eax
                      	    95: 	test $0x0FFFF,%eax
                      	    96: 	loopnzl loop32\@
                      	    97: 	cmp $0x10000,%eax
                      	    98: 	jne error
                      	    99: 	cmp $0,%ecx
                      	   100: 	jne error
                      	   101: 
                      	   102: .endm

Source: "t386.asm"
                      	   188: #	testLoop
                      	   189: #	testLoopZ
                      	   190: #	testLoopNZ
                      	   191: 
                      	   192: #-------------------------------------------------------------------------------
                      	   193: 	POST $0x02
04:000003A9 B002      	     1M 	movb $0x02,%al
04:000003AB BA9001    	     2M 	movw $POST_PORT,%dx
04:000003AE EE        	     3M 	out %al,%dx
                      	   194: #-------------------------------------------------------------------------------
                      	   195: #
                      	   196: #   Quick tests of unsigned 32-bit multiplication and division
                      	   197: #   Thorough arithmetical and logical tests are done later
                      	   198: #
04:000003AF 66B8010000	   199: 	mov $0x80000001,%eax
04:000003B4 80
04:000003B5 66F7E8    	   200: 	imul %eax
04:000003B8 66B8112233	   201: 	mov $0x44332211,%eax
04:000003BD 44
04:000003BE 6689C3    	   202: 	mov %eax,%ebx
04:000003C1 66B9556677	   203: 	mov $0x88776655,%ecx
04:000003C6 88
04:000003C7 66F7E1    	   204: 	mul %ecx
04:000003CA 66F7F1    	   205: 	div %ecx
04:000003CD 6639D8    	   206: 	cmp %ebx,%eax
04:000003D0 0F855614  	   207: 	jne error
                      	   208: 
                      	   209: .include "mov_m.asm"

Source: "mov_m.asm"
                      	     1: #
                      	     2: #   Tests MOV from segment registers in real mode
                      	     3: #
                      	     4: #   %1 the segment register to test
                      	     5: #
                      	     6: .macro testMovSegR_real arg1
                      	     7: 	.if \arg1 = cs
                      	     8: 	mov $C_SEG_REAL,%dx
                      	     9: 	.else
                      	    10: 	mov $D1_SEG_REAL,%dx
                      	    11: 	.endif
                      	    12: 
                      	    13: 	# MOV reg to Sreg
                      	    14: 	.if \arg1 = cs
                      	    15: 	realModeFaultTest EX_UD, "mov %dx", \arg1 # test for #UD
                      	    16: 	.else
                      	    17: 	mov %dx,%\arg1
                      	    18: 	.endif
                      	    19: 
                      	    20: 	# MOV Sreg to 16 bit reg
                      	    21: 	xor %ax,%ax
                      	    22: 	mov %\arg1,%ax
                      	    23: 	cmp %dx,%ax
                      	    24: 	jne error
                      	    25: 
                      	    26: 	# MOV Sreg to 32 bit reg
                      	    27: 	mov $-1,%eax
                      	    28: 	mov %\arg1,%eax
                      	    29: 	# bits 31:16 are undefined for Pentium and earlier processors.
                      	    30: 	# TODO: verify on real hw and check TEST_UNDEF
                      	    31: 	cmp %dx,%ax
                      	    32: 	jne error
                      	    33: 
                      	    34: 	# MOV Sreg to word mem
                      	    35: 	movw $0xbeef,0
                      	    36: 	mov %\arg1,0
                      	    37: 	cmp %dx,0
                      	    38: 	jne error
                      	    39: 
                      	    40: 	# MOV word mem to Sreg
                      	    41: 	.if \arg1 = cs
                      	    42: 	realModeFaultTest EX_UD, "mov 0", \arg1 # test for #UD
                      	    43: 	.else
                      	    44: 	mov %ds,%cx	 	# save current DS in CX
                      	    45: 	xor %ax,%ax
                      	    46: 	mov %ax,%\arg1
                      	    47: 	.if \arg1 = ds
                      	    48: 	mov %cx,%es
                      	    49: 	mov %es:0,%\arg1
                      	    50: 	.else
                      	    51: 	mov 0,%\arg1
                      	    52: 	.endif
                      	    53: 	mov %\arg1,%ax
                      	    54: 	cmp %dx,%ax
                      	    55: 	jne error
                      	    56: 	.endif
                      	    57: 
                      	    58: .endm
                      	    59: 
                      	    60: 
                      	    61: .macro testMovSegR_prot arg1
                      	    62: 	mov $-1,%edx
                      	    63: 	.if \arg1 = cs
                      	    64: 	mov $C_SEG_PROT32,%dx
                      	    65: 	%else
                      	    66: 	mov $D1_SEG_PROT,%dx
                      	    67: 	%endif
                      	    68: 
                      	    69: 	# MOV reg to Sreg
                      	    70: 	.if \arg1 = cs
                      	    71: 	loadProtModeStack
                      	    72: 	protModeFaultTest EX_UD, $0, "mov %dx", \arg1 	# #UD: attempt is made to load the CS register.
                      	    73: 	.else
                      	    74: 	mov %dx,%\arg1
                      	    75: 	.endif
                      	    76: 
                      	    77: 	# MOV Sreg to 16 bit reg
                      	    78: 	xor %ax,%ax
                      	    79: 	mov %\arg1,%ax
                      	    80: 	cmp %dx,%ax
                      	    81: 	jne error
                      	    82: 
                      	    83: 	# MOV Sreg to 32 bit reg
                      	    84: 	mov $-1,%eax
                      	    85: 	mov %\arg1,%eax
                      	    86: 	# bits 31:16 are undefined for Pentium and earlier processors.
                      	    87: 	# TODO: verify on real hw and check TEST_UNDEF
                      	    88: 	cmp %dx,%ax
                      	    89: 	jne error
                      	    90: 
                      	    91: 	# MOV Sreg to word mem
                      	    92: 	movl $-1,0
                      	    93: 	mov %\arg1,0
                      	    94: 	cmp %edx,0
                      	    95: 	jne error
                      	    96: 
                      	    97: 	# MOV word mem to Sreg
                      	    98: 	.if \arg1 = cs
                      	    99: 	protModeFaultTest EX_UD, $0, "mov 0", \arg1 # test for #UD
                      	   100: 	.else
                      	   101: 	mov %ds,%cx 	# save current DS in CX
                      	   102: 	mov $DTEST_SEG_PROT,%ax
                      	   103: 	mov %ax,%\arg1
                      	   104: 	.if %1 = ds
                      	   105: 	mov %cx,%es
                      	   106: 	mov %es:0,%\arg1
                      	   107: 	.else
                      	   108: 	mov 0,%\arg1
                      	   109: 	.endif
                      	   110: 	mov %\arg1,%ax
                      	   111: 	cmp %dx,%ax
                      	   112: 	jne error
                      	   113: 	.endif
                      	   114: 
                      	   115: 	loadProtModeStack
                      	   116: 	.if \arg1 = ss
                      	   117: 	# #GP(0) If attempt is made to load SS register with NULL segment selector.
                      	   118: 	mov $NULL,%ax
                      	   119: 	protModeFaultTest EX_GP, $0, "mov %ax", \arg1
                      	   120: 	# #GP(selector) If the SS register is being loaded and the segment selector's RPL and the segment descriptor’s DPL are
                      	   121: 	mov $DPL1_SEG_PROT|1,%ax
                      	   122: 	protModeFaultTest EX_GP, $DPL1_SEG_PROT, "mov %ax" ,\arg1
                      	   123: 	# #GP(selector) If the SS register is being loaded and the segment pointed to is a non-writable data segment.
                      	   124: 	mov $RO_SEG_PROT,%ax
                      	   125: 	protModeFaultTest EX_GP, $RO_SEG_PROT, "mov %ax", \arg1
                      	   126: 	# #SS(selector) If the SS register is being loaded and the segment pointed to is marked not present.
                      	   127: 	mov $NP_SEG_PROT,%ax
                      	   128: 	protModeFaultTest EX_SS, $NP_SEG_PROT, "mov %ax", \arg1
                      	   129: 	.endif
                      	   130: 	.if \arg1 != cs
                      	   131: 	# #GP(selector) If segment selector index is outside descriptor table limits.
                      	   132: 	mov $0xFFF8,%ax
                      	   133: 	protModeFaultTest EX_GP, $0xfff8, "mov %ax", \arg1
                      	   134: 	.if \arg1 != ss
                      	   135: 	# #NP(selector) If the DS, ES, FS, or GS register is being loaded and the segment pointed to is marked not present.
                      	   136: 	mov $NP_SEG_PROT,%ax
                      	   137: 	protModeFaultTest EX_NP, $NP_SEG_PROT, "mov %ax", \arg1
                      	   138: 	# #GP(selector) If the DS, ES, FS, or GS register is being loaded and the segment pointed to is not a data or readable
                      	   139: 	mov $SYS_SEG_PROT,%ax
                      	   140: 	protModeFaultTest EX_GP, $SYS_SEG_PROT, "mov %ax", \arg1
                      	   141: 	# #GP(selector)
                      	   142: 	# If the DS, ES, FS, or GS register is being loaded and the segment pointed to is a data or nonconforming code segment
                      	   143: 	call switchToRing3 # CPL=3
                      	   144: 	mov $DTEST_SEG_PROT|3,%ax 	# RPL=3,DPL=0
                      	   145: 	protModeFaultTest EX_GP, $DTEST_SEG_PROT, "mov %ax", \arg1
                      	   146: 	call switchToRing0
                      	   147: 	.endif
                      	   148: 	.endif
                      	   149: 
                      	   150: .endm
                      	   151: 

Source: "t386.asm"
                      	   210: #-------------------------------------------------------------------------------
                      	   211: 	POST $0x03
04:000003D4 B003      	     1M 	movb $0x03,%al
04:000003D6 BA9001    	     2M 	movw $POST_PORT,%dx
04:000003D9 EE        	     3M 	out %al,%dx
                      	   212: #-------------------------------------------------------------------------------
                      	   213: #
                      	   214: #   Move segment registers in real mode
                      	   215: #
                      	   216: .set cs,0
                      	   217: .set ds,1
                      	   218: .set es,2
                      	   219: .set fs,3
                      	   220: .set gs,4
                      	   221: .set ss,5
                      	   222: 	testMovSegR_real ss
                      	     1M 	.if ss = cs
                      	     2M 	mov $C_SEG_REAL,%dx
                      	     3M 	.else
04:000003DA C7C200C0  	     4M 	mov $D1_SEG_REAL,%dx
                      	     5M 	.endif
                      	     6M 
                      	     7M 	# MOV reg to Sreg
                      	     8M 	.if ss = cs
                      	     9M 	realModeFaultTest EX_UD, "mov %dx", ss # test for #UD
                      	    10M 	.else
04:000003DE 8ED2      	    11M 	mov %dx,%ss
                      	    12M 	.endif
                      	    13M 
                      	    14M 	# MOV Sreg to 16 bit reg
04:000003E0 31C0      	    15M 	xor %ax,%ax
04:000003E2 8CD0      	    16M 	mov %ss,%ax
04:000003E4 39D0      	    17M 	cmp %dx,%ax
04:000003E6 0F854014  	    18M 	jne error
                      	    19M 
                      	    20M 	# MOV Sreg to 32 bit reg
04:000003EA 66B8FFFFFF	    21M 	mov $-1,%eax
04:000003EF FF
04:000003F0 668CD0    	    22M 	mov %ss,%eax
                      	    23M 	# bits 31:16 are undefined for Pentium and earlier processors.
                      	    24M 	# TODO: verify on real hw and check TEST_UNDEF
04:000003F3 39D0      	    25M 	cmp %dx,%ax
04:000003F5 0F853114  	    26M 	jne error
                      	    27M 
                      	    28M 	# MOV Sreg to word mem
04:000003F9 C7060000EF	    29M 	movw $0xbeef,0
04:000003FE BE
04:000003FF 8C160000  	    30M 	mov %ss,0
04:00000403 39160000  	    31M 	cmp %dx,0
04:00000407 0F851F14  	    32M 	jne error
                      	    33M 
                      	    34M 	# MOV word mem to Sreg
                      	    35M 	.if ss = cs
                      	    36M 	realModeFaultTest EX_UD, "mov 0", ss # test for #UD
                      	    37M 	.else
04:0000040B 8CD9      	    38M 	mov %ds,%cx	 	# save current DS in CX
04:0000040D 31C0      	    39M 	xor %ax,%ax
04:0000040F 8ED0      	    40M 	mov %ax,%ss
                      	    41M 	.if ss = ds
                      	    42M 	mov %cx,%es
                      	    43M 	mov %es:0,%ss
                      	    44M 	.else
04:00000411 8E160000  	    45M 	mov 0,%ss
                      	    46M 	.endif
04:00000415 8CD0      	    47M 	mov %ss,%ax
04:00000417 39D0      	    48M 	cmp %dx,%ax
04:00000419 0F850D14  	    49M 	jne error
                      	    50M 	.endif
                      	    51M 
                      	   223: 	testMovSegR_real ds
                      	     1M 	.if ds = cs
                      	     2M 	mov $C_SEG_REAL,%dx
                      	     3M 	.else
04:0000041D C7C200C0  	     4M 	mov $D1_SEG_REAL,%dx
                      	     5M 	.endif
                      	     6M 
                      	     7M 	# MOV reg to Sreg
                      	     8M 	.if ds = cs
                      	     9M 	realModeFaultTest EX_UD, "mov %dx", ds # test for #UD
                      	    10M 	.else
04:00000421 8EDA      	    11M 	mov %dx,%ds
                      	    12M 	.endif
                      	    13M 
                      	    14M 	# MOV Sreg to 16 bit reg
04:00000423 31C0      	    15M 	xor %ax,%ax
04:00000425 8CD8      	    16M 	mov %ds,%ax
04:00000427 39D0      	    17M 	cmp %dx,%ax
04:00000429 0F85FD13  	    18M 	jne error
                      	    19M 
                      	    20M 	# MOV Sreg to 32 bit reg
04:0000042D 66B8FFFFFF	    21M 	mov $-1,%eax
04:00000432 FF
04:00000433 668CD8    	    22M 	mov %ds,%eax
                      	    23M 	# bits 31:16 are undefined for Pentium and earlier processors.
                      	    24M 	# TODO: verify on real hw and check TEST_UNDEF
04:00000436 39D0      	    25M 	cmp %dx,%ax
04:00000438 0F85EE13  	    26M 	jne error
                      	    27M 
                      	    28M 	# MOV Sreg to word mem
04:0000043C C7060000EF	    29M 	movw $0xbeef,0
04:00000441 BE
04:00000442 8C1E0000  	    30M 	mov %ds,0
04:00000446 39160000  	    31M 	cmp %dx,0
04:0000044A 0F85DC13  	    32M 	jne error
                      	    33M 
                      	    34M 	# MOV word mem to Sreg
                      	    35M 	.if ds = cs
                      	    36M 	realModeFaultTest EX_UD, "mov 0", ds # test for #UD
                      	    37M 	.else
04:0000044E 8CD9      	    38M 	mov %ds,%cx	 	# save current DS in CX
04:00000450 31C0      	    39M 	xor %ax,%ax
04:00000452 8ED8      	    40M 	mov %ax,%ds
                      	    41M 	.if ds = ds
04:00000454 8EC1      	    42M 	mov %cx,%es
04:00000456 268E1E0000	    43M 	mov %es:0,%ds
                      	    44M 	.else
                      	    45M 	mov 0,%ds
                      	    46M 	.endif
04:0000045B 8CD8      	    47M 	mov %ds,%ax
04:0000045D 39D0      	    48M 	cmp %dx,%ax
04:0000045F 0F85C713  	    49M 	jne error
                      	    50M 	.endif
                      	    51M 
                      	   224: 	testMovSegR_real es
                      	     1M 	.if es = cs
                      	     2M 	mov $C_SEG_REAL,%dx
                      	     3M 	.else
04:00000463 C7C200C0  	     4M 	mov $D1_SEG_REAL,%dx
                      	     5M 	.endif
                      	     6M 
                      	     7M 	# MOV reg to Sreg
                      	     8M 	.if es = cs
                      	     9M 	realModeFaultTest EX_UD, "mov %dx", es # test for #UD
                      	    10M 	.else
04:00000467 8EC2      	    11M 	mov %dx,%es
                      	    12M 	.endif
                      	    13M 
                      	    14M 	# MOV Sreg to 16 bit reg
04:00000469 31C0      	    15M 	xor %ax,%ax
04:0000046B 8CC0      	    16M 	mov %es,%ax
04:0000046D 39D0      	    17M 	cmp %dx,%ax
04:0000046F 0F85B713  	    18M 	jne error
                      	    19M 
                      	    20M 	# MOV Sreg to 32 bit reg
04:00000473 66B8FFFFFF	    21M 	mov $-1,%eax
04:00000478 FF
04:00000479 668CC0    	    22M 	mov %es,%eax
                      	    23M 	# bits 31:16 are undefined for Pentium and earlier processors.
                      	    24M 	# TODO: verify on real hw and check TEST_UNDEF
04:0000047C 39D0      	    25M 	cmp %dx,%ax
04:0000047E 0F85A813  	    26M 	jne error
                      	    27M 
                      	    28M 	# MOV Sreg to word mem
04:00000482 C7060000EF	    29M 	movw $0xbeef,0
04:00000487 BE
04:00000488 8C060000  	    30M 	mov %es,0
04:0000048C 39160000  	    31M 	cmp %dx,0
04:00000490 0F859613  	    32M 	jne error
                      	    33M 
                      	    34M 	# MOV word mem to Sreg
                      	    35M 	.if es = cs
                      	    36M 	realModeFaultTest EX_UD, "mov 0", es # test for #UD
                      	    37M 	.else
04:00000494 8CD9      	    38M 	mov %ds,%cx	 	# save current DS in CX
04:00000496 31C0      	    39M 	xor %ax,%ax
04:00000498 8EC0      	    40M 	mov %ax,%es
                      	    41M 	.if es = ds
                      	    42M 	mov %cx,%es
                      	    43M 	mov %es:0,%es
                      	    44M 	.else
04:0000049A 8E060000  	    45M 	mov 0,%es
                      	    46M 	.endif
04:0000049E 8CC0      	    47M 	mov %es,%ax
04:000004A0 39D0      	    48M 	cmp %dx,%ax
04:000004A2 0F858413  	    49M 	jne error
                      	    50M 	.endif
                      	    51M 
                      	   225: 	testMovSegR_real fs
                      	     1M 	.if fs = cs
                      	     2M 	mov $C_SEG_REAL,%dx
                      	     3M 	.else
04:000004A6 C7C200C0  	     4M 	mov $D1_SEG_REAL,%dx
                      	     5M 	.endif
                      	     6M 
                      	     7M 	# MOV reg to Sreg
                      	     8M 	.if fs = cs
                      	     9M 	realModeFaultTest EX_UD, "mov %dx", fs # test for #UD
                      	    10M 	.else
04:000004AA 8EE2      	    11M 	mov %dx,%fs
                      	    12M 	.endif
                      	    13M 
                      	    14M 	# MOV Sreg to 16 bit reg
04:000004AC 31C0      	    15M 	xor %ax,%ax
04:000004AE 8CE0      	    16M 	mov %fs,%ax
04:000004B0 39D0      	    17M 	cmp %dx,%ax
04:000004B2 0F857413  	    18M 	jne error
                      	    19M 
                      	    20M 	# MOV Sreg to 32 bit reg
04:000004B6 66B8FFFFFF	    21M 	mov $-1,%eax
04:000004BB FF
04:000004BC 668CE0    	    22M 	mov %fs,%eax
                      	    23M 	# bits 31:16 are undefined for Pentium and earlier processors.
                      	    24M 	# TODO: verify on real hw and check TEST_UNDEF
04:000004BF 39D0      	    25M 	cmp %dx,%ax
04:000004C1 0F856513  	    26M 	jne error
                      	    27M 
                      	    28M 	# MOV Sreg to word mem
04:000004C5 C7060000EF	    29M 	movw $0xbeef,0
04:000004CA BE
04:000004CB 8C260000  	    30M 	mov %fs,0
04:000004CF 39160000  	    31M 	cmp %dx,0
04:000004D3 0F855313  	    32M 	jne error
                      	    33M 
                      	    34M 	# MOV word mem to Sreg
                      	    35M 	.if fs = cs
                      	    36M 	realModeFaultTest EX_UD, "mov 0", fs # test for #UD
                      	    37M 	.else
04:000004D7 8CD9      	    38M 	mov %ds,%cx	 	# save current DS in CX
04:000004D9 31C0      	    39M 	xor %ax,%ax
04:000004DB 8EE0      	    40M 	mov %ax,%fs
                      	    41M 	.if fs = ds
                      	    42M 	mov %cx,%es
                      	    43M 	mov %es:0,%fs
                      	    44M 	.else
04:000004DD 8E260000  	    45M 	mov 0,%fs
                      	    46M 	.endif
04:000004E1 8CE0      	    47M 	mov %fs,%ax
04:000004E3 39D0      	    48M 	cmp %dx,%ax
04:000004E5 0F854113  	    49M 	jne error
                      	    50M 	.endif
                      	    51M 
                      	   226: 	testMovSegR_real gs
                      	     1M 	.if gs = cs
                      	     2M 	mov $C_SEG_REAL,%dx
                      	     3M 	.else
04:000004E9 C7C200C0  	     4M 	mov $D1_SEG_REAL,%dx
                      	     5M 	.endif
                      	     6M 
                      	     7M 	# MOV reg to Sreg
                      	     8M 	.if gs = cs
                      	     9M 	realModeFaultTest EX_UD, "mov %dx", gs # test for #UD
                      	    10M 	.else
04:000004ED 8EEA      	    11M 	mov %dx,%gs
                      	    12M 	.endif
                      	    13M 
                      	    14M 	# MOV Sreg to 16 bit reg
04:000004EF 31C0      	    15M 	xor %ax,%ax
04:000004F1 8CE8      	    16M 	mov %gs,%ax
04:000004F3 39D0      	    17M 	cmp %dx,%ax
04:000004F5 0F853113  	    18M 	jne error
                      	    19M 
                      	    20M 	# MOV Sreg to 32 bit reg
04:000004F9 66B8FFFFFF	    21M 	mov $-1,%eax
04:000004FE FF
04:000004FF 668CE8    	    22M 	mov %gs,%eax
                      	    23M 	# bits 31:16 are undefined for Pentium and earlier processors.
                      	    24M 	# TODO: verify on real hw and check TEST_UNDEF
04:00000502 39D0      	    25M 	cmp %dx,%ax
04:00000504 0F852213  	    26M 	jne error
                      	    27M 
                      	    28M 	# MOV Sreg to word mem
04:00000508 C7060000EF	    29M 	movw $0xbeef,0
04:0000050D BE
04:0000050E 8C2E0000  	    30M 	mov %gs,0
04:00000512 39160000  	    31M 	cmp %dx,0
04:00000516 0F851013  	    32M 	jne error
                      	    33M 
                      	    34M 	# MOV word mem to Sreg
                      	    35M 	.if gs = cs
                      	    36M 	realModeFaultTest EX_UD, "mov 0", gs # test for #UD
                      	    37M 	.else
04:0000051A 8CD9      	    38M 	mov %ds,%cx	 	# save current DS in CX
04:0000051C 31C0      	    39M 	xor %ax,%ax
04:0000051E 8EE8      	    40M 	mov %ax,%gs
                      	    41M 	.if gs = ds
                      	    42M 	mov %cx,%es
                      	    43M 	mov %es:0,%gs
                      	    44M 	.else
04:00000520 8E2E0000  	    45M 	mov 0,%gs
                      	    46M 	.endif
04:00000524 8CE8      	    47M 	mov %gs,%ax
04:00000526 39D0      	    48M 	cmp %dx,%ax
04:00000528 0F85FE12  	    49M 	jne error
                      	    50M 	.endif
                      	    51M 
                      	   227: 	testMovSegR_real cs
                      	     1M 	.if cs = cs
04:0000052C BA0000    	     2M 	mov $C_SEG_REAL,%dx
                      	     3M 	.else
                      	     4M 	mov $D1_SEG_REAL,%dx
                      	     5M 	.endif
                      	     6M 
                      	     7M 	# MOV reg to Sreg
                      	     8M 	.if cs = cs
                      	     9M 	realModeFaultTest EX_UD, "mov %dx", cs # test for #UD
                      	     1M 	realModeExcInit EX_UD,continue25
04:0000052F B80090    	     1M 	mov $IDT_SEG_REAL,%ax
04:00000532 8ED8      	     2M 	mov %ax,%ds
04:00000534 C70618004D	     3M 	movw $continue25,EX_UD*4
04:00000539 05
04:0000053A C7061A0000	     4M 	movw $C_SEG_REAL,EX_UD*4+2
04:0000053F 00
04:00000540 B800C0    	     2M 	mov $S_SEG_REAL,%ax
04:00000543 8ED0      	     3M 	mov %ax,%ss
04:00000545 BCFC7F    	     4M 	mov $ESP_REAL,%sp
                      	     5M test25:
04:00000548 8ECA      	     6M 	mov %dx,%cs
04:0000054A E9DD12    	     7M 	jmp error
                      	     8M continue25:
                      	     9M 	realModeExcCheck EX_UD,test25
04:0000054D 81FCF67F  	     1M 	cmp $ESP_REAL-6,%sp
04:00000551 0F85D512  	     2M 	jne error
04:00000555 36833EF87F	     3M 	cmpw $C_SEG_REAL,%ss:ESP_REAL-4
04:0000055A 00
04:0000055B 36813EF67F	     4M 	cmpw $test25,%ss:ESP_REAL-6
04:00000560 4805
04:00000562 0F85C412  	     5M 	jne error
04:00000566 B80000    	     6M 	mov $0,%ax
04:00000569 8ED8      	     7M 	mov %ax,%ds
04:0000056B C70618002A	     8M 	movw $error,EX_UD*4
04:00000570 18
04:00000571 C7061A0000	     9M 	movw $C_SEG_REAL,EX_UD*4+2
04:00000576 00
                      	    10M 	.else
                      	    11M 	mov %dx,%cs
                      	    12M 	.endif
                      	    13M 
                      	    14M 	# MOV Sreg to 16 bit reg
04:00000577 31C0      	    15M 	xor %ax,%ax
04:00000579 8CC8      	    16M 	mov %cs,%ax
04:0000057B 39D0      	    17M 	cmp %dx,%ax
04:0000057D 0F85A912  	    18M 	jne error
                      	    19M 
                      	    20M 	# MOV Sreg to 32 bit reg
04:00000581 66B8FFFFFF	    21M 	mov $-1,%eax
04:00000586 FF
04:00000587 668CC8    	    22M 	mov %cs,%eax
                      	    23M 	# bits 31:16 are undefined for Pentium and earlier processors.
                      	    24M 	# TODO: verify on real hw and check TEST_UNDEF
04:0000058A 39D0      	    25M 	cmp %dx,%ax
04:0000058C 0F859A12  	    26M 	jne error
                      	    27M 
                      	    28M 	# MOV Sreg to word mem
04:00000590 C7060000EF	    29M 	movw $0xbeef,0
04:00000595 BE
04:00000596 8C0E0000  	    30M 	mov %cs,0
04:0000059A 39160000  	    31M 	cmp %dx,0
04:0000059E 0F858812  	    32M 	jne error
                      	    33M 
                      	    34M 	# MOV word mem to Sreg
                      	    35M 	.if cs = cs
                      	    36M 	realModeFaultTest EX_UD, "mov 0", cs # test for #UD
                      	     1M 	realModeExcInit EX_UD,continue28
04:000005A2 B80090    	     1M 	mov $IDT_SEG_REAL,%ax
04:000005A5 8ED8      	     2M 	mov %ax,%ds
04:000005A7 C7061800C2	     3M 	movw $continue28,EX_UD*4
04:000005AC 05
04:000005AD C7061A0000	     4M 	movw $C_SEG_REAL,EX_UD*4+2
04:000005B2 00
04:000005B3 B800C0    	     2M 	mov $S_SEG_REAL,%ax
04:000005B6 8ED0      	     3M 	mov %ax,%ss
04:000005B8 BCFC7F    	     4M 	mov $ESP_REAL,%sp
                      	     5M test28:
04:000005BB 8E0E0000  	     6M 	mov 0,%cs
04:000005BF E96812    	     7M 	jmp error
                      	     8M continue28:
                      	     9M 	realModeExcCheck EX_UD,test28
04:000005C2 81FCF67F  	     1M 	cmp $ESP_REAL-6,%sp
04:000005C6 0F856012  	     2M 	jne error
04:000005CA 36833EF87F	     3M 	cmpw $C_SEG_REAL,%ss:ESP_REAL-4
04:000005CF 00
04:000005D0 36813EF67F	     4M 	cmpw $test28,%ss:ESP_REAL-6
04:000005D5 BB05
04:000005D7 0F854F12  	     5M 	jne error
04:000005DB B80000    	     6M 	mov $0,%ax
04:000005DE 8ED8      	     7M 	mov %ax,%ds
04:000005E0 C70618002A	     8M 	movw $error,EX_UD*4
04:000005E5 18
04:000005E6 C7061A0000	     9M 	movw $C_SEG_REAL,EX_UD*4+2
04:000005EB 00
                      	    37M 	.else
                      	    38M 	mov %ds,%cx	 	# save current DS in CX
                      	    39M 	xor %ax,%ax
                      	    40M 	mov %ax,%cs
                      	    41M 	.if cs = ds
                      	    42M 	mov %cx,%es
                      	    43M 	mov %es:0,%cs
                      	    44M 	.else
                      	    45M 	mov 0,%cs
                      	    46M 	.endif
                      	    47M 	mov %cs,%ax
                      	    48M 	cmp %dx,%ax
                      	    49M 	jne error
                      	    50M 	.endif
                      	    51M 
                      	   228: 
                      	   229: 	advTestSegReal
                      	     1M 	advTestBase
                      	     1M 	.set TEST_BASE1,TEST_BASE1+0x1000
                      	     2M 	.set TEST_BASE2,TEST_BASE2+0x1000
                      	     2M 	.set D1_SEG_REAL,TEST_BASE1 >> 4
                      	     3M 	.set D2_SEG_REAL,TEST_BASE2 >> 4
04:000005EC C7C200C1  	     4M 	mov $D1_SEG_REAL,%dx
04:000005F0 8EDA      	     5M 	mov %dx,%ds
04:000005F2 C7C200C3  	     6M 	mov $D2_SEG_REAL,%dx
04:000005F6 8EC2      	     7M 	mov %dx,%es
                      	   230: 
                      	   231: .include "string_m.asm"

Source: "string_m.asm"
                      	     1: #
                      	     2: #   Tests store, compare, scan, and move string operands
                      	     3: #   %1 data size b=byte, w=word, d=dword
                      	     4: #   %2 direction 0=increment, 1=decrement
                      	     5: #   %3 addressing a16=16-bit, a32=32-bit
                      	     6: #   DS test segment 1
                      	     7: #   ES test segment 2
                      	     8: #
                      	     9: .macro testStringOps arg1,arg2,arg3
                      	    10: 
                      	    11: 	.set value,0x12345678
                      	    12: 	.if \arg1 = b
                      	    13: 		.set val_size,1
                      	    14: 		.set val_mask,0x000000ff
                      	    15: 	.endif
                      	    16: 	.if \arg1 = w
                      	    17: 		.set val_size,2
                      	    18: 		.set val_mask,0x0000ffff
                      	    19: 	.endif
                      	    20: 	.if \arg1 = d
                      	    21: 		.set val_size,4
                      	    22: 		.set val_mask,0xffffffff
                      	    23: 	.endif
                      	    24: 
                      	    25: 	.if \arg2 == 0
                      	    26: 		cld
                      	    27: 		.set off_value,0x0001ffff-(val_size-1)
                      	    28: 		.if \arg3 = 16
                      	    29: 			# 16-bit addressing
                      	    30: 			.set off_cmp,0x00010000
                      	    31: 		.else
                      	    32: 			# 32-bit addressing
                      	    33: 			.set off_cmp,0x00020000
                      	    34: 		.endif
                      	    35: 	.else
                      	    36: 		std
                      	    37: 		.set off_value,0x00010000
                      	    38: 		.if \arg3 = 16
                      	    39: 			# 16-bit addressing
                      	    40: 			.set off_cmp,0x0001ffff-(val_size-1)
                      	    41: 		.else
                      	    42: 			# 32-bit addressing
                      	    43: 			.set off_cmp,0x0000ffff-(val_size-1)
                      	    44: 		.endif
                      	    45: 	.endif
                      	    46: 
                      	    47: 	.if \arg3 = 16
                      	    48: 		.set off_mask,0x0000ffff
                      	    49: 	.else
                      	    50: 		.set off_mask,0xffffffff
                      	    51: 	.endif
                      	    52: 
                      	    53: 	# VERIFY string operands
                      	    54: 	.if \arg1 = b
                      	    55: 		mov $off_value,%edi
                      	    56: 		mov $off_value & off_mask,%ebx
                      	    57: 		mov $0,%al
                      	    58: 		mov %al,%es:(%ebx)
                      	    59: 		mov $value,%al
                      	    60: 		addr\arg3
                      	    61: 		stosb		 	# STORE EAX in ES:EDI
                      	    62: 		cmp %al,%es:(%ebx)
                      	    63: 		jne error
                      	    64: 		cmp $off_cmp,%edi
                      	    65: 		jne error
                      	    66: 
                      	    67: 		mov $off_value,%esi
                      	    68: 		mov $off_value,%edi
                      	    69: 		mov $off_value & off_mask,%ebx
                      	    70: 		mov %al,%ds:(%ebx)
                      	    71: 		mov %al,%es:(%ebx)
                      	    72: 		cmp $0,%al
                      	    73: 		je error
                      	    74: 		addr\arg3
                      	    75: 		cmpsb     # COMPARE ES:EDI with DS:ESI
                      	    76: 		jne error
                      	    77: 		cmp $off_cmp,%edi
                      	    78: 		jne error
                      	    79: 		cmp $off_cmp,%esi
                      	    80: 		jne error
                      	    81: 
                      	    82: 		mov $off_value,%edi
                      	    83: 		mov $value,%al
                      	    84: 		mov %al,%es:(%ebx)
                      	    85: 		cmp $0,%al
                      	    86: 		addr\arg3
                      	    87: 		scasb     # SCAN/COMPARE ES:EDI with EAX
                      	    88: 		jne error
                      	    89: 		cmp $off_cmp,%edi
                      	    90: 		jne error
                      	    91: 
                      	    92: 		mov $off_value,%esi
                      	    93: 		mov $off_value,%edi
                      	    94: 		mov $value,%al
                      	    95: 		mov %al,%ds:(%ebx)
                      	    96: 		mov $0,%al
                      	    97: 		mov %al,%es:(%ebx)
                      	    98: 		addr\arg3
                      	    99: 		movsb        # MOVE data from DS:ESI to ES:EDI
                      	   100: 		mov $value,%al
                      	   101: 		cmp %al,%es:(%ebx)
                      	   102: 		jne error
                      	   103: 		cmp $off_cmp,%edi
                      	   104: 		jne error
                      	   105: 		cmp $off_cmp,%esi
                      	   106: 		jne error
                      	   107: 
                      	   108: 		mov $off_value,%esi
                      	   109: 		mov $value,%al
                      	   110: 		mov %al,%es:(%ebx)
                      	   111: 		xor %eax,%eax
                      	   112: 		addr\arg3
                      	   113: 		lodsb       # LOAD data from DS:ESI into EAX
                      	   114: 		cmp $value & val_mask,%al
                      	   115: 		jne error
                      	   116: 		cmp $off_cmp,%esi
                      	   117: 		jne error
                      	   118: 	.endif
                      	   119: 
                      	   120: 	.if \arg1 = w
                      	   121: 		mov $off_value,%edi
                      	   122: 		mov $off_value & off_mask,%ebx
                      	   123: 		mov $0,%ax
                      	   124: 		mov %ax,%es:(%ebx)
                      	   125: 		mov $value,%ax
                      	   126: 		addr\arg3
                      	   127: 		stosw     # STORE EAX in ES:EDI
                      	   128: 		cmp %ax,%es:(%ebx)
                      	   129: 		jne error
                      	   130: 		cmp $off_cmp,%edi
                      	   131: 		jne error
                      	   132: 
                      	   133: 		mov $off_value,%esi
                      	   134: 		mov $off_value,%edi
                      	   135: 		mov $off_value & off_mask,%ebx
                      	   136: 		mov %ax,%ds:(%ebx)
                      	   137: 		mov %ax,%es:(%ebx)
                      	   138: 		cmp $0,%ax
                      	   139: 		je error
                      	   140: 		addr\arg3
                      	   141: 		cmpsw     # COMPARE ES:EDI with DS:ESI
                      	   142: 		jne error
                      	   143: 		cmp $off_cmp,%edi
                      	   144: 		jne error
                      	   145: 		cmp $off_cmp,%esi
                      	   146: 		jne error
                      	   147: 
                      	   148: 		mov $off_value,%edi
                      	   149: 		mov $value,%ax
                      	   150: 		mov %ax,%es:(%ebx)
                      	   151: 		cmp $0,%ax
                      	   152: 		addr\arg3
                      	   153: 		scasw     # SCAN/COMPARE ES:EDI with EAX
                      	   154: 		jne error
                      	   155: 		cmp $off_cmp,%edi
                      	   156: 		jne error
                      	   157: 
                      	   158: 		mov $off_value,%esi
                      	   159: 		mov $off_value,%edi
                      	   160: 		mov $value,%ax
                      	   161: 		mov %ax,%ds:(%ebx)
                      	   162: 		mov $0,%ax
                      	   163: 		mov %ax,%es:(%ebx)
                      	   164: 		addr\arg3
                      	   165: 		movsw 					# MOVE data from DS:ESI to ES:EDI
                      	   166: 		mov $value,%ax
                      	   167: 		cmp %ax,%es:(%ebx)
                      	   168: 		jne error
                      	   169: 		cmp $off_cmp,%edi
                      	   170: 		jne error
                      	   171: 		cmp $off_cmp,%esi
                      	   172: 		jne error
                      	   173: 
                      	   174: 		mov $off_value,%esi
                      	   175: 		mov $value,%ax
                      	   176: 		mov %ax,%es:(%ebx)
                      	   177: 		xor %eax,%eax
                      	   178: 		addr\arg3
                      	   179: 		lodsw       # LOAD data from DS:ESI into EAX
                      	   180: 		cmp $value & val_mask,%ax
                      	   181: 		jne error
                      	   182: 		cmp $off_cmp,%esi
                      	   183: 		jne error
                      	   184: 	.endif
                      	   185: 
                      	   186: 	.if \arg1 = d
                      	   187: 		mov $off_value,%edi
                      	   188: 		mov $off_value & off_mask,%ebx
                      	   189: 		mov $0,%eax
                      	   190: 		mov %eax,%es:(%ebx)
                      	   191: 		mov $value,%eax
                      	   192: 		addr\arg3
                      	   193: 		stosl     # STORE EAX in ES:EDI
                      	   194: 		cmp %eax,%es:(%ebx)
                      	   195: 		jne error
                      	   196: 		cmp $off_cmp,%edi
                      	   197: 		jne error
                      	   198: 
                      	   199: 		mov $off_value,%esi
                      	   200: 		mov $off_value,%edi
                      	   201: 		mov $off_value & off_mask,%ebx
                      	   202: 		mov %eax,%ds:(%ebx)
                      	   203: 		mov %eax,%es:(%ebx)
                      	   204: 		cmp $0,%eax
                      	   205: 		je error
                      	   206: 		addr\arg3
                      	   207: 		cmpsl     # COMPARE ES:EDI with DS:ESI
                      	   208: 		jne error
                      	   209: 		cmp $off_cmp,%edi
                      	   210: 		jne error
                      	   211: 		cmp $off_cmp,%esi
                      	   212: 		jne error
                      	   213: 
                      	   214: 		mov $off_value,%edi
                      	   215: 		mov $value,%eax
                      	   216: 		mov %eax,%es:(%ebx)
                      	   217: 		cmp $0,%eax
                      	   218: 		addr\arg3
                      	   219: 		scasl     # SCAN/COMPARE ES:EDI with EAX
                      	   220: 		jne error
                      	   221: 		cmp $off_cmp,%edi
                      	   222: 		jne error
                      	   223: 
                      	   224: 		mov $off_value,%esi
                      	   225: 		mov $off_value,%edi
                      	   226: 		mov $value,%eax
                      	   227: 		mov %eax,%ds:(%ebx)
                      	   228: 		mov $0,%eax
                      	   229: 		mov %eax,%es:(%ebx)
                      	   230: 		addr\arg3
                      	   231: 		movsl        # MOVE data from DS:ESI to ES:EDI
                      	   232: 		mov $value,%eax
                      	   233: 		cmp %eax,%es:(%ebx)
                      	   234: 		jne error
                      	   235: 		cmp $off_cmp,%edi
                      	   236: 		jne error
                      	   237: 		cmp $off_cmp,%esi
                      	   238: 		jne error
                      	   239: 
                      	   240: 		mov $off_value,%esi
                      	   241: 		mov $value,%eax
                      	   242: 		mov %eax,%es:(%ebx)
                      	   243: 		xor %eax,%eax
                      	   244: 		addr\arg3
                      	   245: 		lodsl       # LOAD data from DS:ESI into EAX
                      	   246: 		cmp $value & val_mask,%eax
                      	   247: 		jne error
                      	   248: 		cmp $off_cmp,%esi
                      	   249: 		jne error
                      	   250: 	.endif
                      	   251: 
                      	   252: .endm
                      	   253: 
                      	   254: #
                      	   255: #   Tests store, compare, scan, and move string operands with repetitions
                      	   256: #   %1 element size b=byte, w=word, d=dword
                      	   257: #   %2 direction 0=increment, 1=decrement
                      	   258: #   %3 addressing a16=16-bit, a32=32-bit
                      	   259: #   DS test segment 1
                      	   260: #   ES test segment 2
                      	   261: #
                      	   262: .macro testStringReps arg1,arg2,arg3
                      	   263: 
                      	   264: 	.set bytes,0x100
                      	   265: 
                      	   266: 	.if \arg1 = b
                      	   267: 		.set items,bytes
                      	   268: 	.endif
                      	   269: 	.if \arg1 = w
                      	   270: 		.set items,bytes/2
                      	   271: 	.endif
                      	   272: 	.if \arg1 = d
                      	   273: 		.set items,bytes/4
                      	   274: 	.endif
                      	   275: 
                      	   276: 	.if \arg2 == 0
                      	   277: 		cld
                      	   278: 		.set off_value,0x0001ff00
                      	   279: 		.if \arg3 = 16
                      	   280: 			# 16-bit addressing
                      	   281: 			.set off_cmp,0x00010000
                      	   282: 		.else
                      	   283: 			# 32-bit addressing
                      	   284: 			.set off_cmp,0x00020000
                      	   285: 		.endif
                      	   286: 	.else
                      	   287: 		std
                      	   288: 		.set off_value,0x000100ff
                      	   289: 		.if \arg3 = 16
                      	   290: 			# 16-bit addressing
                      	   291: 			.set off_cmp,0x0001ffff
                      	   292: 		.else
                      	   293: 			# 32-bit addressing
                      	   294: 			.set off_cmp,0x0000ffff
                      	   295: 		.endif
                      	   296: 	.endif
                      	   297: 
                      	   298: 	mov $0x12345678,%eax
                      	   299: 	mov $off_value,%esi
                      	   300: 	mov $off_value,%edi
                      	   301: 
                      	   302: 	# VERIFY REPs on memory buffers
                      	   303: 
                      	   304: 	# STORE buffers with pattern in EAX
                      	   305: 	mov $0x12345678,%eax
                      	   306: 	mov $off_value,%esi
                      	   307: 	mov $off_value,%edi
                      	   308: 	mov $items,%ecx
                      	   309: 	.if \arg1 = b
                      	   310: 		addr\arg3
                      	   311: 		rep
                      	   312: 		stosb    # store ECX items at ES:EDI with the value in EAX
                      	   313: 	.endif
                      	   314: 	.if \arg1 = w
                      	   315: 		addr\arg3
                      	   316: 		rep
                      	   317: 		stosw    # store ECX items at ES:EDI with the value in EAX
                      	   318: 	.endif
                      	   319: 	.if \arg1 = d
                      	   320: 		addr\arg3
                      	   321: 		rep
                      	   322: 		stosl    # store ECX items at ES:EDI with the value in EAX
                      	   323: 	.endif
                      	   324: 	cmp $0,%ecx
                      	   325: 	jnz error           		# ECX must be 0
                      	   326: 	cmp $off_cmp,%edi
                      	   327: 	jnz error
                      	   328: 	mov $off_value,%edi  # reset EDI
                      	   329: 	# now switch ES:EDI with DS:ESI
                      	   330: 	mov %es,%dx
                      	   331: 	mov %ds,%cx
                      	   332: 	xchg %cx,%dx
                      	   333: 	mov %dx,%es
                      	   334: 	mov %cx,%ds
                      	   335: 	xchg %esi,%edi
                      	   336: 	# store again ES:EDI with pattern in EAX
                      	   337: 	mov $items,%ecx      	# reset ECX
                      	   338: 	.if \arg1 = b
                      	   339: 		addr\arg3
                      	   340: 		rep
                      	   341: 		stosb
                      	   342: 	.endif
                      	   343: 	.if \arg1 = w
                      	   344: 		addr\arg3
                      	   345: 		rep
                      	   346: 		stosw
                      	   347: 	.endif
                      	   348: 	.if \arg1 = d
                      	   349: 		addr\arg3
                      	   350: 		rep
                      	   351: 		stosl
                      	   352: 	.endif
                      	   353: 	mov $off_value,%edi  	# reset EDI
                      	   354: 
                      	   355: 	# COMPARE two buffers
                      	   356: 	mov $items,%ecx      # reset ECX
                      	   357: 	.if \arg1 = b
                      	   358: 		addr\arg3
                      	   359: 		repe
                      	   360: 		cmpsb # find nonmatching items in ES:EDI and DS:ESI
                      	   361: 	.endif
                      	   362: 	.if \arg1 = w
                      	   363: 		addr\arg3
                      	   364: 		repe
                      	   365: 		cmpsw # find nonmatching items in ES:EDI and DS:ESI
                      	   366: 	.endif
                      	   367: 	.if \arg1 = d
                      	   368: 		addr\arg3
                      	   369: 		repe
                      	   370: 		cmpsl # find nonmatching items in ES:EDI and DS:ESI
                      	   371: 	.endif
                      	   372: 	cmp $0,%ecx
                      	   373: 	jnz error           		# ECX must be 0
                      	   374: 	cmp $off_cmp,%esi
                      	   375: 	jne error
                      	   376: 	cmp $off_cmp,%edi
                      	   377: 	jne error
                      	   378: 	mov $off_value,%edi  # reset EDI
                      	   379: 	mov $off_value,%esi  # reset ESI
                      	   380: 
                      	   381: 	# SCAN buffer for pattern
                      	   382: 	mov $items,%ecx      # reset ECX
                      	   383: 	.if \arg1 = b
                      	   384: 		addr\arg3
                      	   385: 		repe
                      	   386: 		scasb         # SCAN first dword not equal to EAX
                      	   387: 	.endif
                      	   388: 	.if \arg1 = w
                      	   389: 		addr\arg3
                      	   390: 		repe
                      	   391: 		scasw         # SCAN first dword not equal to EAX
                      	   392: 	.endif
                      	   393: 	.if \arg1 = d
                      	   394: 		addr\arg3
                      	   395: 		repe
                      	   396: 		scasl         # SCAN first dword not equal to EAX
                      	   397: 	.endif
                      	   398: 	cmp $0,%ecx
                      	   399: 	jne error           		# ECX must be 0
                      	   400: 	cmp $off_cmp,%edi
                      	   401: 	jne error
                      	   402: 	mov $off_value,%edi  		# rewind EDI
                      	   403: 
                      	   404: 	# MOVE and COMPARE data between buffers
                      	   405: 	# first zero-fill ES:EDI so that we can compare the moved data later
                      	   406: 	mov $0,%eax
                      	   407: 	mov $items,%ecx      # reset ECX
                      	   408: 	.if \arg1 = b
                      	   409: 		addr\arg3
                      	   410: 		rep
                      	   411: 		stosb          # zero fill ES:EDI
                      	   412: 	.endif
                      	   413: 	.if \arg1 = w
                      	   414: 		addr\arg3
                      	   415: 		rep
                      	   416: 		stosw          # zero fill ES:EDI
                      	   417: 	.endif
                      	   418: 	.if \arg1 = d
                      	   419: 		addr\arg3
                      	   420: 		rep
                      	   421: 		stosl          # zero fill ES:EDI
                      	   422: 	.endif
                      	   423: 	mov $off_value,%edi  # reset EDI
                      	   424: 	mov $items,%ecx      # reset ECX
                      	   425: 	.if \arg1 = b
                      	   426: 		addr\arg3
                      	   427: 		rep
                      	   428: 		movsb          # MOVE data from DS:ESI to ES:EDI
                      	   429: 	.endif
                      	   430: 	.if \arg1 = w
                      	   431: 		addr\arg3
                      	   432: 		rep
                      	   433: 		movsw          # MOVE data from DS:ESI to ES:EDI
                      	   434: 	.endif
                      	   435: 	.if \arg1 = d
                      	   436: 		addr\arg3
                      	   437: 		rep
                      	   438: 		movsl          # MOVE data from DS:ESI to ES:EDI
                      	   439: 	.endif
                      	   440: 	cmp $0,%ecx
                      	   441: 	jne error           	# ECX must be 0
                      	   442: 	cmp $off_cmp,%esi
                      	   443: 	jne error
                      	   444: 	cmp $off_cmp,%edi
                      	   445: 	jne error
                      	   446: 	mov $items,%ecx      	# reset ECX
                      	   447: 	mov $off_value,%edi  	# reset EDI
                      	   448: 	mov $off_value,%esi  	# reset ESI
                      	   449: 	.if \arg1 = b
                      	   450: 		addr\arg3
                      	   451: 		repe
                      	   452: 		cmpsb  # COMPARE moved data in ES:EDI with DS:ESI
                      	   453: 	.endif
                      	   454: 	.if \arg1 = w
                      	   455: 		addr\arg3
                      	   456: 		repe
                      	   457: 		cmpsw  # COMPARE moved data in ES:EDI with DS:ESI
                      	   458: 	.endif
                      	   459: 	.if \arg1 = d
                      	   460: 		addr\arg3
                      	   461: 		repe
                      	   462: 		cmpsl  # COMPARE moved data in ES:EDI with DS:ESI
                      	   463: 	.endif
                      	   464: 	cmp $0,%ecx
                      	   465: 	jne error           # ECX must be 0
                      	   466: 	cmp $off_cmp,%esi
                      	   467: 	jne error
                      	   468: 	cmp $off_cmp,%edi
                      	   469: 	jne error
                      	   470: .endm
                      	   471: 

Source: "t386.asm"
                      	   232: #-------------------------------------------------------------------------------
                      	   233: 	POST $0x04
04:000005F8 B004      	     1M 	movb $0x04,%al
04:000005FA BA9001    	     2M 	movw $POST_PORT,%dx
04:000005FD EE        	     3M 	out %al,%dx
                      	   234: #-------------------------------------------------------------------------------
                      	   235: #
                      	   236: #   Test store, move, scan, and compare string data
                      	   237: #
                      	   238: .set b,0
                      	   239: .set w,1
                      	   240: .set d,2
                      	   241: 
                      	   242: 	testStringOps b,0,16
                      	     1M 
                      	     2M 	.set value,0x12345678
                      	     3M 	.if b = b
                      	     4M 		.set val_size,1
                      	     5M 		.set val_mask,0x000000ff
                      	     6M 	.endif
                      	     7M 	.if b = w
                      	     8M 		.set val_size,2
                      	     9M 		.set val_mask,0x0000ffff
                      	    10M 	.endif
                      	    11M 	.if b = d
                      	    12M 		.set val_size,4
                      	    13M 		.set val_mask,0xffffffff
                      	    14M 	.endif
                      	    15M 
                      	    16M 	.if 0 == 0
04:000005FE FC        	    17M 		cld
                      	    18M 		.set off_value,0x0001ffff-(val_size-1)
                      	    19M 		.if 16 = 16
                      	    20M 			# 16-bit addressing
                      	    21M 			.set off_cmp,0x00010000
                      	    22M 		.else
                      	    23M 			# 32-bit addressing
                      	    24M 			.set off_cmp,0x00020000
                      	    25M 		.endif
                      	    26M 	.else
                      	    27M 		std
                      	    28M 		.set off_value,0x00010000
                      	    29M 		.if 16 = 16
                      	    30M 			# 16-bit addressing
                      	    31M 			.set off_cmp,0x0001ffff-(val_size-1)
                      	    32M 		.else
                      	    33M 			# 32-bit addressing
                      	    34M 			.set off_cmp,0x0000ffff-(val_size-1)
                      	    35M 		.endif
                      	    36M 	.endif
                      	    37M 
                      	    38M 	.if 16 = 16
                      	    39M 		.set off_mask,0x0000ffff
                      	    40M 	.else
                      	    41M 		.set off_mask,0xffffffff
                      	    42M 	.endif
                      	    43M 
                      	    44M 	# VERIFY string operands
                      	    45M 	.if b = b
04:000005FF 66BFFFFF01	    46M 		mov $off_value,%edi
04:00000604 00
04:00000605 66BBFFFF00	    47M 		mov $off_value & off_mask,%ebx
04:0000060A 00
04:0000060B B000      	    48M 		mov $0,%al
04:0000060D 268803    	    49M 		mov %al,%es:(%ebx)
04:00000610 C6C078    	    50M 		mov $value,%al
04:00000613 67        	    51M 		addr16
04:00000614 AA        	    52M 		stosb		 	# STORE EAX in ES:EDI
04:00000615 263803    	    53M 		cmp %al,%es:(%ebx)
04:00000618 0F850E12  	    54M 		jne error
04:0000061C 6681FF0000	    55M 		cmp $off_cmp,%edi
04:00000621 0100
04:00000623 0F850312  	    56M 		jne error
                      	    57M 
04:00000627 66BEFFFF01	    58M 		mov $off_value,%esi
04:0000062C 00
04:0000062D 66BFFFFF01	    59M 		mov $off_value,%edi
04:00000632 00
04:00000633 66BBFFFF00	    60M 		mov $off_value & off_mask,%ebx
04:00000638 00
04:00000639 8803      	    61M 		mov %al,%ds:(%ebx)
04:0000063B 268803    	    62M 		mov %al,%es:(%ebx)
04:0000063E 3C00      	    63M 		cmp $0,%al
04:00000640 0F84E611  	    64M 		je error
04:00000644 67        	    65M 		addr16
04:00000645 A6        	    66M 		cmpsb     # COMPARE ES:EDI with DS:ESI
04:00000646 0F85E011  	    67M 		jne error
04:0000064A 6681FF0000	    68M 		cmp $off_cmp,%edi
04:0000064F 0100
04:00000651 0F85D511  	    69M 		jne error
04:00000655 6681FE0000	    70M 		cmp $off_cmp,%esi
04:0000065A 0100
04:0000065C 0F85CA11  	    71M 		jne error
                      	    72M 
04:00000660 66BFFFFF01	    73M 		mov $off_value,%edi
04:00000665 00
04:00000666 C6C078    	    74M 		mov $value,%al
04:00000669 268803    	    75M 		mov %al,%es:(%ebx)
04:0000066C 3C00      	    76M 		cmp $0,%al
04:0000066E 67        	    77M 		addr16
04:0000066F AE        	    78M 		scasb     # SCAN/COMPARE ES:EDI with EAX
04:00000670 0F85B611  	    79M 		jne error
04:00000674 6681FF0000	    80M 		cmp $off_cmp,%edi
04:00000679 0100
04:0000067B 0F85AB11  	    81M 		jne error
                      	    82M 
04:0000067F 66BEFFFF01	    83M 		mov $off_value,%esi
04:00000684 00
04:00000685 66BFFFFF01	    84M 		mov $off_value,%edi
04:0000068A 00
04:0000068B C6C078    	    85M 		mov $value,%al
04:0000068E 8803      	    86M 		mov %al,%ds:(%ebx)
04:00000690 B000      	    87M 		mov $0,%al
04:00000692 268803    	    88M 		mov %al,%es:(%ebx)
04:00000695 67        	    89M 		addr16
04:00000696 A4        	    90M 		movsb        # MOVE data from DS:ESI to ES:EDI
04:00000697 C6C078    	    91M 		mov $value,%al
04:0000069A 263803    	    92M 		cmp %al,%es:(%ebx)
04:0000069D 0F858911  	    93M 		jne error
04:000006A1 6681FF0000	    94M 		cmp $off_cmp,%edi
04:000006A6 0100
04:000006A8 0F857E11  	    95M 		jne error
04:000006AC 6681FE0000	    96M 		cmp $off_cmp,%esi
04:000006B1 0100
04:000006B3 0F857311  	    97M 		jne error
                      	    98M 
04:000006B7 66BEFFFF01	    99M 		mov $off_value,%esi
04:000006BC 00
04:000006BD C6C078    	   100M 		mov $value,%al
04:000006C0 268803    	   101M 		mov %al,%es:(%ebx)
04:000006C3 6631C0    	   102M 		xor %eax,%eax
04:000006C6 67        	   103M 		addr16
04:000006C7 AC        	   104M 		lodsb       # LOAD data from DS:ESI into EAX
04:000006C8 3C78      	   105M 		cmp $value & val_mask,%al
04:000006CA 0F855C11  	   106M 		jne error
04:000006CE 6681FE0000	   107M 		cmp $off_cmp,%esi
04:000006D3 0100
04:000006D5 0F855111  	   108M 		jne error
                      	   109M 	.endif
                      	   110M 
                      	   111M 	.if b = w
                      	   112M 		mov $off_value,%edi
                      	   113M 		mov $off_value & off_mask,%ebx
                      	   114M 		mov $0,%ax
                      	   115M 		mov %ax,%es:(%ebx)
                      	   116M 		mov $value,%ax
                      	   117M 		addr16
                      	   118M 		stosw     # STORE EAX in ES:EDI
                      	   119M 		cmp %ax,%es:(%ebx)
                      	   120M 		jne error
                      	   121M 		cmp $off_cmp,%edi
                      	   122M 		jne error
                      	   123M 
                      	   124M 		mov $off_value,%esi
                      	   125M 		mov $off_value,%edi
                      	   126M 		mov $off_value & off_mask,%ebx
                      	   127M 		mov %ax,%ds:(%ebx)
                      	   128M 		mov %ax,%es:(%ebx)
                      	   129M 		cmp $0,%ax
                      	   130M 		je error
                      	   131M 		addr16
                      	   132M 		cmpsw     # COMPARE ES:EDI with DS:ESI
                      	   133M 		jne error
                      	   134M 		cmp $off_cmp,%edi
                      	   135M 		jne error
                      	   136M 		cmp $off_cmp,%esi
                      	   137M 		jne error
                      	   138M 
                      	   139M 		mov $off_value,%edi
                      	   140M 		mov $value,%ax
                      	   141M 		mov %ax,%es:(%ebx)
                      	   142M 		cmp $0,%ax
                      	   143M 		addr16
                      	   144M 		scasw     # SCAN/COMPARE ES:EDI with EAX
                      	   145M 		jne error
                      	   146M 		cmp $off_cmp,%edi
                      	   147M 		jne error
                      	   148M 
                      	   149M 		mov $off_value,%esi
                      	   150M 		mov $off_value,%edi
                      	   151M 		mov $value,%ax
                      	   152M 		mov %ax,%ds:(%ebx)
                      	   153M 		mov $0,%ax
                      	   154M 		mov %ax,%es:(%ebx)
                      	   155M 		addr16
                      	   156M 		movsw 					# MOVE data from DS:ESI to ES:EDI
                      	   157M 		mov $value,%ax
                      	   158M 		cmp %ax,%es:(%ebx)
                      	   159M 		jne error
                      	   160M 		cmp $off_cmp,%edi
                      	   161M 		jne error
                      	   162M 		cmp $off_cmp,%esi
                      	   163M 		jne error
                      	   164M 
                      	   165M 		mov $off_value,%esi
                      	   166M 		mov $value,%ax
                      	   167M 		mov %ax,%es:(%ebx)
                      	   168M 		xor %eax,%eax
                      	   169M 		addr16
                      	   170M 		lodsw       # LOAD data from DS:ESI into EAX
                      	   171M 		cmp $value & val_mask,%ax
                      	   172M 		jne error
                      	   173M 		cmp $off_cmp,%esi
                      	   174M 		jne error
                      	   175M 	.endif
                      	   176M 
                      	   177M 	.if b = d
                      	   178M 		mov $off_value,%edi
                      	   179M 		mov $off_value & off_mask,%ebx
                      	   180M 		mov $0,%eax
                      	   181M 		mov %eax,%es:(%ebx)
                      	   182M 		mov $value,%eax
                      	   183M 		addr16
                      	   184M 		stosl     # STORE EAX in ES:EDI
                      	   185M 		cmp %eax,%es:(%ebx)
                      	   186M 		jne error
                      	   187M 		cmp $off_cmp,%edi
                      	   188M 		jne error
                      	   189M 
                      	   190M 		mov $off_value,%esi
                      	   191M 		mov $off_value,%edi
                      	   192M 		mov $off_value & off_mask,%ebx
                      	   193M 		mov %eax,%ds:(%ebx)
                      	   194M 		mov %eax,%es:(%ebx)
                      	   195M 		cmp $0,%eax
                      	   196M 		je error
                      	   197M 		addr16
                      	   198M 		cmpsl     # COMPARE ES:EDI with DS:ESI
                      	   199M 		jne error
                      	   200M 		cmp $off_cmp,%edi
                      	   201M 		jne error
                      	   202M 		cmp $off_cmp,%esi
                      	   203M 		jne error
                      	   204M 
                      	   205M 		mov $off_value,%edi
                      	   206M 		mov $value,%eax
                      	   207M 		mov %eax,%es:(%ebx)
                      	   208M 		cmp $0,%eax
                      	   209M 		addr16
                      	   210M 		scasl     # SCAN/COMPARE ES:EDI with EAX
                      	   211M 		jne error
                      	   212M 		cmp $off_cmp,%edi
                      	   213M 		jne error
                      	   214M 
                      	   215M 		mov $off_value,%esi
                      	   216M 		mov $off_value,%edi
                      	   217M 		mov $value,%eax
                      	   218M 		mov %eax,%ds:(%ebx)
                      	   219M 		mov $0,%eax
                      	   220M 		mov %eax,%es:(%ebx)
                      	   221M 		addr16
                      	   222M 		movsl        # MOVE data from DS:ESI to ES:EDI
                      	   223M 		mov $value,%eax
                      	   224M 		cmp %eax,%es:(%ebx)
                      	   225M 		jne error
                      	   226M 		cmp $off_cmp,%edi
                      	   227M 		jne error
                      	   228M 		cmp $off_cmp,%esi
                      	   229M 		jne error
                      	   230M 
                      	   231M 		mov $off_value,%esi
                      	   232M 		mov $value,%eax
                      	   233M 		mov %eax,%es:(%ebx)
                      	   234M 		xor %eax,%eax
                      	   235M 		addr16
                      	   236M 		lodsl       # LOAD data from DS:ESI into EAX
                      	   237M 		cmp $value & val_mask,%eax
                      	   238M 		jne error
                      	   239M 		cmp $off_cmp,%esi
                      	   240M 		jne error
                      	   241M 	.endif
                      	   242M 
                      	   243: 	testStringOps w,0,16
                      	     1M 
                      	     2M 	.set value,0x12345678
                      	     3M 	.if w = b
                      	     4M 		.set val_size,1
                      	     5M 		.set val_mask,0x000000ff
                      	     6M 	.endif
                      	     7M 	.if w = w
                      	     8M 		.set val_size,2
                      	     9M 		.set val_mask,0x0000ffff
                      	    10M 	.endif
                      	    11M 	.if w = d
                      	    12M 		.set val_size,4
                      	    13M 		.set val_mask,0xffffffff
                      	    14M 	.endif
                      	    15M 
                      	    16M 	.if 0 == 0
04:000006D9 FC        	    17M 		cld
                      	    18M 		.set off_value,0x0001ffff-(val_size-1)
                      	    19M 		.if 16 = 16
                      	    20M 			# 16-bit addressing
                      	    21M 			.set off_cmp,0x00010000
                      	    22M 		.else
                      	    23M 			# 32-bit addressing
                      	    24M 			.set off_cmp,0x00020000
                      	    25M 		.endif
                      	    26M 	.else
                      	    27M 		std
                      	    28M 		.set off_value,0x00010000
                      	    29M 		.if 16 = 16
                      	    30M 			# 16-bit addressing
                      	    31M 			.set off_cmp,0x0001ffff-(val_size-1)
                      	    32M 		.else
                      	    33M 			# 32-bit addressing
                      	    34M 			.set off_cmp,0x0000ffff-(val_size-1)
                      	    35M 		.endif
                      	    36M 	.endif
                      	    37M 
                      	    38M 	.if 16 = 16
                      	    39M 		.set off_mask,0x0000ffff
                      	    40M 	.else
                      	    41M 		.set off_mask,0xffffffff
                      	    42M 	.endif
                      	    43M 
                      	    44M 	# VERIFY string operands
                      	    45M 	.if w = b
                      	    46M 		mov $off_value,%edi
                      	    47M 		mov $off_value & off_mask,%ebx
                      	    48M 		mov $0,%al
                      	    49M 		mov %al,%es:(%ebx)
                      	    50M 		mov $value,%al
                      	    51M 		addr16
                      	    52M 		stosb		 	# STORE EAX in ES:EDI
                      	    53M 		cmp %al,%es:(%ebx)
                      	    54M 		jne error
                      	    55M 		cmp $off_cmp,%edi
                      	    56M 		jne error
                      	    57M 
                      	    58M 		mov $off_value,%esi
                      	    59M 		mov $off_value,%edi
                      	    60M 		mov $off_value & off_mask,%ebx
                      	    61M 		mov %al,%ds:(%ebx)
                      	    62M 		mov %al,%es:(%ebx)
                      	    63M 		cmp $0,%al
                      	    64M 		je error
                      	    65M 		addr16
                      	    66M 		cmpsb     # COMPARE ES:EDI with DS:ESI
                      	    67M 		jne error
                      	    68M 		cmp $off_cmp,%edi
                      	    69M 		jne error
                      	    70M 		cmp $off_cmp,%esi
                      	    71M 		jne error
                      	    72M 
                      	    73M 		mov $off_value,%edi
                      	    74M 		mov $value,%al
                      	    75M 		mov %al,%es:(%ebx)
                      	    76M 		cmp $0,%al
                      	    77M 		addr16
                      	    78M 		scasb     # SCAN/COMPARE ES:EDI with EAX
                      	    79M 		jne error
                      	    80M 		cmp $off_cmp,%edi
                      	    81M 		jne error
                      	    82M 
                      	    83M 		mov $off_value,%esi
                      	    84M 		mov $off_value,%edi
                      	    85M 		mov $value,%al
                      	    86M 		mov %al,%ds:(%ebx)
                      	    87M 		mov $0,%al
                      	    88M 		mov %al,%es:(%ebx)
                      	    89M 		addr16
                      	    90M 		movsb        # MOVE data from DS:ESI to ES:EDI
                      	    91M 		mov $value,%al
                      	    92M 		cmp %al,%es:(%ebx)
                      	    93M 		jne error
                      	    94M 		cmp $off_cmp,%edi
                      	    95M 		jne error
                      	    96M 		cmp $off_cmp,%esi
                      	    97M 		jne error
                      	    98M 
                      	    99M 		mov $off_value,%esi
                      	   100M 		mov $value,%al
                      	   101M 		mov %al,%es:(%ebx)
                      	   102M 		xor %eax,%eax
                      	   103M 		addr16
                      	   104M 		lodsb       # LOAD data from DS:ESI into EAX
                      	   105M 		cmp $value & val_mask,%al
                      	   106M 		jne error
                      	   107M 		cmp $off_cmp,%esi
                      	   108M 		jne error
                      	   109M 	.endif
                      	   110M 
                      	   111M 	.if w = w
04:000006DA 66BFFEFF01	   112M 		mov $off_value,%edi
04:000006DF 00
04:000006E0 66BBFEFF00	   113M 		mov $off_value & off_mask,%ebx
04:000006E5 00
04:000006E6 B80000    	   114M 		mov $0,%ax
04:000006E9 268903    	   115M 		mov %ax,%es:(%ebx)
04:000006EC C7C07856  	   116M 		mov $value,%ax
04:000006F0 67        	   117M 		addr16
04:000006F1 AB        	   118M 		stosw     # STORE EAX in ES:EDI
04:000006F2 263903    	   119M 		cmp %ax,%es:(%ebx)
04:000006F5 0F853111  	   120M 		jne error
04:000006F9 6681FF0000	   121M 		cmp $off_cmp,%edi
04:000006FE 0100
04:00000700 0F852611  	   122M 		jne error
                      	   123M 
04:00000704 66BEFEFF01	   124M 		mov $off_value,%esi
04:00000709 00
04:0000070A 66BFFEFF01	   125M 		mov $off_value,%edi
04:0000070F 00
04:00000710 66BBFEFF00	   126M 		mov $off_value & off_mask,%ebx
04:00000715 00
04:00000716 8903      	   127M 		mov %ax,%ds:(%ebx)
04:00000718 268903    	   128M 		mov %ax,%es:(%ebx)
04:0000071B 83F800    	   129M 		cmp $0,%ax
04:0000071E 0F840811  	   130M 		je error
04:00000722 67        	   131M 		addr16
04:00000723 A7        	   132M 		cmpsw     # COMPARE ES:EDI with DS:ESI
04:00000724 0F850211  	   133M 		jne error
04:00000728 6681FF0000	   134M 		cmp $off_cmp,%edi
04:0000072D 0100
04:0000072F 0F85F710  	   135M 		jne error
04:00000733 6681FE0000	   136M 		cmp $off_cmp,%esi
04:00000738 0100
04:0000073A 0F85EC10  	   137M 		jne error
                      	   138M 
04:0000073E 66BFFEFF01	   139M 		mov $off_value,%edi
04:00000743 00
04:00000744 C7C07856  	   140M 		mov $value,%ax
04:00000748 268903    	   141M 		mov %ax,%es:(%ebx)
04:0000074B 83F800    	   142M 		cmp $0,%ax
04:0000074E 67        	   143M 		addr16
04:0000074F AF        	   144M 		scasw     # SCAN/COMPARE ES:EDI with EAX
04:00000750 0F85D610  	   145M 		jne error
04:00000754 6681FF0000	   146M 		cmp $off_cmp,%edi
04:00000759 0100
04:0000075B 0F85CB10  	   147M 		jne error
                      	   148M 
04:0000075F 66BEFEFF01	   149M 		mov $off_value,%esi
04:00000764 00
04:00000765 66BFFEFF01	   150M 		mov $off_value,%edi
04:0000076A 00
04:0000076B C7C07856  	   151M 		mov $value,%ax
04:0000076F 8903      	   152M 		mov %ax,%ds:(%ebx)
04:00000771 B80000    	   153M 		mov $0,%ax
04:00000774 268903    	   154M 		mov %ax,%es:(%ebx)
04:00000777 67        	   155M 		addr16
04:00000778 A5        	   156M 		movsw 					# MOVE data from DS:ESI to ES:EDI
04:00000779 C7C07856  	   157M 		mov $value,%ax
04:0000077D 263903    	   158M 		cmp %ax,%es:(%ebx)
04:00000780 0F85A610  	   159M 		jne error
04:00000784 6681FF0000	   160M 		cmp $off_cmp,%edi
04:00000789 0100
04:0000078B 0F859B10  	   161M 		jne error
04:0000078F 6681FE0000	   162M 		cmp $off_cmp,%esi
04:00000794 0100
04:00000796 0F859010  	   163M 		jne error
                      	   164M 
04:0000079A 66BEFEFF01	   165M 		mov $off_value,%esi
04:0000079F 00
04:000007A0 C7C07856  	   166M 		mov $value,%ax
04:000007A4 268903    	   167M 		mov %ax,%es:(%ebx)
04:000007A7 6631C0    	   168M 		xor %eax,%eax
04:000007AA 67        	   169M 		addr16
04:000007AB AD        	   170M 		lodsw       # LOAD data from DS:ESI into EAX
04:000007AC 3D7856    	   171M 		cmp $value & val_mask,%ax
04:000007AF 0F857710  	   172M 		jne error
04:000007B3 6681FE0000	   173M 		cmp $off_cmp,%esi
04:000007B8 0100
04:000007BA 0F856C10  	   174M 		jne error
                      	   175M 	.endif
                      	   176M 
                      	   177M 	.if w = d
                      	   178M 		mov $off_value,%edi
                      	   179M 		mov $off_value & off_mask,%ebx
                      	   180M 		mov $0,%eax
                      	   181M 		mov %eax,%es:(%ebx)
                      	   182M 		mov $value,%eax
                      	   183M 		addr16
                      	   184M 		stosl     # STORE EAX in ES:EDI
                      	   185M 		cmp %eax,%es:(%ebx)
                      	   186M 		jne error
                      	   187M 		cmp $off_cmp,%edi
                      	   188M 		jne error
                      	   189M 
                      	   190M 		mov $off_value,%esi
                      	   191M 		mov $off_value,%edi
                      	   192M 		mov $off_value & off_mask,%ebx
                      	   193M 		mov %eax,%ds:(%ebx)
                      	   194M 		mov %eax,%es:(%ebx)
                      	   195M 		cmp $0,%eax
                      	   196M 		je error
                      	   197M 		addr16
                      	   198M 		cmpsl     # COMPARE ES:EDI with DS:ESI
                      	   199M 		jne error
                      	   200M 		cmp $off_cmp,%edi
                      	   201M 		jne error
                      	   202M 		cmp $off_cmp,%esi
                      	   203M 		jne error
                      	   204M 
                      	   205M 		mov $off_value,%edi
                      	   206M 		mov $value,%eax
                      	   207M 		mov %eax,%es:(%ebx)
                      	   208M 		cmp $0,%eax
                      	   209M 		addr16
                      	   210M 		scasl     # SCAN/COMPARE ES:EDI with EAX
                      	   211M 		jne error
                      	   212M 		cmp $off_cmp,%edi
                      	   213M 		jne error
                      	   214M 
                      	   215M 		mov $off_value,%esi
                      	   216M 		mov $off_value,%edi
                      	   217M 		mov $value,%eax
                      	   218M 		mov %eax,%ds:(%ebx)
                      	   219M 		mov $0,%eax
                      	   220M 		mov %eax,%es:(%ebx)
                      	   221M 		addr16
                      	   222M 		movsl        # MOVE data from DS:ESI to ES:EDI
                      	   223M 		mov $value,%eax
                      	   224M 		cmp %eax,%es:(%ebx)
                      	   225M 		jne error
                      	   226M 		cmp $off_cmp,%edi
                      	   227M 		jne error
                      	   228M 		cmp $off_cmp,%esi
                      	   229M 		jne error
                      	   230M 
                      	   231M 		mov $off_value,%esi
                      	   232M 		mov $value,%eax
                      	   233M 		mov %eax,%es:(%ebx)
                      	   234M 		xor %eax,%eax
                      	   235M 		addr16
                      	   236M 		lodsl       # LOAD data from DS:ESI into EAX
                      	   237M 		cmp $value & val_mask,%eax
                      	   238M 		jne error
                      	   239M 		cmp $off_cmp,%esi
                      	   240M 		jne error
                      	   241M 	.endif
                      	   242M 
                      	   244: 	testStringOps d,0,16
                      	     1M 
                      	     2M 	.set value,0x12345678
                      	     3M 	.if d = b
                      	     4M 		.set val_size,1
                      	     5M 		.set val_mask,0x000000ff
                      	     6M 	.endif
                      	     7M 	.if d = w
                      	     8M 		.set val_size,2
                      	     9M 		.set val_mask,0x0000ffff
                      	    10M 	.endif
                      	    11M 	.if d = d
                      	    12M 		.set val_size,4
                      	    13M 		.set val_mask,0xffffffff
                      	    14M 	.endif
                      	    15M 
                      	    16M 	.if 0 == 0
04:000007BE FC        	    17M 		cld
                      	    18M 		.set off_value,0x0001ffff-(val_size-1)
                      	    19M 		.if 16 = 16
                      	    20M 			# 16-bit addressing
                      	    21M 			.set off_cmp,0x00010000
                      	    22M 		.else
                      	    23M 			# 32-bit addressing
                      	    24M 			.set off_cmp,0x00020000
                      	    25M 		.endif
                      	    26M 	.else
                      	    27M 		std
                      	    28M 		.set off_value,0x00010000
                      	    29M 		.if 16 = 16
                      	    30M 			# 16-bit addressing
                      	    31M 			.set off_cmp,0x0001ffff-(val_size-1)
                      	    32M 		.else
                      	    33M 			# 32-bit addressing
                      	    34M 			.set off_cmp,0x0000ffff-(val_size-1)
                      	    35M 		.endif
                      	    36M 	.endif
                      	    37M 
                      	    38M 	.if 16 = 16
                      	    39M 		.set off_mask,0x0000ffff
                      	    40M 	.else
                      	    41M 		.set off_mask,0xffffffff
                      	    42M 	.endif
                      	    43M 
                      	    44M 	# VERIFY string operands
                      	    45M 	.if d = b
                      	    46M 		mov $off_value,%edi
                      	    47M 		mov $off_value & off_mask,%ebx
                      	    48M 		mov $0,%al
                      	    49M 		mov %al,%es:(%ebx)
                      	    50M 		mov $value,%al
                      	    51M 		addr16
                      	    52M 		stosb		 	# STORE EAX in ES:EDI
                      	    53M 		cmp %al,%es:(%ebx)
                      	    54M 		jne error
                      	    55M 		cmp $off_cmp,%edi
                      	    56M 		jne error
                      	    57M 
                      	    58M 		mov $off_value,%esi
                      	    59M 		mov $off_value,%edi
                      	    60M 		mov $off_value & off_mask,%ebx
                      	    61M 		mov %al,%ds:(%ebx)
                      	    62M 		mov %al,%es:(%ebx)
                      	    63M 		cmp $0,%al
                      	    64M 		je error
                      	    65M 		addr16
                      	    66M 		cmpsb     # COMPARE ES:EDI with DS:ESI
                      	    67M 		jne error
                      	    68M 		cmp $off_cmp,%edi
                      	    69M 		jne error
                      	    70M 		cmp $off_cmp,%esi
                      	    71M 		jne error
                      	    72M 
                      	    73M 		mov $off_value,%edi
                      	    74M 		mov $value,%al
                      	    75M 		mov %al,%es:(%ebx)
                      	    76M 		cmp $0,%al
                      	    77M 		addr16
                      	    78M 		scasb     # SCAN/COMPARE ES:EDI with EAX
                      	    79M 		jne error
                      	    80M 		cmp $off_cmp,%edi
                      	    81M 		jne error
                      	    82M 
                      	    83M 		mov $off_value,%esi
                      	    84M 		mov $off_value,%edi
                      	    85M 		mov $value,%al
                      	    86M 		mov %al,%ds:(%ebx)
                      	    87M 		mov $0,%al
                      	    88M 		mov %al,%es:(%ebx)
                      	    89M 		addr16
                      	    90M 		movsb        # MOVE data from DS:ESI to ES:EDI
                      	    91M 		mov $value,%al
                      	    92M 		cmp %al,%es:(%ebx)
                      	    93M 		jne error
                      	    94M 		cmp $off_cmp,%edi
                      	    95M 		jne error
                      	    96M 		cmp $off_cmp,%esi
                      	    97M 		jne error
                      	    98M 
                      	    99M 		mov $off_value,%esi
                      	   100M 		mov $value,%al
                      	   101M 		mov %al,%es:(%ebx)
                      	   102M 		xor %eax,%eax
                      	   103M 		addr16
                      	   104M 		lodsb       # LOAD data from DS:ESI into EAX
                      	   105M 		cmp $value & val_mask,%al
                      	   106M 		jne error
                      	   107M 		cmp $off_cmp,%esi
                      	   108M 		jne error
                      	   109M 	.endif
                      	   110M 
                      	   111M 	.if d = w
                      	   112M 		mov $off_value,%edi
                      	   113M 		mov $off_value & off_mask,%ebx
                      	   114M 		mov $0,%ax
                      	   115M 		mov %ax,%es:(%ebx)
                      	   116M 		mov $value,%ax
                      	   117M 		addr16
                      	   118M 		stosw     # STORE EAX in ES:EDI
                      	   119M 		cmp %ax,%es:(%ebx)
                      	   120M 		jne error
                      	   121M 		cmp $off_cmp,%edi
                      	   122M 		jne error
                      	   123M 
                      	   124M 		mov $off_value,%esi
                      	   125M 		mov $off_value,%edi
                      	   126M 		mov $off_value & off_mask,%ebx
                      	   127M 		mov %ax,%ds:(%ebx)
                      	   128M 		mov %ax,%es:(%ebx)
                      	   129M 		cmp $0,%ax
                      	   130M 		je error
                      	   131M 		addr16
                      	   132M 		cmpsw     # COMPARE ES:EDI with DS:ESI
                      	   133M 		jne error
                      	   134M 		cmp $off_cmp,%edi
                      	   135M 		jne error
                      	   136M 		cmp $off_cmp,%esi
                      	   137M 		jne error
                      	   138M 
                      	   139M 		mov $off_value,%edi
                      	   140M 		mov $value,%ax
                      	   141M 		mov %ax,%es:(%ebx)
                      	   142M 		cmp $0,%ax
                      	   143M 		addr16
                      	   144M 		scasw     # SCAN/COMPARE ES:EDI with EAX
                      	   145M 		jne error
                      	   146M 		cmp $off_cmp,%edi
                      	   147M 		jne error
                      	   148M 
                      	   149M 		mov $off_value,%esi
                      	   150M 		mov $off_value,%edi
                      	   151M 		mov $value,%ax
                      	   152M 		mov %ax,%ds:(%ebx)
                      	   153M 		mov $0,%ax
                      	   154M 		mov %ax,%es:(%ebx)
                      	   155M 		addr16
                      	   156M 		movsw 					# MOVE data from DS:ESI to ES:EDI
                      	   157M 		mov $value,%ax
                      	   158M 		cmp %ax,%es:(%ebx)
                      	   159M 		jne error
                      	   160M 		cmp $off_cmp,%edi
                      	   161M 		jne error
                      	   162M 		cmp $off_cmp,%esi
                      	   163M 		jne error
                      	   164M 
                      	   165M 		mov $off_value,%esi
                      	   166M 		mov $value,%ax
                      	   167M 		mov %ax,%es:(%ebx)
                      	   168M 		xor %eax,%eax
                      	   169M 		addr16
                      	   170M 		lodsw       # LOAD data from DS:ESI into EAX
                      	   171M 		cmp $value & val_mask,%ax
                      	   172M 		jne error
                      	   173M 		cmp $off_cmp,%esi
                      	   174M 		jne error
                      	   175M 	.endif
                      	   176M 
                      	   177M 	.if d = d
04:000007BF 66BFFCFF01	   178M 		mov $off_value,%edi
04:000007C4 00
04:000007C5 66BBFCFF00	   179M 		mov $off_value & off_mask,%ebx
04:000007CA 00
04:000007CB 66B8000000	   180M 		mov $0,%eax
04:000007D0 00
04:000007D1 66268903  	   181M 		mov %eax,%es:(%ebx)
04:000007D5 66B8785634	   182M 		mov $value,%eax
04:000007DA 12
04:000007DB 67        	   183M 		addr16
04:000007DC 66AB      	   184M 		stosl     # STORE EAX in ES:EDI
04:000007DE 66263903  	   185M 		cmp %eax,%es:(%ebx)
04:000007E2 0F854410  	   186M 		jne error
04:000007E6 6681FF0000	   187M 		cmp $off_cmp,%edi
04:000007EB 0100
04:000007ED 0F853910  	   188M 		jne error
                      	   189M 
04:000007F1 66BEFCFF01	   190M 		mov $off_value,%esi
04:000007F6 00
04:000007F7 66BFFCFF01	   191M 		mov $off_value,%edi
04:000007FC 00
04:000007FD 66BBFCFF00	   192M 		mov $off_value & off_mask,%ebx
04:00000802 00
04:00000803 668903    	   193M 		mov %eax,%ds:(%ebx)
04:00000806 66268903  	   194M 		mov %eax,%es:(%ebx)
04:0000080A 6683F800  	   195M 		cmp $0,%eax
04:0000080E 0F841810  	   196M 		je error
04:00000812 67        	   197M 		addr16
04:00000813 66A7      	   198M 		cmpsl     # COMPARE ES:EDI with DS:ESI
04:00000815 0F851110  	   199M 		jne error
04:00000819 6681FF0000	   200M 		cmp $off_cmp,%edi
04:0000081E 0100
04:00000820 0F850610  	   201M 		jne error
04:00000824 6681FE0000	   202M 		cmp $off_cmp,%esi
04:00000829 0100
04:0000082B 0F85FB0F  	   203M 		jne error
                      	   204M 
04:0000082F 66BFFCFF01	   205M 		mov $off_value,%edi
04:00000834 00
04:00000835 66B8785634	   206M 		mov $value,%eax
04:0000083A 12
04:0000083B 66268903  	   207M 		mov %eax,%es:(%ebx)
04:0000083F 6683F800  	   208M 		cmp $0,%eax
04:00000843 67        	   209M 		addr16
04:00000844 66AF      	   210M 		scasl     # SCAN/COMPARE ES:EDI with EAX
04:00000846 0F85E00F  	   211M 		jne error
04:0000084A 6681FF0000	   212M 		cmp $off_cmp,%edi
04:0000084F 0100
04:00000851 0F85D50F  	   213M 		jne error
                      	   214M 
04:00000855 66BEFCFF01	   215M 		mov $off_value,%esi
04:0000085A 00
04:0000085B 66BFFCFF01	   216M 		mov $off_value,%edi
04:00000860 00
04:00000861 66B8785634	   217M 		mov $value,%eax
04:00000866 12
04:00000867 668903    	   218M 		mov %eax,%ds:(%ebx)
04:0000086A 66B8000000	   219M 		mov $0,%eax
04:0000086F 00
04:00000870 66268903  	   220M 		mov %eax,%es:(%ebx)
04:00000874 67        	   221M 		addr16
04:00000875 66A5      	   222M 		movsl        # MOVE data from DS:ESI to ES:EDI
04:00000877 66B8785634	   223M 		mov $value,%eax
04:0000087C 12
04:0000087D 66263903  	   224M 		cmp %eax,%es:(%ebx)
04:00000881 0F85A50F  	   225M 		jne error
04:00000885 6681FF0000	   226M 		cmp $off_cmp,%edi
04:0000088A 0100
04:0000088C 0F859A0F  	   227M 		jne error
04:00000890 6681FE0000	   228M 		cmp $off_cmp,%esi
04:00000895 0100
04:00000897 0F858F0F  	   229M 		jne error
                      	   230M 
04:0000089B 66BEFCFF01	   231M 		mov $off_value,%esi
04:000008A0 00
04:000008A1 66B8785634	   232M 		mov $value,%eax
04:000008A6 12
04:000008A7 66268903  	   233M 		mov %eax,%es:(%ebx)
04:000008AB 6631C0    	   234M 		xor %eax,%eax
04:000008AE 67        	   235M 		addr16
04:000008AF 66AD      	   236M 		lodsl       # LOAD data from DS:ESI into EAX
04:000008B1 663D785634	   237M 		cmp $value & val_mask,%eax
04:000008B6 12
04:000008B7 0F856F0F  	   238M 		jne error
04:000008BB 6681FE0000	   239M 		cmp $off_cmp,%esi
04:000008C0 0100
04:000008C2 0F85640F  	   240M 		jne error
                      	   241M 	.endif
                      	   242M 
                      	   245: 	testStringOps b,1,16
                      	     1M 
                      	     2M 	.set value,0x12345678
                      	     3M 	.if b = b
                      	     4M 		.set val_size,1
                      	     5M 		.set val_mask,0x000000ff
                      	     6M 	.endif
                      	     7M 	.if b = w
                      	     8M 		.set val_size,2
                      	     9M 		.set val_mask,0x0000ffff
                      	    10M 	.endif
                      	    11M 	.if b = d
                      	    12M 		.set val_size,4
                      	    13M 		.set val_mask,0xffffffff
                      	    14M 	.endif
                      	    15M 
                      	    16M 	.if 1 == 0
                      	    17M 		cld
                      	    18M 		.set off_value,0x0001ffff-(val_size-1)
                      	    19M 		.if 16 = 16
                      	    20M 			# 16-bit addressing
                      	    21M 			.set off_cmp,0x00010000
                      	    22M 		.else
                      	    23M 			# 32-bit addressing
                      	    24M 			.set off_cmp,0x00020000
                      	    25M 		.endif
                      	    26M 	.else
04:000008C6 FD        	    27M 		std
                      	    28M 		.set off_value,0x00010000
                      	    29M 		.if 16 = 16
                      	    30M 			# 16-bit addressing
                      	    31M 			.set off_cmp,0x0001ffff-(val_size-1)
                      	    32M 		.else
                      	    33M 			# 32-bit addressing
                      	    34M 			.set off_cmp,0x0000ffff-(val_size-1)
                      	    35M 		.endif
                      	    36M 	.endif
                      	    37M 
                      	    38M 	.if 16 = 16
                      	    39M 		.set off_mask,0x0000ffff
                      	    40M 	.else
                      	    41M 		.set off_mask,0xffffffff
                      	    42M 	.endif
                      	    43M 
                      	    44M 	# VERIFY string operands
                      	    45M 	.if b = b
04:000008C7 66BF000001	    46M 		mov $off_value,%edi
04:000008CC 00
04:000008CD 66BB000000	    47M 		mov $off_value & off_mask,%ebx
04:000008D2 00
04:000008D3 B000      	    48M 		mov $0,%al
04:000008D5 268803    	    49M 		mov %al,%es:(%ebx)
04:000008D8 C6C078    	    50M 		mov $value,%al
04:000008DB 67        	    51M 		addr16
04:000008DC AA        	    52M 		stosb		 	# STORE EAX in ES:EDI
04:000008DD 263803    	    53M 		cmp %al,%es:(%ebx)
04:000008E0 0F85460F  	    54M 		jne error
04:000008E4 6681FFFFFF	    55M 		cmp $off_cmp,%edi
04:000008E9 0100
04:000008EB 0F853B0F  	    56M 		jne error
                      	    57M 
04:000008EF 66BE000001	    58M 		mov $off_value,%esi
04:000008F4 00
04:000008F5 66BF000001	    59M 		mov $off_value,%edi
04:000008FA 00
04:000008FB 66BB000000	    60M 		mov $off_value & off_mask,%ebx
04:00000900 00
04:00000901 8803      	    61M 		mov %al,%ds:(%ebx)
04:00000903 268803    	    62M 		mov %al,%es:(%ebx)
04:00000906 3C00      	    63M 		cmp $0,%al
04:00000908 0F841E0F  	    64M 		je error
04:0000090C 67        	    65M 		addr16
04:0000090D A6        	    66M 		cmpsb     # COMPARE ES:EDI with DS:ESI
04:0000090E 0F85180F  	    67M 		jne error
04:00000912 6681FFFFFF	    68M 		cmp $off_cmp,%edi
04:00000917 0100
04:00000919 0F850D0F  	    69M 		jne error
04:0000091D 6681FEFFFF	    70M 		cmp $off_cmp,%esi
04:00000922 0100
04:00000924 0F85020F  	    71M 		jne error
                      	    72M 
04:00000928 66BF000001	    73M 		mov $off_value,%edi
04:0000092D 00
04:0000092E C6C078    	    74M 		mov $value,%al
04:00000931 268803    	    75M 		mov %al,%es:(%ebx)
04:00000934 3C00      	    76M 		cmp $0,%al
04:00000936 67        	    77M 		addr16
04:00000937 AE        	    78M 		scasb     # SCAN/COMPARE ES:EDI with EAX
04:00000938 0F85EE0E  	    79M 		jne error
04:0000093C 6681FFFFFF	    80M 		cmp $off_cmp,%edi
04:00000941 0100
04:00000943 0F85E30E  	    81M 		jne error
                      	    82M 
04:00000947 66BE000001	    83M 		mov $off_value,%esi
04:0000094C 00
04:0000094D 66BF000001	    84M 		mov $off_value,%edi
04:00000952 00
04:00000953 C6C078    	    85M 		mov $value,%al
04:00000956 8803      	    86M 		mov %al,%ds:(%ebx)
04:00000958 B000      	    87M 		mov $0,%al
04:0000095A 268803    	    88M 		mov %al,%es:(%ebx)
04:0000095D 67        	    89M 		addr16
04:0000095E A4        	    90M 		movsb        # MOVE data from DS:ESI to ES:EDI
04:0000095F C6C078    	    91M 		mov $value,%al
04:00000962 263803    	    92M 		cmp %al,%es:(%ebx)
04:00000965 0F85C10E  	    93M 		jne error
04:00000969 6681FFFFFF	    94M 		cmp $off_cmp,%edi
04:0000096E 0100
04:00000970 0F85B60E  	    95M 		jne error
04:00000974 6681FEFFFF	    96M 		cmp $off_cmp,%esi
04:00000979 0100
04:0000097B 0F85AB0E  	    97M 		jne error
                      	    98M 
04:0000097F 66BE000001	    99M 		mov $off_value,%esi
04:00000984 00
04:00000985 C6C078    	   100M 		mov $value,%al
04:00000988 268803    	   101M 		mov %al,%es:(%ebx)
04:0000098B 6631C0    	   102M 		xor %eax,%eax
04:0000098E 67        	   103M 		addr16
04:0000098F AC        	   104M 		lodsb       # LOAD data from DS:ESI into EAX
04:00000990 3C78      	   105M 		cmp $value & val_mask,%al
04:00000992 0F85940E  	   106M 		jne error
04:00000996 6681FEFFFF	   107M 		cmp $off_cmp,%esi
04:0000099B 0100
04:0000099D 0F85890E  	   108M 		jne error
                      	   109M 	.endif
                      	   110M 
                      	   111M 	.if b = w
                      	   112M 		mov $off_value,%edi
                      	   113M 		mov $off_value & off_mask,%ebx
                      	   114M 		mov $0,%ax
                      	   115M 		mov %ax,%es:(%ebx)
                      	   116M 		mov $value,%ax
                      	   117M 		addr16
                      	   118M 		stosw     # STORE EAX in ES:EDI
                      	   119M 		cmp %ax,%es:(%ebx)
                      	   120M 		jne error
                      	   121M 		cmp $off_cmp,%edi
                      	   122M 		jne error
                      	   123M 
                      	   124M 		mov $off_value,%esi
                      	   125M 		mov $off_value,%edi
                      	   126M 		mov $off_value & off_mask,%ebx
                      	   127M 		mov %ax,%ds:(%ebx)
                      	   128M 		mov %ax,%es:(%ebx)
                      	   129M 		cmp $0,%ax
                      	   130M 		je error
                      	   131M 		addr16
                      	   132M 		cmpsw     # COMPARE ES:EDI with DS:ESI
                      	   133M 		jne error
                      	   134M 		cmp $off_cmp,%edi
                      	   135M 		jne error
                      	   136M 		cmp $off_cmp,%esi
                      	   137M 		jne error
                      	   138M 
                      	   139M 		mov $off_value,%edi
                      	   140M 		mov $value,%ax
                      	   141M 		mov %ax,%es:(%ebx)
                      	   142M 		cmp $0,%ax
                      	   143M 		addr16
                      	   144M 		scasw     # SCAN/COMPARE ES:EDI with EAX
                      	   145M 		jne error
                      	   146M 		cmp $off_cmp,%edi
                      	   147M 		jne error
                      	   148M 
                      	   149M 		mov $off_value,%esi
                      	   150M 		mov $off_value,%edi
                      	   151M 		mov $value,%ax
                      	   152M 		mov %ax,%ds:(%ebx)
                      	   153M 		mov $0,%ax
                      	   154M 		mov %ax,%es:(%ebx)
                      	   155M 		addr16
                      	   156M 		movsw 					# MOVE data from DS:ESI to ES:EDI
                      	   157M 		mov $value,%ax
                      	   158M 		cmp %ax,%es:(%ebx)
                      	   159M 		jne error
                      	   160M 		cmp $off_cmp,%edi
                      	   161M 		jne error
                      	   162M 		cmp $off_cmp,%esi
                      	   163M 		jne error
                      	   164M 
                      	   165M 		mov $off_value,%esi
                      	   166M 		mov $value,%ax
                      	   167M 		mov %ax,%es:(%ebx)
                      	   168M 		xor %eax,%eax
                      	   169M 		addr16
                      	   170M 		lodsw       # LOAD data from DS:ESI into EAX
                      	   171M 		cmp $value & val_mask,%ax
                      	   172M 		jne error
                      	   173M 		cmp $off_cmp,%esi
                      	   174M 		jne error
                      	   175M 	.endif
                      	   176M 
                      	   177M 	.if b = d
                      	   178M 		mov $off_value,%edi
                      	   179M 		mov $off_value & off_mask,%ebx
                      	   180M 		mov $0,%eax
                      	   181M 		mov %eax,%es:(%ebx)
                      	   182M 		mov $value,%eax
                      	   183M 		addr16
                      	   184M 		stosl     # STORE EAX in ES:EDI
                      	   185M 		cmp %eax,%es:(%ebx)
                      	   186M 		jne error
                      	   187M 		cmp $off_cmp,%edi
                      	   188M 		jne error
                      	   189M 
                      	   190M 		mov $off_value,%esi
                      	   191M 		mov $off_value,%edi
                      	   192M 		mov $off_value & off_mask,%ebx
                      	   193M 		mov %eax,%ds:(%ebx)
                      	   194M 		mov %eax,%es:(%ebx)
                      	   195M 		cmp $0,%eax
                      	   196M 		je error
                      	   197M 		addr16
                      	   198M 		cmpsl     # COMPARE ES:EDI with DS:ESI
                      	   199M 		jne error
                      	   200M 		cmp $off_cmp,%edi
                      	   201M 		jne error
                      	   202M 		cmp $off_cmp,%esi
                      	   203M 		jne error
                      	   204M 
                      	   205M 		mov $off_value,%edi
                      	   206M 		mov $value,%eax
                      	   207M 		mov %eax,%es:(%ebx)
                      	   208M 		cmp $0,%eax
                      	   209M 		addr16
                      	   210M 		scasl     # SCAN/COMPARE ES:EDI with EAX
                      	   211M 		jne error
                      	   212M 		cmp $off_cmp,%edi
                      	   213M 		jne error
                      	   214M 
                      	   215M 		mov $off_value,%esi
                      	   216M 		mov $off_value,%edi
                      	   217M 		mov $value,%eax
                      	   218M 		mov %eax,%ds:(%ebx)
                      	   219M 		mov $0,%eax
                      	   220M 		mov %eax,%es:(%ebx)
                      	   221M 		addr16
                      	   222M 		movsl        # MOVE data from DS:ESI to ES:EDI
                      	   223M 		mov $value,%eax
                      	   224M 		cmp %eax,%es:(%ebx)
                      	   225M 		jne error
                      	   226M 		cmp $off_cmp,%edi
                      	   227M 		jne error
                      	   228M 		cmp $off_cmp,%esi
                      	   229M 		jne error
                      	   230M 
                      	   231M 		mov $off_value,%esi
                      	   232M 		mov $value,%eax
                      	   233M 		mov %eax,%es:(%ebx)
                      	   234M 		xor %eax,%eax
                      	   235M 		addr16
                      	   236M 		lodsl       # LOAD data from DS:ESI into EAX
                      	   237M 		cmp $value & val_mask,%eax
                      	   238M 		jne error
                      	   239M 		cmp $off_cmp,%esi
                      	   240M 		jne error
                      	   241M 	.endif
                      	   242M 
                      	   246: 	testStringOps w,1,16
                      	     1M 
                      	     2M 	.set value,0x12345678
                      	     3M 	.if w = b
                      	     4M 		.set val_size,1
                      	     5M 		.set val_mask,0x000000ff
                      	     6M 	.endif
                      	     7M 	.if w = w
                      	     8M 		.set val_size,2
                      	     9M 		.set val_mask,0x0000ffff
                      	    10M 	.endif
                      	    11M 	.if w = d
                      	    12M 		.set val_size,4
                      	    13M 		.set val_mask,0xffffffff
                      	    14M 	.endif
                      	    15M 
                      	    16M 	.if 1 == 0
                      	    17M 		cld
                      	    18M 		.set off_value,0x0001ffff-(val_size-1)
                      	    19M 		.if 16 = 16
                      	    20M 			# 16-bit addressing
                      	    21M 			.set off_cmp,0x00010000
                      	    22M 		.else
                      	    23M 			# 32-bit addressing
                      	    24M 			.set off_cmp,0x00020000
                      	    25M 		.endif
                      	    26M 	.else
04:000009A1 FD        	    27M 		std
                      	    28M 		.set off_value,0x00010000
                      	    29M 		.if 16 = 16
                      	    30M 			# 16-bit addressing
                      	    31M 			.set off_cmp,0x0001ffff-(val_size-1)
                      	    32M 		.else
                      	    33M 			# 32-bit addressing
                      	    34M 			.set off_cmp,0x0000ffff-(val_size-1)
                      	    35M 		.endif
                      	    36M 	.endif
                      	    37M 
                      	    38M 	.if 16 = 16
                      	    39M 		.set off_mask,0x0000ffff
                      	    40M 	.else
                      	    41M 		.set off_mask,0xffffffff
                      	    42M 	.endif
                      	    43M 
                      	    44M 	# VERIFY string operands
                      	    45M 	.if w = b
                      	    46M 		mov $off_value,%edi
                      	    47M 		mov $off_value & off_mask,%ebx
                      	    48M 		mov $0,%al
                      	    49M 		mov %al,%es:(%ebx)
                      	    50M 		mov $value,%al
                      	    51M 		addr16
                      	    52M 		stosb		 	# STORE EAX in ES:EDI
                      	    53M 		cmp %al,%es:(%ebx)
                      	    54M 		jne error
                      	    55M 		cmp $off_cmp,%edi
                      	    56M 		jne error
                      	    57M 
                      	    58M 		mov $off_value,%esi
                      	    59M 		mov $off_value,%edi
                      	    60M 		mov $off_value & off_mask,%ebx
                      	    61M 		mov %al,%ds:(%ebx)
                      	    62M 		mov %al,%es:(%ebx)
                      	    63M 		cmp $0,%al
                      	    64M 		je error
                      	    65M 		addr16
                      	    66M 		cmpsb     # COMPARE ES:EDI with DS:ESI
                      	    67M 		jne error
                      	    68M 		cmp $off_cmp,%edi
                      	    69M 		jne error
                      	    70M 		cmp $off_cmp,%esi
                      	    71M 		jne error
                      	    72M 
                      	    73M 		mov $off_value,%edi
                      	    74M 		mov $value,%al
                      	    75M 		mov %al,%es:(%ebx)
                      	    76M 		cmp $0,%al
                      	    77M 		addr16
                      	    78M 		scasb     # SCAN/COMPARE ES:EDI with EAX
                      	    79M 		jne error
                      	    80M 		cmp $off_cmp,%edi
                      	    81M 		jne error
                      	    82M 
                      	    83M 		mov $off_value,%esi
                      	    84M 		mov $off_value,%edi
                      	    85M 		mov $value,%al
                      	    86M 		mov %al,%ds:(%ebx)
                      	    87M 		mov $0,%al
                      	    88M 		mov %al,%es:(%ebx)
                      	    89M 		addr16
                      	    90M 		movsb        # MOVE data from DS:ESI to ES:EDI
                      	    91M 		mov $value,%al
                      	    92M 		cmp %al,%es:(%ebx)
                      	    93M 		jne error
                      	    94M 		cmp $off_cmp,%edi
                      	    95M 		jne error
                      	    96M 		cmp $off_cmp,%esi
                      	    97M 		jne error
                      	    98M 
                      	    99M 		mov $off_value,%esi
                      	   100M 		mov $value,%al
                      	   101M 		mov %al,%es:(%ebx)
                      	   102M 		xor %eax,%eax
                      	   103M 		addr16
                      	   104M 		lodsb       # LOAD data from DS:ESI into EAX
                      	   105M 		cmp $value & val_mask,%al
                      	   106M 		jne error
                      	   107M 		cmp $off_cmp,%esi
                      	   108M 		jne error
                      	   109M 	.endif
                      	   110M 
                      	   111M 	.if w = w
04:000009A2 66BF000001	   112M 		mov $off_value,%edi
04:000009A7 00
04:000009A8 66BB000000	   113M 		mov $off_value & off_mask,%ebx
04:000009AD 00
04:000009AE B80000    	   114M 		mov $0,%ax
04:000009B1 268903    	   115M 		mov %ax,%es:(%ebx)
04:000009B4 C7C07856  	   116M 		mov $value,%ax
04:000009B8 67        	   117M 		addr16
04:000009B9 AB        	   118M 		stosw     # STORE EAX in ES:EDI
04:000009BA 263903    	   119M 		cmp %ax,%es:(%ebx)
04:000009BD 0F85690E  	   120M 		jne error
04:000009C1 6681FFFEFF	   121M 		cmp $off_cmp,%edi
04:000009C6 0100
04:000009C8 0F855E0E  	   122M 		jne error
                      	   123M 
04:000009CC 66BE000001	   124M 		mov $off_value,%esi
04:000009D1 00
04:000009D2 66BF000001	   125M 		mov $off_value,%edi
04:000009D7 00
04:000009D8 66BB000000	   126M 		mov $off_value & off_mask,%ebx
04:000009DD 00
04:000009DE 8903      	   127M 		mov %ax,%ds:(%ebx)
04:000009E0 268903    	   128M 		mov %ax,%es:(%ebx)
04:000009E3 83F800    	   129M 		cmp $0,%ax
04:000009E6 0F84400E  	   130M 		je error
04:000009EA 67        	   131M 		addr16
04:000009EB A7        	   132M 		cmpsw     # COMPARE ES:EDI with DS:ESI
04:000009EC 0F853A0E  	   133M 		jne error
04:000009F0 6681FFFEFF	   134M 		cmp $off_cmp,%edi
04:000009F5 0100
04:000009F7 0F852F0E  	   135M 		jne error
04:000009FB 6681FEFEFF	   136M 		cmp $off_cmp,%esi
04:00000A00 0100
04:00000A02 0F85240E  	   137M 		jne error
                      	   138M 
04:00000A06 66BF000001	   139M 		mov $off_value,%edi
04:00000A0B 00
04:00000A0C C7C07856  	   140M 		mov $value,%ax
04:00000A10 268903    	   141M 		mov %ax,%es:(%ebx)
04:00000A13 83F800    	   142M 		cmp $0,%ax
04:00000A16 67        	   143M 		addr16
04:00000A17 AF        	   144M 		scasw     # SCAN/COMPARE ES:EDI with EAX
04:00000A18 0F850E0E  	   145M 		jne error
04:00000A1C 6681FFFEFF	   146M 		cmp $off_cmp,%edi
04:00000A21 0100
04:00000A23 0F85030E  	   147M 		jne error
                      	   148M 
04:00000A27 66BE000001	   149M 		mov $off_value,%esi
04:00000A2C 00
04:00000A2D 66BF000001	   150M 		mov $off_value,%edi
04:00000A32 00
04:00000A33 C7C07856  	   151M 		mov $value,%ax
04:00000A37 8903      	   152M 		mov %ax,%ds:(%ebx)
04:00000A39 B80000    	   153M 		mov $0,%ax
04:00000A3C 268903    	   154M 		mov %ax,%es:(%ebx)
04:00000A3F 67        	   155M 		addr16
04:00000A40 A5        	   156M 		movsw 					# MOVE data from DS:ESI to ES:EDI
04:00000A41 C7C07856  	   157M 		mov $value,%ax
04:00000A45 263903    	   158M 		cmp %ax,%es:(%ebx)
04:00000A48 0F85DE0D  	   159M 		jne error
04:00000A4C 6681FFFEFF	   160M 		cmp $off_cmp,%edi
04:00000A51 0100
04:00000A53 0F85D30D  	   161M 		jne error
04:00000A57 6681FEFEFF	   162M 		cmp $off_cmp,%esi
04:00000A5C 0100
04:00000A5E 0F85C80D  	   163M 		jne error
                      	   164M 
04:00000A62 66BE000001	   165M 		mov $off_value,%esi
04:00000A67 00
04:00000A68 C7C07856  	   166M 		mov $value,%ax
04:00000A6C 268903    	   167M 		mov %ax,%es:(%ebx)
04:00000A6F 6631C0    	   168M 		xor %eax,%eax
04:00000A72 67        	   169M 		addr16
04:00000A73 AD        	   170M 		lodsw       # LOAD data from DS:ESI into EAX
04:00000A74 3D7856    	   171M 		cmp $value & val_mask,%ax
04:00000A77 0F85AF0D  	   172M 		jne error
04:00000A7B 6681FEFEFF	   173M 		cmp $off_cmp,%esi
04:00000A80 0100
04:00000A82 0F85A40D  	   174M 		jne error
                      	   175M 	.endif
                      	   176M 
                      	   177M 	.if w = d
                      	   178M 		mov $off_value,%edi
                      	   179M 		mov $off_value & off_mask,%ebx
                      	   180M 		mov $0,%eax
                      	   181M 		mov %eax,%es:(%ebx)
                      	   182M 		mov $value,%eax
                      	   183M 		addr16
                      	   184M 		stosl     # STORE EAX in ES:EDI
                      	   185M 		cmp %eax,%es:(%ebx)
                      	   186M 		jne error
                      	   187M 		cmp $off_cmp,%edi
                      	   188M 		jne error
                      	   189M 
                      	   190M 		mov $off_value,%esi
                      	   191M 		mov $off_value,%edi
                      	   192M 		mov $off_value & off_mask,%ebx
                      	   193M 		mov %eax,%ds:(%ebx)
                      	   194M 		mov %eax,%es:(%ebx)
                      	   195M 		cmp $0,%eax
                      	   196M 		je error
                      	   197M 		addr16
                      	   198M 		cmpsl     # COMPARE ES:EDI with DS:ESI
                      	   199M 		jne error
                      	   200M 		cmp $off_cmp,%edi
                      	   201M 		jne error
                      	   202M 		cmp $off_cmp,%esi
                      	   203M 		jne error
                      	   204M 
                      	   205M 		mov $off_value,%edi
                      	   206M 		mov $value,%eax
                      	   207M 		mov %eax,%es:(%ebx)
                      	   208M 		cmp $0,%eax
                      	   209M 		addr16
                      	   210M 		scasl     # SCAN/COMPARE ES:EDI with EAX
                      	   211M 		jne error
                      	   212M 		cmp $off_cmp,%edi
                      	   213M 		jne error
                      	   214M 
                      	   215M 		mov $off_value,%esi
                      	   216M 		mov $off_value,%edi
                      	   217M 		mov $value,%eax
                      	   218M 		mov %eax,%ds:(%ebx)
                      	   219M 		mov $0,%eax
                      	   220M 		mov %eax,%es:(%ebx)
                      	   221M 		addr16
                      	   222M 		movsl        # MOVE data from DS:ESI to ES:EDI
                      	   223M 		mov $value,%eax
                      	   224M 		cmp %eax,%es:(%ebx)
                      	   225M 		jne error
                      	   226M 		cmp $off_cmp,%edi
                      	   227M 		jne error
                      	   228M 		cmp $off_cmp,%esi
                      	   229M 		jne error
                      	   230M 
                      	   231M 		mov $off_value,%esi
                      	   232M 		mov $value,%eax
                      	   233M 		mov %eax,%es:(%ebx)
                      	   234M 		xor %eax,%eax
                      	   235M 		addr16
                      	   236M 		lodsl       # LOAD data from DS:ESI into EAX
                      	   237M 		cmp $value & val_mask,%eax
                      	   238M 		jne error
                      	   239M 		cmp $off_cmp,%esi
                      	   240M 		jne error
                      	   241M 	.endif
                      	   242M 
                      	   247: 	testStringOps d,1,16
                      	     1M 
                      	     2M 	.set value,0x12345678
                      	     3M 	.if d = b
                      	     4M 		.set val_size,1
                      	     5M 		.set val_mask,0x000000ff
                      	     6M 	.endif
                      	     7M 	.if d = w
                      	     8M 		.set val_size,2
                      	     9M 		.set val_mask,0x0000ffff
                      	    10M 	.endif
                      	    11M 	.if d = d
                      	    12M 		.set val_size,4
                      	    13M 		.set val_mask,0xffffffff
                      	    14M 	.endif
                      	    15M 
                      	    16M 	.if 1 == 0
                      	    17M 		cld
                      	    18M 		.set off_value,0x0001ffff-(val_size-1)
                      	    19M 		.if 16 = 16
                      	    20M 			# 16-bit addressing
                      	    21M 			.set off_cmp,0x00010000
                      	    22M 		.else
                      	    23M 			# 32-bit addressing
                      	    24M 			.set off_cmp,0x00020000
                      	    25M 		.endif
                      	    26M 	.else
04:00000A86 FD        	    27M 		std
                      	    28M 		.set off_value,0x00010000
                      	    29M 		.if 16 = 16
                      	    30M 			# 16-bit addressing
                      	    31M 			.set off_cmp,0x0001ffff-(val_size-1)
                      	    32M 		.else
                      	    33M 			# 32-bit addressing
                      	    34M 			.set off_cmp,0x0000ffff-(val_size-1)
                      	    35M 		.endif
                      	    36M 	.endif
                      	    37M 
                      	    38M 	.if 16 = 16
                      	    39M 		.set off_mask,0x0000ffff
                      	    40M 	.else
                      	    41M 		.set off_mask,0xffffffff
                      	    42M 	.endif
                      	    43M 
                      	    44M 	# VERIFY string operands
                      	    45M 	.if d = b
                      	    46M 		mov $off_value,%edi
                      	    47M 		mov $off_value & off_mask,%ebx
                      	    48M 		mov $0,%al
                      	    49M 		mov %al,%es:(%ebx)
                      	    50M 		mov $value,%al
                      	    51M 		addr16
                      	    52M 		stosb		 	# STORE EAX in ES:EDI
                      	    53M 		cmp %al,%es:(%ebx)
                      	    54M 		jne error
                      	    55M 		cmp $off_cmp,%edi
                      	    56M 		jne error
                      	    57M 
                      	    58M 		mov $off_value,%esi
                      	    59M 		mov $off_value,%edi
                      	    60M 		mov $off_value & off_mask,%ebx
                      	    61M 		mov %al,%ds:(%ebx)
                      	    62M 		mov %al,%es:(%ebx)
                      	    63M 		cmp $0,%al
                      	    64M 		je error
                      	    65M 		addr16
                      	    66M 		cmpsb     # COMPARE ES:EDI with DS:ESI
                      	    67M 		jne error
                      	    68M 		cmp $off_cmp,%edi
                      	    69M 		jne error
                      	    70M 		cmp $off_cmp,%esi
                      	    71M 		jne error
                      	    72M 
                      	    73M 		mov $off_value,%edi
                      	    74M 		mov $value,%al
                      	    75M 		mov %al,%es:(%ebx)
                      	    76M 		cmp $0,%al
                      	    77M 		addr16
                      	    78M 		scasb     # SCAN/COMPARE ES:EDI with EAX
                      	    79M 		jne error
                      	    80M 		cmp $off_cmp,%edi
                      	    81M 		jne error
                      	    82M 
                      	    83M 		mov $off_value,%esi
                      	    84M 		mov $off_value,%edi
                      	    85M 		mov $value,%al
                      	    86M 		mov %al,%ds:(%ebx)
                      	    87M 		mov $0,%al
                      	    88M 		mov %al,%es:(%ebx)
                      	    89M 		addr16
                      	    90M 		movsb        # MOVE data from DS:ESI to ES:EDI
                      	    91M 		mov $value,%al
                      	    92M 		cmp %al,%es:(%ebx)
                      	    93M 		jne error
                      	    94M 		cmp $off_cmp,%edi
                      	    95M 		jne error
                      	    96M 		cmp $off_cmp,%esi
                      	    97M 		jne error
                      	    98M 
                      	    99M 		mov $off_value,%esi
                      	   100M 		mov $value,%al
                      	   101M 		mov %al,%es:(%ebx)
                      	   102M 		xor %eax,%eax
                      	   103M 		addr16
                      	   104M 		lodsb       # LOAD data from DS:ESI into EAX
                      	   105M 		cmp $value & val_mask,%al
                      	   106M 		jne error
                      	   107M 		cmp $off_cmp,%esi
                      	   108M 		jne error
                      	   109M 	.endif
                      	   110M 
                      	   111M 	.if d = w
                      	   112M 		mov $off_value,%edi
                      	   113M 		mov $off_value & off_mask,%ebx
                      	   114M 		mov $0,%ax
                      	   115M 		mov %ax,%es:(%ebx)
                      	   116M 		mov $value,%ax
                      	   117M 		addr16
                      	   118M 		stosw     # STORE EAX in ES:EDI
                      	   119M 		cmp %ax,%es:(%ebx)
                      	   120M 		jne error
                      	   121M 		cmp $off_cmp,%edi
                      	   122M 		jne error
                      	   123M 
                      	   124M 		mov $off_value,%esi
                      	   125M 		mov $off_value,%edi
                      	   126M 		mov $off_value & off_mask,%ebx
                      	   127M 		mov %ax,%ds:(%ebx)
                      	   128M 		mov %ax,%es:(%ebx)
                      	   129M 		cmp $0,%ax
                      	   130M 		je error
                      	   131M 		addr16
                      	   132M 		cmpsw     # COMPARE ES:EDI with DS:ESI
                      	   133M 		jne error
                      	   134M 		cmp $off_cmp,%edi
                      	   135M 		jne error
                      	   136M 		cmp $off_cmp,%esi
                      	   137M 		jne error
                      	   138M 
                      	   139M 		mov $off_value,%edi
                      	   140M 		mov $value,%ax
                      	   141M 		mov %ax,%es:(%ebx)
                      	   142M 		cmp $0,%ax
                      	   143M 		addr16
                      	   144M 		scasw     # SCAN/COMPARE ES:EDI with EAX
                      	   145M 		jne error
                      	   146M 		cmp $off_cmp,%edi
                      	   147M 		jne error
                      	   148M 
                      	   149M 		mov $off_value,%esi
                      	   150M 		mov $off_value,%edi
                      	   151M 		mov $value,%ax
                      	   152M 		mov %ax,%ds:(%ebx)
                      	   153M 		mov $0,%ax
                      	   154M 		mov %ax,%es:(%ebx)
                      	   155M 		addr16
                      	   156M 		movsw 					# MOVE data from DS:ESI to ES:EDI
                      	   157M 		mov $value,%ax
                      	   158M 		cmp %ax,%es:(%ebx)
                      	   159M 		jne error
                      	   160M 		cmp $off_cmp,%edi
                      	   161M 		jne error
                      	   162M 		cmp $off_cmp,%esi
                      	   163M 		jne error
                      	   164M 
                      	   165M 		mov $off_value,%esi
                      	   166M 		mov $value,%ax
                      	   167M 		mov %ax,%es:(%ebx)
                      	   168M 		xor %eax,%eax
                      	   169M 		addr16
                      	   170M 		lodsw       # LOAD data from DS:ESI into EAX
                      	   171M 		cmp $value & val_mask,%ax
                      	   172M 		jne error
                      	   173M 		cmp $off_cmp,%esi
                      	   174M 		jne error
                      	   175M 	.endif
                      	   176M 
                      	   177M 	.if d = d
04:00000A87 66BF000001	   178M 		mov $off_value,%edi
04:00000A8C 00
04:00000A8D 66BB000000	   179M 		mov $off_value & off_mask,%ebx
04:00000A92 00
04:00000A93 66B8000000	   180M 		mov $0,%eax
04:00000A98 00
04:00000A99 66268903  	   181M 		mov %eax,%es:(%ebx)
04:00000A9D 66B8785634	   182M 		mov $value,%eax
04:00000AA2 12
04:00000AA3 67        	   183M 		addr16
04:00000AA4 66AB      	   184M 		stosl     # STORE EAX in ES:EDI
04:00000AA6 66263903  	   185M 		cmp %eax,%es:(%ebx)
04:00000AAA 0F857C0D  	   186M 		jne error
04:00000AAE 6681FFFCFF	   187M 		cmp $off_cmp,%edi
04:00000AB3 0100
04:00000AB5 0F85710D  	   188M 		jne error
                      	   189M 
04:00000AB9 66BE000001	   190M 		mov $off_value,%esi
04:00000ABE 00
04:00000ABF 66BF000001	   191M 		mov $off_value,%edi
04:00000AC4 00
04:00000AC5 66BB000000	   192M 		mov $off_value & off_mask,%ebx
04:00000ACA 00
04:00000ACB 668903    	   193M 		mov %eax,%ds:(%ebx)
04:00000ACE 66268903  	   194M 		mov %eax,%es:(%ebx)
04:00000AD2 6683F800  	   195M 		cmp $0,%eax
04:00000AD6 0F84500D  	   196M 		je error
04:00000ADA 67        	   197M 		addr16
04:00000ADB 66A7      	   198M 		cmpsl     # COMPARE ES:EDI with DS:ESI
04:00000ADD 0F85490D  	   199M 		jne error
04:00000AE1 6681FFFCFF	   200M 		cmp $off_cmp,%edi
04:00000AE6 0100
04:00000AE8 0F853E0D  	   201M 		jne error
04:00000AEC 6681FEFCFF	   202M 		cmp $off_cmp,%esi
04:00000AF1 0100
04:00000AF3 0F85330D  	   203M 		jne error
                      	   204M 
04:00000AF7 66BF000001	   205M 		mov $off_value,%edi
04:00000AFC 00
04:00000AFD 66B8785634	   206M 		mov $value,%eax
04:00000B02 12
04:00000B03 66268903  	   207M 		mov %eax,%es:(%ebx)
04:00000B07 6683F800  	   208M 		cmp $0,%eax
04:00000B0B 67        	   209M 		addr16
04:00000B0C 66AF      	   210M 		scasl     # SCAN/COMPARE ES:EDI with EAX
04:00000B0E 0F85180D  	   211M 		jne error
04:00000B12 6681FFFCFF	   212M 		cmp $off_cmp,%edi
04:00000B17 0100
04:00000B19 0F850D0D  	   213M 		jne error
                      	   214M 
04:00000B1D 66BE000001	   215M 		mov $off_value,%esi
04:00000B22 00
04:00000B23 66BF000001	   216M 		mov $off_value,%edi
04:00000B28 00
04:00000B29 66B8785634	   217M 		mov $value,%eax
04:00000B2E 12
04:00000B2F 668903    	   218M 		mov %eax,%ds:(%ebx)
04:00000B32 66B8000000	   219M 		mov $0,%eax
04:00000B37 00
04:00000B38 66268903  	   220M 		mov %eax,%es:(%ebx)
04:00000B3C 67        	   221M 		addr16
04:00000B3D 66A5      	   222M 		movsl        # MOVE data from DS:ESI to ES:EDI
04:00000B3F 66B8785634	   223M 		mov $value,%eax
04:00000B44 12
04:00000B45 66263903  	   224M 		cmp %eax,%es:(%ebx)
04:00000B49 0F85DD0C  	   225M 		jne error
04:00000B4D 6681FFFCFF	   226M 		cmp $off_cmp,%edi
04:00000B52 0100
04:00000B54 0F85D20C  	   227M 		jne error
04:00000B58 6681FEFCFF	   228M 		cmp $off_cmp,%esi
04:00000B5D 0100
04:00000B5F 0F85C70C  	   229M 		jne error
                      	   230M 
04:00000B63 66BE000001	   231M 		mov $off_value,%esi
04:00000B68 00
04:00000B69 66B8785634	   232M 		mov $value,%eax
04:00000B6E 12
04:00000B6F 66268903  	   233M 		mov %eax,%es:(%ebx)
04:00000B73 6631C0    	   234M 		xor %eax,%eax
04:00000B76 67        	   235M 		addr16
04:00000B77 66AD      	   236M 		lodsl       # LOAD data from DS:ESI into EAX
04:00000B79 663D785634	   237M 		cmp $value & val_mask,%eax
04:00000B7E 12
04:00000B7F 0F85A70C  	   238M 		jne error
04:00000B83 6681FEFCFF	   239M 		cmp $off_cmp,%esi
04:00000B88 0100
04:00000B8A 0F859C0C  	   240M 		jne error
                      	   241M 	.endif
                      	   242M 
                      	   248: 	testStringReps b,0,16
                      	     1M 
                      	     2M 	.set bytes,0x100
                      	     3M 
                      	     4M 	.if b = b
                      	     5M 		.set items,bytes
                      	     6M 	.endif
                      	     7M 	.if b = w
                      	     8M 		.set items,bytes/2
                      	     9M 	.endif
                      	    10M 	.if b = d
                      	    11M 		.set items,bytes/4
                      	    12M 	.endif
                      	    13M 
                      	    14M 	.if 0 == 0
04:00000B8E FC        	    15M 		cld
                      	    16M 		.set off_value,0x0001ff00
                      	    17M 		.if 16 = 16
                      	    18M 			# 16-bit addressing
                      	    19M 			.set off_cmp,0x00010000
                      	    20M 		.else
                      	    21M 			# 32-bit addressing
                      	    22M 			.set off_cmp,0x00020000
                      	    23M 		.endif
                      	    24M 	.else
                      	    25M 		std
                      	    26M 		.set off_value,0x000100ff
                      	    27M 		.if 16 = 16
                      	    28M 			# 16-bit addressing
                      	    29M 			.set off_cmp,0x0001ffff
                      	    30M 		.else
                      	    31M 			# 32-bit addressing
                      	    32M 			.set off_cmp,0x0000ffff
                      	    33M 		.endif
                      	    34M 	.endif
                      	    35M 
04:00000B8F 66B8785634	    36M 	mov $0x12345678,%eax
04:00000B94 12
04:00000B95 66BE00FF01	    37M 	mov $off_value,%esi
04:00000B9A 00
04:00000B9B 66BF00FF01	    38M 	mov $off_value,%edi
04:00000BA0 00
                      	    39M 
                      	    40M 	# VERIFY REPs on memory buffers
                      	    41M 
                      	    42M 	# STORE buffers with pattern in EAX
04:00000BA1 66B8785634	    43M 	mov $0x12345678,%eax
04:00000BA6 12
04:00000BA7 66BE00FF01	    44M 	mov $off_value,%esi
04:00000BAC 00
04:00000BAD 66BF00FF01	    45M 	mov $off_value,%edi
04:00000BB2 00
04:00000BB3 66B9000100	    46M 	mov $items,%ecx
04:00000BB8 00
                      	    47M 	.if b = b
04:00000BB9 67        	    48M 		addr16
04:00000BBA F3        	    49M 		rep
04:00000BBB AA        	    50M 		stosb    # store ECX items at ES:EDI with the value in EAX
                      	    51M 	.endif
                      	    52M 	.if b = w
                      	    53M 		addr16
                      	    54M 		rep
                      	    55M 		stosw    # store ECX items at ES:EDI with the value in EAX
                      	    56M 	.endif
                      	    57M 	.if b = d
                      	    58M 		addr16
                      	    59M 		rep
                      	    60M 		stosl    # store ECX items at ES:EDI with the value in EAX
                      	    61M 	.endif
04:00000BBC 6683F900  	    62M 	cmp $0,%ecx
04:00000BC0 0F85660C  	    63M 	jnz error           		# ECX must be 0
04:00000BC4 6681FF0000	    64M 	cmp $off_cmp,%edi
04:00000BC9 0100
04:00000BCB 0F855B0C  	    65M 	jnz error
04:00000BCF 66BF00FF01	    66M 	mov $off_value,%edi  # reset EDI
04:00000BD4 00
                      	    67M 	# now switch ES:EDI with DS:ESI
04:00000BD5 8CC2      	    68M 	mov %es,%dx
04:00000BD7 8CD9      	    69M 	mov %ds,%cx
04:00000BD9 87CA      	    70M 	xchg %cx,%dx
04:00000BDB 8EC2      	    71M 	mov %dx,%es
04:00000BDD 8ED9      	    72M 	mov %cx,%ds
04:00000BDF 6687F7    	    73M 	xchg %esi,%edi
                      	    74M 	# store again ES:EDI with pattern in EAX
04:00000BE2 66B9000100	    75M 	mov $items,%ecx      	# reset ECX
04:00000BE7 00
                      	    76M 	.if b = b
04:00000BE8 67        	    77M 		addr16
04:00000BE9 F3        	    78M 		rep
04:00000BEA AA        	    79M 		stosb
                      	    80M 	.endif
                      	    81M 	.if b = w
                      	    82M 		addr16
                      	    83M 		rep
                      	    84M 		stosw
                      	    85M 	.endif
                      	    86M 	.if b = d
                      	    87M 		addr16
                      	    88M 		rep
                      	    89M 		stosl
                      	    90M 	.endif
04:00000BEB 66BF00FF01	    91M 	mov $off_value,%edi  	# reset EDI
04:00000BF0 00
                      	    92M 
                      	    93M 	# COMPARE two buffers
04:00000BF1 66B9000100	    94M 	mov $items,%ecx      # reset ECX
04:00000BF6 00
                      	    95M 	.if b = b
04:00000BF7 67        	    96M 		addr16
04:00000BF8 F3        	    97M 		repe
04:00000BF9 A6        	    98M 		cmpsb # find nonmatching items in ES:EDI and DS:ESI
                      	    99M 	.endif
                      	   100M 	.if b = w
                      	   101M 		addr16
                      	   102M 		repe
                      	   103M 		cmpsw # find nonmatching items in ES:EDI and DS:ESI
                      	   104M 	.endif
                      	   105M 	.if b = d
                      	   106M 		addr16
                      	   107M 		repe
                      	   108M 		cmpsl # find nonmatching items in ES:EDI and DS:ESI
                      	   109M 	.endif
04:00000BFA 6683F900  	   110M 	cmp $0,%ecx
04:00000BFE 0F85280C  	   111M 	jnz error           		# ECX must be 0
04:00000C02 6681FE0000	   112M 	cmp $off_cmp,%esi
04:00000C07 0100
04:00000C09 0F851D0C  	   113M 	jne error
04:00000C0D 6681FF0000	   114M 	cmp $off_cmp,%edi
04:00000C12 0100
04:00000C14 0F85120C  	   115M 	jne error
04:00000C18 66BF00FF01	   116M 	mov $off_value,%edi  # reset EDI
04:00000C1D 00
04:00000C1E 66BE00FF01	   117M 	mov $off_value,%esi  # reset ESI
04:00000C23 00
                      	   118M 
                      	   119M 	# SCAN buffer for pattern
04:00000C24 66B9000100	   120M 	mov $items,%ecx      # reset ECX
04:00000C29 00
                      	   121M 	.if b = b
04:00000C2A 67        	   122M 		addr16
04:00000C2B F3        	   123M 		repe
04:00000C2C AE        	   124M 		scasb         # SCAN first dword not equal to EAX
                      	   125M 	.endif
                      	   126M 	.if b = w
                      	   127M 		addr16
                      	   128M 		repe
                      	   129M 		scasw         # SCAN first dword not equal to EAX
                      	   130M 	.endif
                      	   131M 	.if b = d
                      	   132M 		addr16
                      	   133M 		repe
                      	   134M 		scasl         # SCAN first dword not equal to EAX
                      	   135M 	.endif
04:00000C2D 6683F900  	   136M 	cmp $0,%ecx
04:00000C31 0F85F50B  	   137M 	jne error           		# ECX must be 0
04:00000C35 6681FF0000	   138M 	cmp $off_cmp,%edi
04:00000C3A 0100
04:00000C3C 0F85EA0B  	   139M 	jne error
04:00000C40 66BF00FF01	   140M 	mov $off_value,%edi  		# rewind EDI
04:00000C45 00
                      	   141M 
                      	   142M 	# MOVE and COMPARE data between buffers
                      	   143M 	# first zero-fill ES:EDI so that we can compare the moved data later
04:00000C46 66B8000000	   144M 	mov $0,%eax
04:00000C4B 00
04:00000C4C 66B9000100	   145M 	mov $items,%ecx      # reset ECX
04:00000C51 00
                      	   146M 	.if b = b
04:00000C52 67        	   147M 		addr16
04:00000C53 F3        	   148M 		rep
04:00000C54 AA        	   149M 		stosb          # zero fill ES:EDI
                      	   150M 	.endif
                      	   151M 	.if b = w
                      	   152M 		addr16
                      	   153M 		rep
                      	   154M 		stosw          # zero fill ES:EDI
                      	   155M 	.endif
                      	   156M 	.if b = d
                      	   157M 		addr16
                      	   158M 		rep
                      	   159M 		stosl          # zero fill ES:EDI
                      	   160M 	.endif
04:00000C55 66BF00FF01	   161M 	mov $off_value,%edi  # reset EDI
04:00000C5A 00
04:00000C5B 66B9000100	   162M 	mov $items,%ecx      # reset ECX
04:00000C60 00
                      	   163M 	.if b = b
04:00000C61 67        	   164M 		addr16
04:00000C62 F3        	   165M 		rep
04:00000C63 A4        	   166M 		movsb          # MOVE data from DS:ESI to ES:EDI
                      	   167M 	.endif
                      	   168M 	.if b = w
                      	   169M 		addr16
                      	   170M 		rep
                      	   171M 		movsw          # MOVE data from DS:ESI to ES:EDI
                      	   172M 	.endif
                      	   173M 	.if b = d
                      	   174M 		addr16
                      	   175M 		rep
                      	   176M 		movsl          # MOVE data from DS:ESI to ES:EDI
                      	   177M 	.endif
04:00000C64 6683F900  	   178M 	cmp $0,%ecx
04:00000C68 0F85BE0B  	   179M 	jne error           	# ECX must be 0
04:00000C6C 6681FE0000	   180M 	cmp $off_cmp,%esi
04:00000C71 0100
04:00000C73 0F85B30B  	   181M 	jne error
04:00000C77 6681FF0000	   182M 	cmp $off_cmp,%edi
04:00000C7C 0100
04:00000C7E 0F85A80B  	   183M 	jne error
04:00000C82 66B9000100	   184M 	mov $items,%ecx      	# reset ECX
04:00000C87 00
04:00000C88 66BF00FF01	   185M 	mov $off_value,%edi  	# reset EDI
04:00000C8D 00
04:00000C8E 66BE00FF01	   186M 	mov $off_value,%esi  	# reset ESI
04:00000C93 00
                      	   187M 	.if b = b
04:00000C94 67        	   188M 		addr16
04:00000C95 F3        	   189M 		repe
04:00000C96 A6        	   190M 		cmpsb  # COMPARE moved data in ES:EDI with DS:ESI
                      	   191M 	.endif
                      	   192M 	.if b = w
                      	   193M 		addr16
                      	   194M 		repe
                      	   195M 		cmpsw  # COMPARE moved data in ES:EDI with DS:ESI
                      	   196M 	.endif
                      	   197M 	.if b = d
                      	   198M 		addr16
                      	   199M 		repe
                      	   200M 		cmpsl  # COMPARE moved data in ES:EDI with DS:ESI
                      	   201M 	.endif
04:00000C97 6683F900  	   202M 	cmp $0,%ecx
04:00000C9B 0F858B0B  	   203M 	jne error           # ECX must be 0
04:00000C9F 6681FE0000	   204M 	cmp $off_cmp,%esi
04:00000CA4 0100
04:00000CA6 0F85800B  	   205M 	jne error
04:00000CAA 6681FF0000	   206M 	cmp $off_cmp,%edi
04:00000CAF 0100
04:00000CB1 0F85750B  	   207M 	jne error
                      	   249: 	testStringReps w,0,16
                      	     1M 
                      	     2M 	.set bytes,0x100
                      	     3M 
                      	     4M 	.if w = b
                      	     5M 		.set items,bytes
                      	     6M 	.endif
                      	     7M 	.if w = w
                      	     8M 		.set items,bytes/2
                      	     9M 	.endif
                      	    10M 	.if w = d
                      	    11M 		.set items,bytes/4
                      	    12M 	.endif
                      	    13M 
                      	    14M 	.if 0 == 0
04:00000CB5 FC        	    15M 		cld
                      	    16M 		.set off_value,0x0001ff00
                      	    17M 		.if 16 = 16
                      	    18M 			# 16-bit addressing
                      	    19M 			.set off_cmp,0x00010000
                      	    20M 		.else
                      	    21M 			# 32-bit addressing
                      	    22M 			.set off_cmp,0x00020000
                      	    23M 		.endif
                      	    24M 	.else
                      	    25M 		std
                      	    26M 		.set off_value,0x000100ff
                      	    27M 		.if 16 = 16
                      	    28M 			# 16-bit addressing
                      	    29M 			.set off_cmp,0x0001ffff
                      	    30M 		.else
                      	    31M 			# 32-bit addressing
                      	    32M 			.set off_cmp,0x0000ffff
                      	    33M 		.endif
                      	    34M 	.endif
                      	    35M 
04:00000CB6 66B8785634	    36M 	mov $0x12345678,%eax
04:00000CBB 12
04:00000CBC 66BE00FF01	    37M 	mov $off_value,%esi
04:00000CC1 00
04:00000CC2 66BF00FF01	    38M 	mov $off_value,%edi
04:00000CC7 00
                      	    39M 
                      	    40M 	# VERIFY REPs on memory buffers
                      	    41M 
                      	    42M 	# STORE buffers with pattern in EAX
04:00000CC8 66B8785634	    43M 	mov $0x12345678,%eax
04:00000CCD 12
04:00000CCE 66BE00FF01	    44M 	mov $off_value,%esi
04:00000CD3 00
04:00000CD4 66BF00FF01	    45M 	mov $off_value,%edi
04:00000CD9 00
04:00000CDA 66B9800000	    46M 	mov $items,%ecx
04:00000CDF 00
                      	    47M 	.if w = b
                      	    48M 		addr16
                      	    49M 		rep
                      	    50M 		stosb    # store ECX items at ES:EDI with the value in EAX
                      	    51M 	.endif
                      	    52M 	.if w = w
04:00000CE0 67        	    53M 		addr16
04:00000CE1 F3        	    54M 		rep
04:00000CE2 AB        	    55M 		stosw    # store ECX items at ES:EDI with the value in EAX
                      	    56M 	.endif
                      	    57M 	.if w = d
                      	    58M 		addr16
                      	    59M 		rep
                      	    60M 		stosl    # store ECX items at ES:EDI with the value in EAX
                      	    61M 	.endif
04:00000CE3 6683F900  	    62M 	cmp $0,%ecx
04:00000CE7 0F853F0B  	    63M 	jnz error           		# ECX must be 0
04:00000CEB 6681FF0000	    64M 	cmp $off_cmp,%edi
04:00000CF0 0100
04:00000CF2 0F85340B  	    65M 	jnz error
04:00000CF6 66BF00FF01	    66M 	mov $off_value,%edi  # reset EDI
04:00000CFB 00
                      	    67M 	# now switch ES:EDI with DS:ESI
04:00000CFC 8CC2      	    68M 	mov %es,%dx
04:00000CFE 8CD9      	    69M 	mov %ds,%cx
04:00000D00 87CA      	    70M 	xchg %cx,%dx
04:00000D02 8EC2      	    71M 	mov %dx,%es
04:00000D04 8ED9      	    72M 	mov %cx,%ds
04:00000D06 6687F7    	    73M 	xchg %esi,%edi
                      	    74M 	# store again ES:EDI with pattern in EAX
04:00000D09 66B9800000	    75M 	mov $items,%ecx      	# reset ECX
04:00000D0E 00
                      	    76M 	.if w = b
                      	    77M 		addr16
                      	    78M 		rep
                      	    79M 		stosb
                      	    80M 	.endif
                      	    81M 	.if w = w
04:00000D0F 67        	    82M 		addr16
04:00000D10 F3        	    83M 		rep
04:00000D11 AB        	    84M 		stosw
                      	    85M 	.endif
                      	    86M 	.if w = d
                      	    87M 		addr16
                      	    88M 		rep
                      	    89M 		stosl
                      	    90M 	.endif
04:00000D12 66BF00FF01	    91M 	mov $off_value,%edi  	# reset EDI
04:00000D17 00
                      	    92M 
                      	    93M 	# COMPARE two buffers
04:00000D18 66B9800000	    94M 	mov $items,%ecx      # reset ECX
04:00000D1D 00
                      	    95M 	.if w = b
                      	    96M 		addr16
                      	    97M 		repe
                      	    98M 		cmpsb # find nonmatching items in ES:EDI and DS:ESI
                      	    99M 	.endif
                      	   100M 	.if w = w
04:00000D1E 67        	   101M 		addr16
04:00000D1F F3        	   102M 		repe
04:00000D20 A7        	   103M 		cmpsw # find nonmatching items in ES:EDI and DS:ESI
                      	   104M 	.endif
                      	   105M 	.if w = d
                      	   106M 		addr16
                      	   107M 		repe
                      	   108M 		cmpsl # find nonmatching items in ES:EDI and DS:ESI
                      	   109M 	.endif
04:00000D21 6683F900  	   110M 	cmp $0,%ecx
04:00000D25 0F85010B  	   111M 	jnz error           		# ECX must be 0
04:00000D29 6681FE0000	   112M 	cmp $off_cmp,%esi
04:00000D2E 0100
04:00000D30 0F85F60A  	   113M 	jne error
04:00000D34 6681FF0000	   114M 	cmp $off_cmp,%edi
04:00000D39 0100
04:00000D3B 0F85EB0A  	   115M 	jne error
04:00000D3F 66BF00FF01	   116M 	mov $off_value,%edi  # reset EDI
04:00000D44 00
04:00000D45 66BE00FF01	   117M 	mov $off_value,%esi  # reset ESI
04:00000D4A 00
                      	   118M 
                      	   119M 	# SCAN buffer for pattern
04:00000D4B 66B9800000	   120M 	mov $items,%ecx      # reset ECX
04:00000D50 00
                      	   121M 	.if w = b
                      	   122M 		addr16
                      	   123M 		repe
                      	   124M 		scasb         # SCAN first dword not equal to EAX
                      	   125M 	.endif
                      	   126M 	.if w = w
04:00000D51 67        	   127M 		addr16
04:00000D52 F3        	   128M 		repe
04:00000D53 AF        	   129M 		scasw         # SCAN first dword not equal to EAX
                      	   130M 	.endif
                      	   131M 	.if w = d
                      	   132M 		addr16
                      	   133M 		repe
                      	   134M 		scasl         # SCAN first dword not equal to EAX
                      	   135M 	.endif
04:00000D54 6683F900  	   136M 	cmp $0,%ecx
04:00000D58 0F85CE0A  	   137M 	jne error           		# ECX must be 0
04:00000D5C 6681FF0000	   138M 	cmp $off_cmp,%edi
04:00000D61 0100
04:00000D63 0F85C30A  	   139M 	jne error
04:00000D67 66BF00FF01	   140M 	mov $off_value,%edi  		# rewind EDI
04:00000D6C 00
                      	   141M 
                      	   142M 	# MOVE and COMPARE data between buffers
                      	   143M 	# first zero-fill ES:EDI so that we can compare the moved data later
04:00000D6D 66B8000000	   144M 	mov $0,%eax
04:00000D72 00
04:00000D73 66B9800000	   145M 	mov $items,%ecx      # reset ECX
04:00000D78 00
                      	   146M 	.if w = b
                      	   147M 		addr16
                      	   148M 		rep
                      	   149M 		stosb          # zero fill ES:EDI
                      	   150M 	.endif
                      	   151M 	.if w = w
04:00000D79 67        	   152M 		addr16
04:00000D7A F3        	   153M 		rep
04:00000D7B AB        	   154M 		stosw          # zero fill ES:EDI
                      	   155M 	.endif
                      	   156M 	.if w = d
                      	   157M 		addr16
                      	   158M 		rep
                      	   159M 		stosl          # zero fill ES:EDI
                      	   160M 	.endif
04:00000D7C 66BF00FF01	   161M 	mov $off_value,%edi  # reset EDI
04:00000D81 00
04:00000D82 66B9800000	   162M 	mov $items,%ecx      # reset ECX
04:00000D87 00
                      	   163M 	.if w = b
                      	   164M 		addr16
                      	   165M 		rep
                      	   166M 		movsb          # MOVE data from DS:ESI to ES:EDI
                      	   167M 	.endif
                      	   168M 	.if w = w
04:00000D88 67        	   169M 		addr16
04:00000D89 F3        	   170M 		rep
04:00000D8A A5        	   171M 		movsw          # MOVE data from DS:ESI to ES:EDI
                      	   172M 	.endif
                      	   173M 	.if w = d
                      	   174M 		addr16
                      	   175M 		rep
                      	   176M 		movsl          # MOVE data from DS:ESI to ES:EDI
                      	   177M 	.endif
04:00000D8B 6683F900  	   178M 	cmp $0,%ecx
04:00000D8F 0F85970A  	   179M 	jne error           	# ECX must be 0
04:00000D93 6681FE0000	   180M 	cmp $off_cmp,%esi
04:00000D98 0100
04:00000D9A 0F858C0A  	   181M 	jne error
04:00000D9E 6681FF0000	   182M 	cmp $off_cmp,%edi
04:00000DA3 0100
04:00000DA5 0F85810A  	   183M 	jne error
04:00000DA9 66B9800000	   184M 	mov $items,%ecx      	# reset ECX
04:00000DAE 00
04:00000DAF 66BF00FF01	   185M 	mov $off_value,%edi  	# reset EDI
04:00000DB4 00
04:00000DB5 66BE00FF01	   186M 	mov $off_value,%esi  	# reset ESI
04:00000DBA 00
                      	   187M 	.if w = b
                      	   188M 		addr16
                      	   189M 		repe
                      	   190M 		cmpsb  # COMPARE moved data in ES:EDI with DS:ESI
                      	   191M 	.endif
                      	   192M 	.if w = w
04:00000DBB 67        	   193M 		addr16
04:00000DBC F3        	   194M 		repe
04:00000DBD A7        	   195M 		cmpsw  # COMPARE moved data in ES:EDI with DS:ESI
                      	   196M 	.endif
                      	   197M 	.if w = d
                      	   198M 		addr16
                      	   199M 		repe
                      	   200M 		cmpsl  # COMPARE moved data in ES:EDI with DS:ESI
                      	   201M 	.endif
04:00000DBE 6683F900  	   202M 	cmp $0,%ecx
04:00000DC2 0F85640A  	   203M 	jne error           # ECX must be 0
04:00000DC6 6681FE0000	   204M 	cmp $off_cmp,%esi
04:00000DCB 0100
04:00000DCD 0F85590A  	   205M 	jne error
04:00000DD1 6681FF0000	   206M 	cmp $off_cmp,%edi
04:00000DD6 0100
04:00000DD8 0F854E0A  	   207M 	jne error
                      	   250: 	testStringReps d,0,16
                      	     1M 
                      	     2M 	.set bytes,0x100
                      	     3M 
                      	     4M 	.if d = b
                      	     5M 		.set items,bytes
                      	     6M 	.endif
                      	     7M 	.if d = w
                      	     8M 		.set items,bytes/2
                      	     9M 	.endif
                      	    10M 	.if d = d
                      	    11M 		.set items,bytes/4
                      	    12M 	.endif
                      	    13M 
                      	    14M 	.if 0 == 0
04:00000DDC FC        	    15M 		cld
                      	    16M 		.set off_value,0x0001ff00
                      	    17M 		.if 16 = 16
                      	    18M 			# 16-bit addressing
                      	    19M 			.set off_cmp,0x00010000
                      	    20M 		.else
                      	    21M 			# 32-bit addressing
                      	    22M 			.set off_cmp,0x00020000
                      	    23M 		.endif
                      	    24M 	.else
                      	    25M 		std
                      	    26M 		.set off_value,0x000100ff
                      	    27M 		.if 16 = 16
                      	    28M 			# 16-bit addressing
                      	    29M 			.set off_cmp,0x0001ffff
                      	    30M 		.else
                      	    31M 			# 32-bit addressing
                      	    32M 			.set off_cmp,0x0000ffff
                      	    33M 		.endif
                      	    34M 	.endif
                      	    35M 
04:00000DDD 66B8785634	    36M 	mov $0x12345678,%eax
04:00000DE2 12
04:00000DE3 66BE00FF01	    37M 	mov $off_value,%esi
04:00000DE8 00
04:00000DE9 66BF00FF01	    38M 	mov $off_value,%edi
04:00000DEE 00
                      	    39M 
                      	    40M 	# VERIFY REPs on memory buffers
                      	    41M 
                      	    42M 	# STORE buffers with pattern in EAX
04:00000DEF 66B8785634	    43M 	mov $0x12345678,%eax
04:00000DF4 12
04:00000DF5 66BE00FF01	    44M 	mov $off_value,%esi
04:00000DFA 00
04:00000DFB 66BF00FF01	    45M 	mov $off_value,%edi
04:00000E00 00
04:00000E01 66B9400000	    46M 	mov $items,%ecx
04:00000E06 00
                      	    47M 	.if d = b
                      	    48M 		addr16
                      	    49M 		rep
                      	    50M 		stosb    # store ECX items at ES:EDI with the value in EAX
                      	    51M 	.endif
                      	    52M 	.if d = w
                      	    53M 		addr16
                      	    54M 		rep
                      	    55M 		stosw    # store ECX items at ES:EDI with the value in EAX
                      	    56M 	.endif
                      	    57M 	.if d = d
04:00000E07 67        	    58M 		addr16
04:00000E08 F3        	    59M 		rep
04:00000E09 66AB      	    60M 		stosl    # store ECX items at ES:EDI with the value in EAX
                      	    61M 	.endif
04:00000E0B 6683F900  	    62M 	cmp $0,%ecx
04:00000E0F 0F85170A  	    63M 	jnz error           		# ECX must be 0
04:00000E13 6681FF0000	    64M 	cmp $off_cmp,%edi
04:00000E18 0100
04:00000E1A 0F850C0A  	    65M 	jnz error
04:00000E1E 66BF00FF01	    66M 	mov $off_value,%edi  # reset EDI
04:00000E23 00
                      	    67M 	# now switch ES:EDI with DS:ESI
04:00000E24 8CC2      	    68M 	mov %es,%dx
04:00000E26 8CD9      	    69M 	mov %ds,%cx
04:00000E28 87CA      	    70M 	xchg %cx,%dx
04:00000E2A 8EC2      	    71M 	mov %dx,%es
04:00000E2C 8ED9      	    72M 	mov %cx,%ds
04:00000E2E 6687F7    	    73M 	xchg %esi,%edi
                      	    74M 	# store again ES:EDI with pattern in EAX
04:00000E31 66B9400000	    75M 	mov $items,%ecx      	# reset ECX
04:00000E36 00
                      	    76M 	.if d = b
                      	    77M 		addr16
                      	    78M 		rep
                      	    79M 		stosb
                      	    80M 	.endif
                      	    81M 	.if d = w
                      	    82M 		addr16
                      	    83M 		rep
                      	    84M 		stosw
                      	    85M 	.endif
                      	    86M 	.if d = d
04:00000E37 67        	    87M 		addr16
04:00000E38 F3        	    88M 		rep
04:00000E39 66AB      	    89M 		stosl
                      	    90M 	.endif
04:00000E3B 66BF00FF01	    91M 	mov $off_value,%edi  	# reset EDI
04:00000E40 00
                      	    92M 
                      	    93M 	# COMPARE two buffers
04:00000E41 66B9400000	    94M 	mov $items,%ecx      # reset ECX
04:00000E46 00
                      	    95M 	.if d = b
                      	    96M 		addr16
                      	    97M 		repe
                      	    98M 		cmpsb # find nonmatching items in ES:EDI and DS:ESI
                      	    99M 	.endif
                      	   100M 	.if d = w
                      	   101M 		addr16
                      	   102M 		repe
                      	   103M 		cmpsw # find nonmatching items in ES:EDI and DS:ESI
                      	   104M 	.endif
                      	   105M 	.if d = d
04:00000E47 67        	   106M 		addr16
04:00000E48 F3        	   107M 		repe
04:00000E49 66A7      	   108M 		cmpsl # find nonmatching items in ES:EDI and DS:ESI
                      	   109M 	.endif
04:00000E4B 6683F900  	   110M 	cmp $0,%ecx
04:00000E4F 0F85D709  	   111M 	jnz error           		# ECX must be 0
04:00000E53 6681FE0000	   112M 	cmp $off_cmp,%esi
04:00000E58 0100
04:00000E5A 0F85CC09  	   113M 	jne error
04:00000E5E 6681FF0000	   114M 	cmp $off_cmp,%edi
04:00000E63 0100
04:00000E65 0F85C109  	   115M 	jne error
04:00000E69 66BF00FF01	   116M 	mov $off_value,%edi  # reset EDI
04:00000E6E 00
04:00000E6F 66BE00FF01	   117M 	mov $off_value,%esi  # reset ESI
04:00000E74 00
                      	   118M 
                      	   119M 	# SCAN buffer for pattern
04:00000E75 66B9400000	   120M 	mov $items,%ecx      # reset ECX
04:00000E7A 00
                      	   121M 	.if d = b
                      	   122M 		addr16
                      	   123M 		repe
                      	   124M 		scasb         # SCAN first dword not equal to EAX
                      	   125M 	.endif
                      	   126M 	.if d = w
                      	   127M 		addr16
                      	   128M 		repe
                      	   129M 		scasw         # SCAN first dword not equal to EAX
                      	   130M 	.endif
                      	   131M 	.if d = d
04:00000E7B 67        	   132M 		addr16
04:00000E7C F3        	   133M 		repe
04:00000E7D 66AF      	   134M 		scasl         # SCAN first dword not equal to EAX
                      	   135M 	.endif
04:00000E7F 6683F900  	   136M 	cmp $0,%ecx
04:00000E83 0F85A309  	   137M 	jne error           		# ECX must be 0
04:00000E87 6681FF0000	   138M 	cmp $off_cmp,%edi
04:00000E8C 0100
04:00000E8E 0F859809  	   139M 	jne error
04:00000E92 66BF00FF01	   140M 	mov $off_value,%edi  		# rewind EDI
04:00000E97 00
                      	   141M 
                      	   142M 	# MOVE and COMPARE data between buffers
                      	   143M 	# first zero-fill ES:EDI so that we can compare the moved data later
04:00000E98 66B8000000	   144M 	mov $0,%eax
04:00000E9D 00
04:00000E9E 66B9400000	   145M 	mov $items,%ecx      # reset ECX
04:00000EA3 00
                      	   146M 	.if d = b
                      	   147M 		addr16
                      	   148M 		rep
                      	   149M 		stosb          # zero fill ES:EDI
                      	   150M 	.endif
                      	   151M 	.if d = w
                      	   152M 		addr16
                      	   153M 		rep
                      	   154M 		stosw          # zero fill ES:EDI
                      	   155M 	.endif
                      	   156M 	.if d = d
04:00000EA4 67        	   157M 		addr16
04:00000EA5 F3        	   158M 		rep
04:00000EA6 66AB      	   159M 		stosl          # zero fill ES:EDI
                      	   160M 	.endif
04:00000EA8 66BF00FF01	   161M 	mov $off_value,%edi  # reset EDI
04:00000EAD 00
04:00000EAE 66B9400000	   162M 	mov $items,%ecx      # reset ECX
04:00000EB3 00
                      	   163M 	.if d = b
                      	   164M 		addr16
                      	   165M 		rep
                      	   166M 		movsb          # MOVE data from DS:ESI to ES:EDI
                      	   167M 	.endif
                      	   168M 	.if d = w
                      	   169M 		addr16
                      	   170M 		rep
                      	   171M 		movsw          # MOVE data from DS:ESI to ES:EDI
                      	   172M 	.endif
                      	   173M 	.if d = d
04:00000EB4 67        	   174M 		addr16
04:00000EB5 F3        	   175M 		rep
04:00000EB6 66A5      	   176M 		movsl          # MOVE data from DS:ESI to ES:EDI
                      	   177M 	.endif
04:00000EB8 6683F900  	   178M 	cmp $0,%ecx
04:00000EBC 0F856A09  	   179M 	jne error           	# ECX must be 0
04:00000EC0 6681FE0000	   180M 	cmp $off_cmp,%esi
04:00000EC5 0100
04:00000EC7 0F855F09  	   181M 	jne error
04:00000ECB 6681FF0000	   182M 	cmp $off_cmp,%edi
04:00000ED0 0100
04:00000ED2 0F855409  	   183M 	jne error
04:00000ED6 66B9400000	   184M 	mov $items,%ecx      	# reset ECX
04:00000EDB 00
04:00000EDC 66BF00FF01	   185M 	mov $off_value,%edi  	# reset EDI
04:00000EE1 00
04:00000EE2 66BE00FF01	   186M 	mov $off_value,%esi  	# reset ESI
04:00000EE7 00
                      	   187M 	.if d = b
                      	   188M 		addr16
                      	   189M 		repe
                      	   190M 		cmpsb  # COMPARE moved data in ES:EDI with DS:ESI
                      	   191M 	.endif
                      	   192M 	.if d = w
                      	   193M 		addr16
                      	   194M 		repe
                      	   195M 		cmpsw  # COMPARE moved data in ES:EDI with DS:ESI
                      	   196M 	.endif
                      	   197M 	.if d = d
04:00000EE8 67        	   198M 		addr16
04:00000EE9 F3        	   199M 		repe
04:00000EEA 66A7      	   200M 		cmpsl  # COMPARE moved data in ES:EDI with DS:ESI
                      	   201M 	.endif
04:00000EEC 6683F900  	   202M 	cmp $0,%ecx
04:00000EF0 0F853609  	   203M 	jne error           # ECX must be 0
04:00000EF4 6681FE0000	   204M 	cmp $off_cmp,%esi
04:00000EF9 0100
04:00000EFB 0F852B09  	   205M 	jne error
04:00000EFF 6681FF0000	   206M 	cmp $off_cmp,%edi
04:00000F04 0100
04:00000F06 0F852009  	   207M 	jne error
                      	   251: 	testStringReps b,1,16
                      	     1M 
                      	     2M 	.set bytes,0x100
                      	     3M 
                      	     4M 	.if b = b
                      	     5M 		.set items,bytes
                      	     6M 	.endif
                      	     7M 	.if b = w
                      	     8M 		.set items,bytes/2
                      	     9M 	.endif
                      	    10M 	.if b = d
                      	    11M 		.set items,bytes/4
                      	    12M 	.endif
                      	    13M 
                      	    14M 	.if 1 == 0
                      	    15M 		cld
                      	    16M 		.set off_value,0x0001ff00
                      	    17M 		.if 16 = 16
                      	    18M 			# 16-bit addressing
                      	    19M 			.set off_cmp,0x00010000
                      	    20M 		.else
                      	    21M 			# 32-bit addressing
                      	    22M 			.set off_cmp,0x00020000
                      	    23M 		.endif
                      	    24M 	.else
04:00000F0A FD        	    25M 		std
                      	    26M 		.set off_value,0x000100ff
                      	    27M 		.if 16 = 16
                      	    28M 			# 16-bit addressing
                      	    29M 			.set off_cmp,0x0001ffff
                      	    30M 		.else
                      	    31M 			# 32-bit addressing
                      	    32M 			.set off_cmp,0x0000ffff
                      	    33M 		.endif
                      	    34M 	.endif
                      	    35M 
04:00000F0B 66B8785634	    36M 	mov $0x12345678,%eax
04:00000F10 12
04:00000F11 66BEFF0001	    37M 	mov $off_value,%esi
04:00000F16 00
04:00000F17 66BFFF0001	    38M 	mov $off_value,%edi
04:00000F1C 00
                      	    39M 
                      	    40M 	# VERIFY REPs on memory buffers
                      	    41M 
                      	    42M 	# STORE buffers with pattern in EAX
04:00000F1D 66B8785634	    43M 	mov $0x12345678,%eax
04:00000F22 12
04:00000F23 66BEFF0001	    44M 	mov $off_value,%esi
04:00000F28 00
04:00000F29 66BFFF0001	    45M 	mov $off_value,%edi
04:00000F2E 00
04:00000F2F 66B9000100	    46M 	mov $items,%ecx
04:00000F34 00
                      	    47M 	.if b = b
04:00000F35 67        	    48M 		addr16
04:00000F36 F3        	    49M 		rep
04:00000F37 AA        	    50M 		stosb    # store ECX items at ES:EDI with the value in EAX
                      	    51M 	.endif
                      	    52M 	.if b = w
                      	    53M 		addr16
                      	    54M 		rep
                      	    55M 		stosw    # store ECX items at ES:EDI with the value in EAX
                      	    56M 	.endif
                      	    57M 	.if b = d
                      	    58M 		addr16
                      	    59M 		rep
                      	    60M 		stosl    # store ECX items at ES:EDI with the value in EAX
                      	    61M 	.endif
04:00000F38 6683F900  	    62M 	cmp $0,%ecx
04:00000F3C 0F85EA08  	    63M 	jnz error           		# ECX must be 0
04:00000F40 6681FFFFFF	    64M 	cmp $off_cmp,%edi
04:00000F45 0100
04:00000F47 0F85DF08  	    65M 	jnz error
04:00000F4B 66BFFF0001	    66M 	mov $off_value,%edi  # reset EDI
04:00000F50 00
                      	    67M 	# now switch ES:EDI with DS:ESI
04:00000F51 8CC2      	    68M 	mov %es,%dx
04:00000F53 8CD9      	    69M 	mov %ds,%cx
04:00000F55 87CA      	    70M 	xchg %cx,%dx
04:00000F57 8EC2      	    71M 	mov %dx,%es
04:00000F59 8ED9      	    72M 	mov %cx,%ds
04:00000F5B 6687F7    	    73M 	xchg %esi,%edi
                      	    74M 	# store again ES:EDI with pattern in EAX
04:00000F5E 66B9000100	    75M 	mov $items,%ecx      	# reset ECX
04:00000F63 00
                      	    76M 	.if b = b
04:00000F64 67        	    77M 		addr16
04:00000F65 F3        	    78M 		rep
04:00000F66 AA        	    79M 		stosb
                      	    80M 	.endif
                      	    81M 	.if b = w
                      	    82M 		addr16
                      	    83M 		rep
                      	    84M 		stosw
                      	    85M 	.endif
                      	    86M 	.if b = d
                      	    87M 		addr16
                      	    88M 		rep
                      	    89M 		stosl
                      	    90M 	.endif
04:00000F67 66BFFF0001	    91M 	mov $off_value,%edi  	# reset EDI
04:00000F6C 00
                      	    92M 
                      	    93M 	# COMPARE two buffers
04:00000F6D 66B9000100	    94M 	mov $items,%ecx      # reset ECX
04:00000F72 00
                      	    95M 	.if b = b
04:00000F73 67        	    96M 		addr16
04:00000F74 F3        	    97M 		repe
04:00000F75 A6        	    98M 		cmpsb # find nonmatching items in ES:EDI and DS:ESI
                      	    99M 	.endif
                      	   100M 	.if b = w
                      	   101M 		addr16
                      	   102M 		repe
                      	   103M 		cmpsw # find nonmatching items in ES:EDI and DS:ESI
                      	   104M 	.endif
                      	   105M 	.if b = d
                      	   106M 		addr16
                      	   107M 		repe
                      	   108M 		cmpsl # find nonmatching items in ES:EDI and DS:ESI
                      	   109M 	.endif
04:00000F76 6683F900  	   110M 	cmp $0,%ecx
04:00000F7A 0F85AC08  	   111M 	jnz error           		# ECX must be 0
04:00000F7E 6681FEFFFF	   112M 	cmp $off_cmp,%esi
04:00000F83 0100
04:00000F85 0F85A108  	   113M 	jne error
04:00000F89 6681FFFFFF	   114M 	cmp $off_cmp,%edi
04:00000F8E 0100
04:00000F90 0F859608  	   115M 	jne error
04:00000F94 66BFFF0001	   116M 	mov $off_value,%edi  # reset EDI
04:00000F99 00
04:00000F9A 66BEFF0001	   117M 	mov $off_value,%esi  # reset ESI
04:00000F9F 00
                      	   118M 
                      	   119M 	# SCAN buffer for pattern
04:00000FA0 66B9000100	   120M 	mov $items,%ecx      # reset ECX
04:00000FA5 00
                      	   121M 	.if b = b
04:00000FA6 67        	   122M 		addr16
04:00000FA7 F3        	   123M 		repe
04:00000FA8 AE        	   124M 		scasb         # SCAN first dword not equal to EAX
                      	   125M 	.endif
                      	   126M 	.if b = w
                      	   127M 		addr16
                      	   128M 		repe
                      	   129M 		scasw         # SCAN first dword not equal to EAX
                      	   130M 	.endif
                      	   131M 	.if b = d
                      	   132M 		addr16
                      	   133M 		repe
                      	   134M 		scasl         # SCAN first dword not equal to EAX
                      	   135M 	.endif
04:00000FA9 6683F900  	   136M 	cmp $0,%ecx
04:00000FAD 0F857908  	   137M 	jne error           		# ECX must be 0
04:00000FB1 6681FFFFFF	   138M 	cmp $off_cmp,%edi
04:00000FB6 0100
04:00000FB8 0F856E08  	   139M 	jne error
04:00000FBC 66BFFF0001	   140M 	mov $off_value,%edi  		# rewind EDI
04:00000FC1 00
                      	   141M 
                      	   142M 	# MOVE and COMPARE data between buffers
                      	   143M 	# first zero-fill ES:EDI so that we can compare the moved data later
04:00000FC2 66B8000000	   144M 	mov $0,%eax
04:00000FC7 00
04:00000FC8 66B9000100	   145M 	mov $items,%ecx      # reset ECX
04:00000FCD 00
                      	   146M 	.if b = b
04:00000FCE 67        	   147M 		addr16
04:00000FCF F3        	   148M 		rep
04:00000FD0 AA        	   149M 		stosb          # zero fill ES:EDI
                      	   150M 	.endif
                      	   151M 	.if b = w
                      	   152M 		addr16
                      	   153M 		rep
                      	   154M 		stosw          # zero fill ES:EDI
                      	   155M 	.endif
                      	   156M 	.if b = d
                      	   157M 		addr16
                      	   158M 		rep
                      	   159M 		stosl          # zero fill ES:EDI
                      	   160M 	.endif
04:00000FD1 66BFFF0001	   161M 	mov $off_value,%edi  # reset EDI
04:00000FD6 00
04:00000FD7 66B9000100	   162M 	mov $items,%ecx      # reset ECX
04:00000FDC 00
                      	   163M 	.if b = b
04:00000FDD 67        	   164M 		addr16
04:00000FDE F3        	   165M 		rep
04:00000FDF A4        	   166M 		movsb          # MOVE data from DS:ESI to ES:EDI
                      	   167M 	.endif
                      	   168M 	.if b = w
                      	   169M 		addr16
                      	   170M 		rep
                      	   171M 		movsw          # MOVE data from DS:ESI to ES:EDI
                      	   172M 	.endif
                      	   173M 	.if b = d
                      	   174M 		addr16
                      	   175M 		rep
                      	   176M 		movsl          # MOVE data from DS:ESI to ES:EDI
                      	   177M 	.endif
04:00000FE0 6683F900  	   178M 	cmp $0,%ecx
04:00000FE4 0F854208  	   179M 	jne error           	# ECX must be 0
04:00000FE8 6681FEFFFF	   180M 	cmp $off_cmp,%esi
04:00000FED 0100
04:00000FEF 0F853708  	   181M 	jne error
04:00000FF3 6681FFFFFF	   182M 	cmp $off_cmp,%edi
04:00000FF8 0100
04:00000FFA 0F852C08  	   183M 	jne error
04:00000FFE 66B9000100	   184M 	mov $items,%ecx      	# reset ECX
04:00001003 00
04:00001004 66BFFF0001	   185M 	mov $off_value,%edi  	# reset EDI
04:00001009 00
04:0000100A 66BEFF0001	   186M 	mov $off_value,%esi  	# reset ESI
04:0000100F 00
                      	   187M 	.if b = b
04:00001010 67        	   188M 		addr16
04:00001011 F3        	   189M 		repe
04:00001012 A6        	   190M 		cmpsb  # COMPARE moved data in ES:EDI with DS:ESI
                      	   191M 	.endif
                      	   192M 	.if b = w
                      	   193M 		addr16
                      	   194M 		repe
                      	   195M 		cmpsw  # COMPARE moved data in ES:EDI with DS:ESI
                      	   196M 	.endif
                      	   197M 	.if b = d
                      	   198M 		addr16
                      	   199M 		repe
                      	   200M 		cmpsl  # COMPARE moved data in ES:EDI with DS:ESI
                      	   201M 	.endif
04:00001013 6683F900  	   202M 	cmp $0,%ecx
04:00001017 0F850F08  	   203M 	jne error           # ECX must be 0
04:0000101B 6681FEFFFF	   204M 	cmp $off_cmp,%esi
04:00001020 0100
04:00001022 0F850408  	   205M 	jne error
04:00001026 6681FFFFFF	   206M 	cmp $off_cmp,%edi
04:0000102B 0100
04:0000102D 0F85F907  	   207M 	jne error
                      	   252: 	testStringReps w,1,16
                      	     1M 
                      	     2M 	.set bytes,0x100
                      	     3M 
                      	     4M 	.if w = b
                      	     5M 		.set items,bytes
                      	     6M 	.endif
                      	     7M 	.if w = w
                      	     8M 		.set items,bytes/2
                      	     9M 	.endif
                      	    10M 	.if w = d
                      	    11M 		.set items,bytes/4
                      	    12M 	.endif
                      	    13M 
                      	    14M 	.if 1 == 0
                      	    15M 		cld
                      	    16M 		.set off_value,0x0001ff00
                      	    17M 		.if 16 = 16
                      	    18M 			# 16-bit addressing
                      	    19M 			.set off_cmp,0x00010000
                      	    20M 		.else
                      	    21M 			# 32-bit addressing
                      	    22M 			.set off_cmp,0x00020000
                      	    23M 		.endif
                      	    24M 	.else
04:00001031 FD        	    25M 		std
                      	    26M 		.set off_value,0x000100ff
                      	    27M 		.if 16 = 16
                      	    28M 			# 16-bit addressing
                      	    29M 			.set off_cmp,0x0001ffff
                      	    30M 		.else
                      	    31M 			# 32-bit addressing
                      	    32M 			.set off_cmp,0x0000ffff
                      	    33M 		.endif
                      	    34M 	.endif
                      	    35M 
04:00001032 66B8785634	    36M 	mov $0x12345678,%eax
04:00001037 12
04:00001038 66BEFF0001	    37M 	mov $off_value,%esi
04:0000103D 00
04:0000103E 66BFFF0001	    38M 	mov $off_value,%edi
04:00001043 00
                      	    39M 
                      	    40M 	# VERIFY REPs on memory buffers
                      	    41M 
                      	    42M 	# STORE buffers with pattern in EAX
04:00001044 66B8785634	    43M 	mov $0x12345678,%eax
04:00001049 12
04:0000104A 66BEFF0001	    44M 	mov $off_value,%esi
04:0000104F 00
04:00001050 66BFFF0001	    45M 	mov $off_value,%edi
04:00001055 00
04:00001056 66B9800000	    46M 	mov $items,%ecx
04:0000105B 00
                      	    47M 	.if w = b
                      	    48M 		addr16
                      	    49M 		rep
                      	    50M 		stosb    # store ECX items at ES:EDI with the value in EAX
                      	    51M 	.endif
                      	    52M 	.if w = w
04:0000105C 67        	    53M 		addr16
04:0000105D F3        	    54M 		rep
04:0000105E AB        	    55M 		stosw    # store ECX items at ES:EDI with the value in EAX
                      	    56M 	.endif
                      	    57M 	.if w = d
                      	    58M 		addr16
                      	    59M 		rep
                      	    60M 		stosl    # store ECX items at ES:EDI with the value in EAX
                      	    61M 	.endif
04:0000105F 6683F900  	    62M 	cmp $0,%ecx
04:00001063 0F85C307  	    63M 	jnz error           		# ECX must be 0
04:00001067 6681FFFFFF	    64M 	cmp $off_cmp,%edi
04:0000106C 0100
04:0000106E 0F85B807  	    65M 	jnz error
04:00001072 66BFFF0001	    66M 	mov $off_value,%edi  # reset EDI
04:00001077 00
                      	    67M 	# now switch ES:EDI with DS:ESI
04:00001078 8CC2      	    68M 	mov %es,%dx
04:0000107A 8CD9      	    69M 	mov %ds,%cx
04:0000107C 87CA      	    70M 	xchg %cx,%dx
04:0000107E 8EC2      	    71M 	mov %dx,%es
04:00001080 8ED9      	    72M 	mov %cx,%ds
04:00001082 6687F7    	    73M 	xchg %esi,%edi
                      	    74M 	# store again ES:EDI with pattern in EAX
04:00001085 66B9800000	    75M 	mov $items,%ecx      	# reset ECX
04:0000108A 00
                      	    76M 	.if w = b
                      	    77M 		addr16
                      	    78M 		rep
                      	    79M 		stosb
                      	    80M 	.endif
                      	    81M 	.if w = w
04:0000108B 67        	    82M 		addr16
04:0000108C F3        	    83M 		rep
04:0000108D AB        	    84M 		stosw
                      	    85M 	.endif
                      	    86M 	.if w = d
                      	    87M 		addr16
                      	    88M 		rep
                      	    89M 		stosl
                      	    90M 	.endif
04:0000108E 66BFFF0001	    91M 	mov $off_value,%edi  	# reset EDI
04:00001093 00
                      	    92M 
                      	    93M 	# COMPARE two buffers
04:00001094 66B9800000	    94M 	mov $items,%ecx      # reset ECX
04:00001099 00
                      	    95M 	.if w = b
                      	    96M 		addr16
                      	    97M 		repe
                      	    98M 		cmpsb # find nonmatching items in ES:EDI and DS:ESI
                      	    99M 	.endif
                      	   100M 	.if w = w
04:0000109A 67        	   101M 		addr16
04:0000109B F3        	   102M 		repe
04:0000109C A7        	   103M 		cmpsw # find nonmatching items in ES:EDI and DS:ESI
                      	   104M 	.endif
                      	   105M 	.if w = d
                      	   106M 		addr16
                      	   107M 		repe
                      	   108M 		cmpsl # find nonmatching items in ES:EDI and DS:ESI
                      	   109M 	.endif
04:0000109D 6683F900  	   110M 	cmp $0,%ecx
04:000010A1 0F858507  	   111M 	jnz error           		# ECX must be 0
04:000010A5 6681FEFFFF	   112M 	cmp $off_cmp,%esi
04:000010AA 0100
04:000010AC 0F857A07  	   113M 	jne error
04:000010B0 6681FFFFFF	   114M 	cmp $off_cmp,%edi
04:000010B5 0100
04:000010B7 0F856F07  	   115M 	jne error
04:000010BB 66BFFF0001	   116M 	mov $off_value,%edi  # reset EDI
04:000010C0 00
04:000010C1 66BEFF0001	   117M 	mov $off_value,%esi  # reset ESI
04:000010C6 00
                      	   118M 
                      	   119M 	# SCAN buffer for pattern
04:000010C7 66B9800000	   120M 	mov $items,%ecx      # reset ECX
04:000010CC 00
                      	   121M 	.if w = b
                      	   122M 		addr16
                      	   123M 		repe
                      	   124M 		scasb         # SCAN first dword not equal to EAX
                      	   125M 	.endif
                      	   126M 	.if w = w
04:000010CD 67        	   127M 		addr16
04:000010CE F3        	   128M 		repe
04:000010CF AF        	   129M 		scasw         # SCAN first dword not equal to EAX
                      	   130M 	.endif
                      	   131M 	.if w = d
                      	   132M 		addr16
                      	   133M 		repe
                      	   134M 		scasl         # SCAN first dword not equal to EAX
                      	   135M 	.endif
04:000010D0 6683F900  	   136M 	cmp $0,%ecx
04:000010D4 0F855207  	   137M 	jne error           		# ECX must be 0
04:000010D8 6681FFFFFF	   138M 	cmp $off_cmp,%edi
04:000010DD 0100
04:000010DF 0F854707  	   139M 	jne error
04:000010E3 66BFFF0001	   140M 	mov $off_value,%edi  		# rewind EDI
04:000010E8 00
                      	   141M 
                      	   142M 	# MOVE and COMPARE data between buffers
                      	   143M 	# first zero-fill ES:EDI so that we can compare the moved data later
04:000010E9 66B8000000	   144M 	mov $0,%eax
04:000010EE 00
04:000010EF 66B9800000	   145M 	mov $items,%ecx      # reset ECX
04:000010F4 00
                      	   146M 	.if w = b
                      	   147M 		addr16
                      	   148M 		rep
                      	   149M 		stosb          # zero fill ES:EDI
                      	   150M 	.endif
                      	   151M 	.if w = w
04:000010F5 67        	   152M 		addr16
04:000010F6 F3        	   153M 		rep
04:000010F7 AB        	   154M 		stosw          # zero fill ES:EDI
                      	   155M 	.endif
                      	   156M 	.if w = d
                      	   157M 		addr16
                      	   158M 		rep
                      	   159M 		stosl          # zero fill ES:EDI
                      	   160M 	.endif
04:000010F8 66BFFF0001	   161M 	mov $off_value,%edi  # reset EDI
04:000010FD 00
04:000010FE 66B9800000	   162M 	mov $items,%ecx      # reset ECX
04:00001103 00
                      	   163M 	.if w = b
                      	   164M 		addr16
                      	   165M 		rep
                      	   166M 		movsb          # MOVE data from DS:ESI to ES:EDI
                      	   167M 	.endif
                      	   168M 	.if w = w
04:00001104 67        	   169M 		addr16
04:00001105 F3        	   170M 		rep
04:00001106 A5        	   171M 		movsw          # MOVE data from DS:ESI to ES:EDI
                      	   172M 	.endif
                      	   173M 	.if w = d
                      	   174M 		addr16
                      	   175M 		rep
                      	   176M 		movsl          # MOVE data from DS:ESI to ES:EDI
                      	   177M 	.endif
04:00001107 6683F900  	   178M 	cmp $0,%ecx
04:0000110B 0F851B07  	   179M 	jne error           	# ECX must be 0
04:0000110F 6681FEFFFF	   180M 	cmp $off_cmp,%esi
04:00001114 0100
04:00001116 0F851007  	   181M 	jne error
04:0000111A 6681FFFFFF	   182M 	cmp $off_cmp,%edi
04:0000111F 0100
04:00001121 0F850507  	   183M 	jne error
04:00001125 66B9800000	   184M 	mov $items,%ecx      	# reset ECX
04:0000112A 00
04:0000112B 66BFFF0001	   185M 	mov $off_value,%edi  	# reset EDI
04:00001130 00
04:00001131 66BEFF0001	   186M 	mov $off_value,%esi  	# reset ESI
04:00001136 00
                      	   187M 	.if w = b
                      	   188M 		addr16
                      	   189M 		repe
                      	   190M 		cmpsb  # COMPARE moved data in ES:EDI with DS:ESI
                      	   191M 	.endif
                      	   192M 	.if w = w
04:00001137 67        	   193M 		addr16
04:00001138 F3        	   194M 		repe
04:00001139 A7        	   195M 		cmpsw  # COMPARE moved data in ES:EDI with DS:ESI
                      	   196M 	.endif
                      	   197M 	.if w = d
                      	   198M 		addr16
                      	   199M 		repe
                      	   200M 		cmpsl  # COMPARE moved data in ES:EDI with DS:ESI
                      	   201M 	.endif
04:0000113A 6683F900  	   202M 	cmp $0,%ecx
04:0000113E 0F85E806  	   203M 	jne error           # ECX must be 0
04:00001142 6681FEFFFF	   204M 	cmp $off_cmp,%esi
04:00001147 0100
04:00001149 0F85DD06  	   205M 	jne error
04:0000114D 6681FFFFFF	   206M 	cmp $off_cmp,%edi
04:00001152 0100
04:00001154 0F85D206  	   207M 	jne error
                      	   253: 	testStringReps d,1,16
                      	     1M 
                      	     2M 	.set bytes,0x100
                      	     3M 
                      	     4M 	.if d = b
                      	     5M 		.set items,bytes
                      	     6M 	.endif
                      	     7M 	.if d = w
                      	     8M 		.set items,bytes/2
                      	     9M 	.endif
                      	    10M 	.if d = d
                      	    11M 		.set items,bytes/4
                      	    12M 	.endif
                      	    13M 
                      	    14M 	.if 1 == 0
                      	    15M 		cld
                      	    16M 		.set off_value,0x0001ff00
                      	    17M 		.if 16 = 16
                      	    18M 			# 16-bit addressing
                      	    19M 			.set off_cmp,0x00010000
                      	    20M 		.else
                      	    21M 			# 32-bit addressing
                      	    22M 			.set off_cmp,0x00020000
                      	    23M 		.endif
                      	    24M 	.else
04:00001158 FD        	    25M 		std
                      	    26M 		.set off_value,0x000100ff
                      	    27M 		.if 16 = 16
                      	    28M 			# 16-bit addressing
                      	    29M 			.set off_cmp,0x0001ffff
                      	    30M 		.else
                      	    31M 			# 32-bit addressing
                      	    32M 			.set off_cmp,0x0000ffff
                      	    33M 		.endif
                      	    34M 	.endif
                      	    35M 
04:00001159 66B8785634	    36M 	mov $0x12345678,%eax
04:0000115E 12
04:0000115F 66BEFF0001	    37M 	mov $off_value,%esi
04:00001164 00
04:00001165 66BFFF0001	    38M 	mov $off_value,%edi
04:0000116A 00
                      	    39M 
                      	    40M 	# VERIFY REPs on memory buffers
                      	    41M 
                      	    42M 	# STORE buffers with pattern in EAX
04:0000116B 66B8785634	    43M 	mov $0x12345678,%eax
04:00001170 12
04:00001171 66BEFF0001	    44M 	mov $off_value,%esi
04:00001176 00
04:00001177 66BFFF0001	    45M 	mov $off_value,%edi
04:0000117C 00
04:0000117D 66B9400000	    46M 	mov $items,%ecx
04:00001182 00
                      	    47M 	.if d = b
                      	    48M 		addr16
                      	    49M 		rep
                      	    50M 		stosb    # store ECX items at ES:EDI with the value in EAX
                      	    51M 	.endif
                      	    52M 	.if d = w
                      	    53M 		addr16
                      	    54M 		rep
                      	    55M 		stosw    # store ECX items at ES:EDI with the value in EAX
                      	    56M 	.endif
                      	    57M 	.if d = d
04:00001183 67        	    58M 		addr16
04:00001184 F3        	    59M 		rep
04:00001185 66AB      	    60M 		stosl    # store ECX items at ES:EDI with the value in EAX
                      	    61M 	.endif
04:00001187 6683F900  	    62M 	cmp $0,%ecx
04:0000118B 0F859B06  	    63M 	jnz error           		# ECX must be 0
04:0000118F 6681FFFFFF	    64M 	cmp $off_cmp,%edi
04:00001194 0100
04:00001196 0F859006  	    65M 	jnz error
04:0000119A 66BFFF0001	    66M 	mov $off_value,%edi  # reset EDI
04:0000119F 00
                      	    67M 	# now switch ES:EDI with DS:ESI
04:000011A0 8CC2      	    68M 	mov %es,%dx
04:000011A2 8CD9      	    69M 	mov %ds,%cx
04:000011A4 87CA      	    70M 	xchg %cx,%dx
04:000011A6 8EC2      	    71M 	mov %dx,%es
04:000011A8 8ED9      	    72M 	mov %cx,%ds
04:000011AA 6687F7    	    73M 	xchg %esi,%edi
                      	    74M 	# store again ES:EDI with pattern in EAX
04:000011AD 66B9400000	    75M 	mov $items,%ecx      	# reset ECX
04:000011B2 00
                      	    76M 	.if d = b
                      	    77M 		addr16
                      	    78M 		rep
                      	    79M 		stosb
                      	    80M 	.endif
                      	    81M 	.if d = w
                      	    82M 		addr16
                      	    83M 		rep
                      	    84M 		stosw
                      	    85M 	.endif
                      	    86M 	.if d = d
04:000011B3 67        	    87M 		addr16
04:000011B4 F3        	    88M 		rep
04:000011B5 66AB      	    89M 		stosl
                      	    90M 	.endif
04:000011B7 66BFFF0001	    91M 	mov $off_value,%edi  	# reset EDI
04:000011BC 00
                      	    92M 
                      	    93M 	# COMPARE two buffers
04:000011BD 66B9400000	    94M 	mov $items,%ecx      # reset ECX
04:000011C2 00
                      	    95M 	.if d = b
                      	    96M 		addr16
                      	    97M 		repe
                      	    98M 		cmpsb # find nonmatching items in ES:EDI and DS:ESI
                      	    99M 	.endif
                      	   100M 	.if d = w
                      	   101M 		addr16
                      	   102M 		repe
                      	   103M 		cmpsw # find nonmatching items in ES:EDI and DS:ESI
                      	   104M 	.endif
                      	   105M 	.if d = d
04:000011C3 67        	   106M 		addr16
04:000011C4 F3        	   107M 		repe
04:000011C5 66A7      	   108M 		cmpsl # find nonmatching items in ES:EDI and DS:ESI
                      	   109M 	.endif
04:000011C7 6683F900  	   110M 	cmp $0,%ecx
04:000011CB 0F855B06  	   111M 	jnz error           		# ECX must be 0
04:000011CF 6681FEFFFF	   112M 	cmp $off_cmp,%esi
04:000011D4 0100
04:000011D6 0F855006  	   113M 	jne error
04:000011DA 6681FFFFFF	   114M 	cmp $off_cmp,%edi
04:000011DF 0100
04:000011E1 0F854506  	   115M 	jne error
04:000011E5 66BFFF0001	   116M 	mov $off_value,%edi  # reset EDI
04:000011EA 00
04:000011EB 66BEFF0001	   117M 	mov $off_value,%esi  # reset ESI
04:000011F0 00
                      	   118M 
                      	   119M 	# SCAN buffer for pattern
04:000011F1 66B9400000	   120M 	mov $items,%ecx      # reset ECX
04:000011F6 00
                      	   121M 	.if d = b
                      	   122M 		addr16
                      	   123M 		repe
                      	   124M 		scasb         # SCAN first dword not equal to EAX
                      	   125M 	.endif
                      	   126M 	.if d = w
                      	   127M 		addr16
                      	   128M 		repe
                      	   129M 		scasw         # SCAN first dword not equal to EAX
                      	   130M 	.endif
                      	   131M 	.if d = d
04:000011F7 67        	   132M 		addr16
04:000011F8 F3        	   133M 		repe
04:000011F9 66AF      	   134M 		scasl         # SCAN first dword not equal to EAX
                      	   135M 	.endif
04:000011FB 6683F900  	   136M 	cmp $0,%ecx
04:000011FF 0F852706  	   137M 	jne error           		# ECX must be 0
04:00001203 6681FFFFFF	   138M 	cmp $off_cmp,%edi
04:00001208 0100
04:0000120A 0F851C06  	   139M 	jne error
04:0000120E 66BFFF0001	   140M 	mov $off_value,%edi  		# rewind EDI
04:00001213 00
                      	   141M 
                      	   142M 	# MOVE and COMPARE data between buffers
                      	   143M 	# first zero-fill ES:EDI so that we can compare the moved data later
04:00001214 66B8000000	   144M 	mov $0,%eax
04:00001219 00
04:0000121A 66B9400000	   145M 	mov $items,%ecx      # reset ECX
04:0000121F 00
                      	   146M 	.if d = b
                      	   147M 		addr16
                      	   148M 		rep
                      	   149M 		stosb          # zero fill ES:EDI
                      	   150M 	.endif
                      	   151M 	.if d = w
                      	   152M 		addr16
                      	   153M 		rep
                      	   154M 		stosw          # zero fill ES:EDI
                      	   155M 	.endif
                      	   156M 	.if d = d
04:00001220 67        	   157M 		addr16
04:00001221 F3        	   158M 		rep
04:00001222 66AB      	   159M 		stosl          # zero fill ES:EDI
                      	   160M 	.endif
04:00001224 66BFFF0001	   161M 	mov $off_value,%edi  # reset EDI
04:00001229 00
04:0000122A 66B9400000	   162M 	mov $items,%ecx      # reset ECX
04:0000122F 00
                      	   163M 	.if d = b
                      	   164M 		addr16
                      	   165M 		rep
                      	   166M 		movsb          # MOVE data from DS:ESI to ES:EDI
                      	   167M 	.endif
                      	   168M 	.if d = w
                      	   169M 		addr16
                      	   170M 		rep
                      	   171M 		movsw          # MOVE data from DS:ESI to ES:EDI
                      	   172M 	.endif
                      	   173M 	.if d = d
04:00001230 67        	   174M 		addr16
04:00001231 F3        	   175M 		rep
04:00001232 66A5      	   176M 		movsl          # MOVE data from DS:ESI to ES:EDI
                      	   177M 	.endif
04:00001234 6683F900  	   178M 	cmp $0,%ecx
04:00001238 0F85EE05  	   179M 	jne error           	# ECX must be 0
04:0000123C 6681FEFFFF	   180M 	cmp $off_cmp,%esi
04:00001241 0100
04:00001243 0F85E305  	   181M 	jne error
04:00001247 6681FFFFFF	   182M 	cmp $off_cmp,%edi
04:0000124C 0100
04:0000124E 0F85D805  	   183M 	jne error
04:00001252 66B9400000	   184M 	mov $items,%ecx      	# reset ECX
04:00001257 00
04:00001258 66BFFF0001	   185M 	mov $off_value,%edi  	# reset EDI
04:0000125D 00
04:0000125E 66BEFF0001	   186M 	mov $off_value,%esi  	# reset ESI
04:00001263 00
                      	   187M 	.if d = b
                      	   188M 		addr16
                      	   189M 		repe
                      	   190M 		cmpsb  # COMPARE moved data in ES:EDI with DS:ESI
                      	   191M 	.endif
                      	   192M 	.if d = w
                      	   193M 		addr16
                      	   194M 		repe
                      	   195M 		cmpsw  # COMPARE moved data in ES:EDI with DS:ESI
                      	   196M 	.endif
                      	   197M 	.if d = d
04:00001264 67        	   198M 		addr16
04:00001265 F3        	   199M 		repe
04:00001266 66A7      	   200M 		cmpsl  # COMPARE moved data in ES:EDI with DS:ESI
                      	   201M 	.endif
04:00001268 6683F900  	   202M 	cmp $0,%ecx
04:0000126C 0F85BA05  	   203M 	jne error           # ECX must be 0
04:00001270 6681FEFFFF	   204M 	cmp $off_cmp,%esi
04:00001275 0100
04:00001277 0F85AF05  	   205M 	jne error
04:0000127B 6681FFFFFF	   206M 	cmp $off_cmp,%edi
04:00001280 0100
04:00001282 0F85A405  	   207M 	jne error
                      	   254: 
                      	   255: 	advTestSegReal
                      	     1M 	advTestBase
                      	     1M 	.set TEST_BASE1,TEST_BASE1+0x1000
                      	     2M 	.set TEST_BASE2,TEST_BASE2+0x1000
                      	     2M 	.set D1_SEG_REAL,TEST_BASE1 >> 4
                      	     3M 	.set D2_SEG_REAL,TEST_BASE2 >> 4
04:00001286 C7C200C2  	     4M 	mov $D1_SEG_REAL,%dx
04:0000128A 8EDA      	     5M 	mov %dx,%ds
04:0000128C C7C200C4  	     6M 	mov $D2_SEG_REAL,%dx
04:00001290 8EC2      	     7M 	mov %dx,%es
                      	   256: 
                      	   257: .include "call_m.asm"

Source: "call_m.asm"
                      	     1: #
                      	     2: #   Tests Call near by displacement and register indirect
                      	     3: #   Stack must be initilized.
                      	     4: #   %1: stack pointer register
                      	     5: #   Uses: AX, EBX, Flags
                      	     6: #
                      	     7: .macro testCallNear arg1
                      	     8: 
                      	     9: 	.if \arg1 = sp
                      	    10: 		mov \arg1,%ax
                      	    11: rel16\@:
                      	    12: 		clc
                      	    13: 		data16
                      	    14: 		callw nearfn16\@
                      	    15: 		jnc error
                      	    16: 		jmp rel32\@
                      	    17: nearfn16\@:
                      	    18: 		sub $2,%ax
                      	    19: 		cmp %ax,\arg1
                      	    20: 		jne error
                      	    21: 		add $2,%ax
                      	    22: 		stc
                      	    23: 		data16
                      	    24: 		ret
                      	    25: 		jmp error
                      	    26: 
                      	    27: rel32\@:
                      	    28: 		clc
                      	    29: 		data32
                      	    30: 		calll nearfn32\@
                      	    31: 		jnc error
                      	    32: 		jmp rm16\@
                      	    33: nearfn32\@:
                      	    34: 		sub $4,%ax
                      	    35: 		cmp %ax,\arg1
                      	    36: 		jne error
                      	    37: 		add $4,%ax
                      	    38: 		stc
                      	    39: 		data32
                      	    40: 		ret
                      	    41: 		jmp error
                      	    42: 
                      	    43: rm16\@:
                      	    44: 		clc
                      	    45: 		mov $nearfn16\@,%bx
                      	    46: 		data16
                      	    47: 		call %bx
                      	    48: 		jnc error
                      	    49: rm32\@:
                      	    50: 		clc
                      	    51: 		mov $nearfn32,%ebx
                      	    52: 		data32
                      	    53: 		call %ebx
                      	    54: 		jnc error
                      	    55: 	.else
                      	    56: 		mov \arg1,%eax
                      	    57: rel16\@:
                      	    58: 		clc
                      	    59: 		data16
                      	    60: 		callw nearfn16\@
                      	    61: 		jnc error
                      	    62: 		jmp rel32\@
                      	    63: nearfn16\@:
                      	    64: 		sub $2,%eax
                      	    65: 		cmp %eax,\arg1
                      	    66: 		jne error
                      	    67: 		add $2,%eax
                      	    68: 		stc
                      	    69: 		data16
                      	    70: 		ret
                      	    71: 		jmp error
                      	    72: 
                      	    73: rel32\@:
                      	    74: 		clc
                      	    75: 		data32
                      	    76: 		calll nearfn32\@
                      	    77: 		jnc error
                      	    78: 		jmp rm16\@
                      	    79: nearfn32\@:
                      	    80: 		sub $4,%eax
                      	    81: 		cmp %eax,\arg1
                      	    82: 		jne error
                      	    83: 		add $4,%eax
                      	    84: 		stc
                      	    85: 		data32
                      	    86: 		ret
                      	    87: 		jmp error
                      	    88: 
                      	    89: rm16\@:
                      	    90: 		clc
                      	    91: 		mov $nearfn16\@,%bx
                      	    92: 		data16
                      	    93: 		call %bx
                      	    94: 		jnc error
                      	    95: rm32\@:
                      	    96: 		clc
                      	    97: 		mov $nearfn32,%ebx
                      	    98: 		data32
                      	    99: 		call %ebx
                      	   100: 		jnc error
                      	   101: 	.endif
                      	   102: .endm
                      	   103: 
                      	   104: #
                      	   105: #   Tests Call far by immediate and memory pointers
                      	   106: #   Stack must be initilized
                      	   107: #   %1: code segment
                      	   108: #   Uses: AX, Flags, DS:SI as scratch memory
                      	   109: #
                      	   110: .macro testCallFar arg1
                      	   111: 	mov %sp,%ax
                      	   112: 
                      	   113: 	clc
                      	   114: 	data16
                      	   115: 	callw \arg1:farfn16\@
                      	   116: 	jnc error
                      	   117: 	jmp o32\@
                      	   118: farfn16\@:
                      	   119: 	sub $4,%ax
                      	   120: 	cmp %ax,%sp
                      	   121: 	jne error
                      	   122: 	add $4,%ax
                      	   123: 	stc
                      	   124: 	data16
                      	   125: 	retl
                      	   126: 	jmp error
                      	   127: 
                      	   128: o32\@:
                      	   129: 	clc
                      	   130: 	data32
                      	   131: 	calll \arg1:farfn32\@
                      	   132: 	jnc error
                      	   133: 	jmp m1616\@
                      	   134: farfn32\@:
                      	   135: 	sub $8,%ax
                      	   136: 	cmp %ax,%sp
                      	   137: 	jne error
                      	   138: 	add $8,%ax
                      	   139: 	stc
                      	   140: 	data32
                      	   141: 	retl
                      	   142: 	jmp error
                      	   143: 
                      	   144: m1616\@:
                      	   145: 	clc
                      	   146: 	movw $farfn16\@,(%si)
                      	   147: 	movw $\arg1,2(%si)
                      	   148: 	data16
                      	   149: 	calll (%si)
                      	   150: 	jnc error
                      	   151: m1632\@:
                      	   152: 	clc
                      	   153: 	movl $farfn32\@,(%si)
                      	   154: 	movw $\arg1,4(%si)
                      	   155: 	data32
                      	   156: 	calll (%si)
                      	   157: 	jnc error
                      	   158: exit\@:
                      	   159: .endm
                      	   160: 

Source: "t386.asm"
                      	   258: #-------------------------------------------------------------------------------
                      	   259: 	POST $0x05
04:00001292 B005      	     1M 	movb $0x05,%al
04:00001294 BA9001    	     2M 	movw $POST_PORT,%dx
04:00001297 EE        	     3M 	out %al,%dx
                      	   260: #-------------------------------------------------------------------------------
                      	   261: #
                      	   262: #   Calls in real mode
                      	   263: #
                      	   264: .set sp,0
04:00001298 BE0000    	   265: 	mov $0,%si
                      	   266: 	testCallNear sp
                      	     1M 
                      	     2M 	.if sp = sp
04:0000129B A10000    	     3M 		mov sp,%ax
                      	     4M rel1651:
04:0000129E F8        	     5M 		clc
04:0000129F 66        	     6M 		data16
04:000012A0 E80600    	     7M 		callw nearfn1651
04:000012A3 0F838305  	     8M 		jnc error
04:000012A7 EB14      	     9M 		jmp rel3251
                      	    10M nearfn1651:
04:000012A9 83E802    	    11M 		sub $2,%ax
04:000012AC 39060000  	    12M 		cmp %ax,sp
04:000012B0 0F857605  	    13M 		jne error
04:000012B4 83C002    	    14M 		add $2,%ax
04:000012B7 F9        	    15M 		stc
04:000012B8 66        	    16M 		data16
04:000012B9 C3        	    17M 		ret
04:000012BA E96D05    	    18M 		jmp error
                      	    19M 
                      	    20M rel3251:
04:000012BD F8        	    21M 		clc
04:000012BE 66        	    22M 		data32
04:000012BF 66E80600  	    23M 		calll nearfn3251
04:000012C3 0F836305  	    24M 		jnc error
04:000012C7 EB14      	    25M 		jmp rm1651
                      	    26M nearfn3251:
04:000012C9 83E804    	    27M 		sub $4,%ax
04:000012CC 39060000  	    28M 		cmp %ax,sp
04:000012D0 0F855605  	    29M 		jne error
04:000012D4 83C004    	    30M 		add $4,%ax
04:000012D7 F9        	    31M 		stc
04:000012D8 66        	    32M 		data32
04:000012D9 C3        	    33M 		ret
04:000012DA E94D05    	    34M 		jmp error
                      	    35M 
                      	    36M rm1651:
04:000012DD F8        	    37M 		clc
04:000012DE BBA912    	    38M 		mov $nearfn1651,%bx
04:000012E1 66        	    39M 		data16
04:000012E2 FFD3      	    40M 		call %bx
04:000012E4 0F834205  	    41M 		jnc error
                      	    42M rm3251:
04:000012E8 F8        	    43M 		clc
04:000012E9 66BB000000	    44M 		mov $nearfn32,%ebx
04:000012EE 00
04:000012EF 66        	    45M 		data32
04:000012F0 66FFD3    	    46M 		call %ebx
04:000012F3 0F833305  	    47M 		jnc error
                      	    48M 	.else
                      	    49M 		mov sp,%eax
                      	    50M rel1651:
                      	    51M 		clc
                      	    52M 		data16
                      	    53M 		callw nearfn1651
                      	    54M 		jnc error
                      	    55M 		jmp rel3251
                      	    56M nearfn1651:
                      	    57M 		sub $2,%eax
                      	    58M 		cmp %eax,sp
                      	    59M 		jne error
                      	    60M 		add $2,%eax
                      	    61M 		stc
                      	    62M 		data16
                      	    63M 		ret
                      	    64M 		jmp error
                      	    65M 
                      	    66M rel3251:
                      	    67M 		clc
                      	    68M 		data32
                      	    69M 		calll nearfn3251
                      	    70M 		jnc error
                      	    71M 		jmp rm1651
                      	    72M nearfn3251:
                      	    73M 		sub $4,%eax
                      	    74M 		cmp %eax,sp
                      	    75M 		jne error
                      	    76M 		add $4,%eax
                      	    77M 		stc
                      	    78M 		data32
                      	    79M 		ret
                      	    80M 		jmp error
                      	    81M 
                      	    82M rm1651:
                      	    83M 		clc
                      	    84M 		mov $nearfn1651,%bx
                      	    85M 		data16
                      	    86M 		call %bx
                      	    87M 		jnc error
                      	    88M rm3251:
                      	    89M 		clc
                      	    90M 		mov $nearfn32,%ebx
                      	    91M 		data32
                      	    92M 		call %ebx
                      	    93M 		jnc error
                      	    94M 	.endif
                      	   267: 	testCallFar C_SEG_REAL
04:000012F7 89E0      	     1M 	mov %sp,%ax
                      	     2M 
04:000012F9 F8        	     3M 	clc
04:000012FA 66        	     4M 	data16
04:000012FB E802ED    	     5M 	callw C_SEG_REAL:farfn1652
04:000012FE 0F832805  	     6M 	jnc error
04:00001302 EB13      	     7M 	jmp o3252
                      	     8M farfn1652:
04:00001304 83E804    	     9M 	sub $4,%ax
04:00001307 39C4      	    10M 	cmp %ax,%sp
04:00001309 0F851D05  	    11M 	jne error
04:0000130D 83C004    	    12M 	add $4,%ax
04:00001310 F9        	    13M 	stc
04:00001311 66        	    14M 	data16
04:00001312 66C3      	    15M 	retl
04:00001314 E91305    	    16M 	jmp error
                      	    17M 
                      	    18M o3252:
04:00001317 F8        	    19M 	clc
04:00001318 66        	    20M 	data32
04:00001319 66E8E3EC  	    21M 	calll C_SEG_REAL:farfn3252
04:0000131D 0F830905  	    22M 	jnc error
04:00001321 EB13      	    23M 	jmp m161652
                      	    24M farfn3252:
04:00001323 83E808    	    25M 	sub $8,%ax
04:00001326 39C4      	    26M 	cmp %ax,%sp
04:00001328 0F85FE04  	    27M 	jne error
04:0000132C 83C008    	    28M 	add $8,%ax
04:0000132F F9        	    29M 	stc
04:00001330 66        	    30M 	data32
04:00001331 66C3      	    31M 	retl
04:00001333 E9F404    	    32M 	jmp error
                      	    33M 
                      	    34M m161652:
04:00001336 F8        	    35M 	clc
04:00001337 C7040413  	    36M 	movw $farfn1652,(%si)
04:0000133B C744020000	    37M 	movw $C_SEG_REAL,2(%si)
04:00001340 66        	    38M 	data16
04:00001341 66FF14    	    39M 	calll (%si)
04:00001344 0F83E204  	    40M 	jnc error
                      	    41M m163252:
04:00001348 F8        	    42M 	clc
04:00001349 66C7042313	    43M 	movl $farfn3252,(%si)
04:0000134E 0000
04:00001350 C744040000	    44M 	movw $C_SEG_REAL,4(%si)
04:00001355 66        	    45M 	data32
04:00001356 66FF14    	    46M 	calll (%si)
04:00001359 0F83CD04  	    47M 	jnc error
                      	    48M exit52:
                      	   268: 
                      	   269: 	advTestSegReal
                      	     1M 	advTestBase
                      	     1M 	.set TEST_BASE1,TEST_BASE1+0x1000
                      	     2M 	.set TEST_BASE2,TEST_BASE2+0x1000
                      	     2M 	.set D1_SEG_REAL,TEST_BASE1 >> 4
                      	     3M 	.set D2_SEG_REAL,TEST_BASE2 >> 4
04:0000135D C7C200C3  	     4M 	mov $D1_SEG_REAL,%dx
04:00001361 8EDA      	     5M 	mov %dx,%ds
04:00001363 C7C200C5  	     6M 	mov $D2_SEG_REAL,%dx
04:00001367 8EC2      	     7M 	mov %dx,%es
                      	   270: 
                      	   271: 
                      	   272: .include "load_ptr_m.asm"

Source: "load_ptr_m.asm"
                      	     1: #
                      	     2: #   Tests LSS,LDS,LES,LFS,LGS in 16 and 32 bit mode
                      	     3: #   %1 segment register name, one of ss,ds,es,fs,gs
                      	     4: #   [ed:di] memory address to use for the pointer
                      	     5: #   Uses: nothing
                      	     6: #
                      	     7: 
                      	     8: .macro testLoadPtr arg1
                      	     9: 	mov %\arg1,%cx
                      	    10: 	mov %es,%dx
                      	    11: 
                      	    12: 	movw $0x1234,%es:(%di)
                      	    13: 	movw $0xabcd,%es:2(%di)
                      	    14: 	l\arg1 %es:(%di),%bx
                      	    15: 	mov %\arg1,%ax
                      	    16: 	cmp $0xabcd,%ax
                      	    17: 	jne error
                      	    18: 	cmp $0x1234,%bx
                      	    19: 	jne error
                      	    20: 
                      	    21: 	mov %dx,%es
                      	    22: 
                      	    23: 	movl $0x12345678,%es:(%di)
                      	    24: 	movw $0xbcde,%es:4(%di)
                      	    25: 	l\arg1 %es:(%di),%ebx
                      	    26: 	mov %\arg1,%ax
                      	    27: 	cmp $0xbcde,%ax
                      	    28: 	jne error
                      	    29: 	cmp $0x12345678,%ebx
                      	    30: 	jne error
                      	    31: 
                      	    32: 	mov %dx,%es
                      	    33: 	mov %cx,%\arg1
                      	    34: .endm
                      	    35: 

Source: "t386.asm"
                      	   273: #-------------------------------------------------------------------------------
                      	   274: 	POST $0x06
04:00001369 B006      	     1M 	movb $0x06,%al
04:0000136B BA9001    	     2M 	movw $POST_PORT,%dx
04:0000136E EE        	     3M 	out %al,%dx
                      	   275: #-------------------------------------------------------------------------------
                      	   276: #
                      	   277: #   Load full pointer in real mode
                      	   278: #
04:0000136F BF0000    	   279: 	mov $0,%di
                      	   280: 	testLoadPtr ss
04:00001372 8CD1      	     1M 	mov %ss,%cx
04:00001374 8CC2      	     2M 	mov %es,%dx
                      	     3M 
04:00001376 26C7053412	     4M 	movw $0x1234,%es:(%di)
04:0000137B 26C74502CD	     5M 	movw $0xabcd,%es:2(%di)
04:00001380 AB
04:00001381 260FB21D  	     6M 	lss %es:(%di),%bx
04:00001385 8CD0      	     7M 	mov %ss,%ax
04:00001387 3DCDAB    	     8M 	cmp $0xabcd,%ax
04:0000138A 0F859C04  	     9M 	jne error
04:0000138E 81FB3412  	    10M 	cmp $0x1234,%bx
04:00001392 0F859404  	    11M 	jne error
                      	    12M 
04:00001396 8EC2      	    13M 	mov %dx,%es
                      	    14M 
04:00001398 6626C70578	    15M 	movl $0x12345678,%es:(%di)
04:0000139D 563412
04:000013A0 26C74504DE	    16M 	movw $0xbcde,%es:4(%di)
04:000013A5 BC
04:000013A6 66260FB21D	    17M 	lss %es:(%di),%ebx
04:000013AB 8CD0      	    18M 	mov %ss,%ax
04:000013AD 3DDEBC    	    19M 	cmp $0xbcde,%ax
04:000013B0 0F857604  	    20M 	jne error
04:000013B4 6681FB7856	    21M 	cmp $0x12345678,%ebx
04:000013B9 3412
04:000013BB 0F856B04  	    22M 	jne error
                      	    23M 
04:000013BF 8EC2      	    24M 	mov %dx,%es
04:000013C1 8ED1      	    25M 	mov %cx,%ss
                      	   281: 	testLoadPtr ds
04:000013C3 8CD9      	     1M 	mov %ds,%cx
04:000013C5 8CC2      	     2M 	mov %es,%dx
                      	     3M 
04:000013C7 26C7053412	     4M 	movw $0x1234,%es:(%di)
04:000013CC 26C74502CD	     5M 	movw $0xabcd,%es:2(%di)
04:000013D1 AB
04:000013D2 26C51D    	     6M 	lds %es:(%di),%bx
04:000013D5 8CD8      	     7M 	mov %ds,%ax
04:000013D7 3DCDAB    	     8M 	cmp $0xabcd,%ax
04:000013DA 0F854C04  	     9M 	jne error
04:000013DE 81FB3412  	    10M 	cmp $0x1234,%bx
04:000013E2 0F854404  	    11M 	jne error
                      	    12M 
04:000013E6 8EC2      	    13M 	mov %dx,%es
                      	    14M 
04:000013E8 6626C70578	    15M 	movl $0x12345678,%es:(%di)
04:000013ED 563412
04:000013F0 26C74504DE	    16M 	movw $0xbcde,%es:4(%di)
04:000013F5 BC
04:000013F6 6626C51D  	    17M 	lds %es:(%di),%ebx
04:000013FA 8CD8      	    18M 	mov %ds,%ax
04:000013FC 3DDEBC    	    19M 	cmp $0xbcde,%ax
04:000013FF 0F852704  	    20M 	jne error
04:00001403 6681FB7856	    21M 	cmp $0x12345678,%ebx
04:00001408 3412
04:0000140A 0F851C04  	    22M 	jne error
                      	    23M 
04:0000140E 8EC2      	    24M 	mov %dx,%es
04:00001410 8ED9      	    25M 	mov %cx,%ds
                      	   282: 	testLoadPtr es
04:00001412 8CC1      	     1M 	mov %es,%cx
04:00001414 8CC2      	     2M 	mov %es,%dx
                      	     3M 
04:00001416 26C7053412	     4M 	movw $0x1234,%es:(%di)
04:0000141B 26C74502CD	     5M 	movw $0xabcd,%es:2(%di)
04:00001420 AB
04:00001421 26C41D    	     6M 	les %es:(%di),%bx
04:00001424 8CC0      	     7M 	mov %es,%ax
04:00001426 3DCDAB    	     8M 	cmp $0xabcd,%ax
04:00001429 0F85FD03  	     9M 	jne error
04:0000142D 81FB3412  	    10M 	cmp $0x1234,%bx
04:00001431 0F85F503  	    11M 	jne error
                      	    12M 
04:00001435 8EC2      	    13M 	mov %dx,%es
                      	    14M 
04:00001437 6626C70578	    15M 	movl $0x12345678,%es:(%di)
04:0000143C 563412
04:0000143F 26C74504DE	    16M 	movw $0xbcde,%es:4(%di)
04:00001444 BC
04:00001445 6626C41D  	    17M 	les %es:(%di),%ebx
04:00001449 8CC0      	    18M 	mov %es,%ax
04:0000144B 3DDEBC    	    19M 	cmp $0xbcde,%ax
04:0000144E 0F85D803  	    20M 	jne error
04:00001452 6681FB7856	    21M 	cmp $0x12345678,%ebx
04:00001457 3412
04:00001459 0F85CD03  	    22M 	jne error
                      	    23M 
04:0000145D 8EC2      	    24M 	mov %dx,%es
04:0000145F 8EC1      	    25M 	mov %cx,%es
                      	   283: 	testLoadPtr fs
04:00001461 8CE1      	     1M 	mov %fs,%cx
04:00001463 8CC2      	     2M 	mov %es,%dx
                      	     3M 
04:00001465 26C7053412	     4M 	movw $0x1234,%es:(%di)
04:0000146A 26C74502CD	     5M 	movw $0xabcd,%es:2(%di)
04:0000146F AB
04:00001470 260FB41D  	     6M 	lfs %es:(%di),%bx
04:00001474 8CE0      	     7M 	mov %fs,%ax
04:00001476 3DCDAB    	     8M 	cmp $0xabcd,%ax
04:00001479 0F85AD03  	     9M 	jne error
04:0000147D 81FB3412  	    10M 	cmp $0x1234,%bx
04:00001481 0F85A503  	    11M 	jne error
                      	    12M 
04:00001485 8EC2      	    13M 	mov %dx,%es
                      	    14M 
04:00001487 6626C70578	    15M 	movl $0x12345678,%es:(%di)
04:0000148C 563412
04:0000148F 26C74504DE	    16M 	movw $0xbcde,%es:4(%di)
04:00001494 BC
04:00001495 66260FB41D	    17M 	lfs %es:(%di),%ebx
04:0000149A 8CE0      	    18M 	mov %fs,%ax
04:0000149C 3DDEBC    	    19M 	cmp $0xbcde,%ax
04:0000149F 0F858703  	    20M 	jne error
04:000014A3 6681FB7856	    21M 	cmp $0x12345678,%ebx
04:000014A8 3412
04:000014AA 0F857C03  	    22M 	jne error
                      	    23M 
04:000014AE 8EC2      	    24M 	mov %dx,%es
04:000014B0 8EE1      	    25M 	mov %cx,%fs
                      	   284: 	testLoadPtr gs
04:000014B2 8CE9      	     1M 	mov %gs,%cx
04:000014B4 8CC2      	     2M 	mov %es,%dx
                      	     3M 
04:000014B6 26C7053412	     4M 	movw $0x1234,%es:(%di)
04:000014BB 26C74502CD	     5M 	movw $0xabcd,%es:2(%di)
04:000014C0 AB
04:000014C1 260FB51D  	     6M 	lgs %es:(%di),%bx
04:000014C5 8CE8      	     7M 	mov %gs,%ax
04:000014C7 3DCDAB    	     8M 	cmp $0xabcd,%ax
04:000014CA 0F855C03  	     9M 	jne error
04:000014CE 81FB3412  	    10M 	cmp $0x1234,%bx
04:000014D2 0F855403  	    11M 	jne error
                      	    12M 
04:000014D6 8EC2      	    13M 	mov %dx,%es
                      	    14M 
04:000014D8 6626C70578	    15M 	movl $0x12345678,%es:(%di)
04:000014DD 563412
04:000014E0 26C74504DE	    16M 	movw $0xbcde,%es:4(%di)
04:000014E5 BC
04:000014E6 66260FB51D	    17M 	lgs %es:(%di),%ebx
04:000014EB 8CE8      	    18M 	mov %gs,%ax
04:000014ED 3DDEBC    	    19M 	cmp $0xbcde,%ax
04:000014F0 0F853603  	    20M 	jne error
04:000014F4 6681FB7856	    21M 	cmp $0x12345678,%ebx
04:000014F9 3412
04:000014FB 0F852B03  	    22M 	jne error
                      	    23M 
04:000014FF 8EC2      	    24M 	mov %dx,%es
04:00001501 8EE9      	    25M 	mov %cx,%gs
                      	   285: 
                      	   286: 	advTestSegReal
                      	     1M 	advTestBase
                      	     1M 	.set TEST_BASE1,TEST_BASE1+0x1000
                      	     2M 	.set TEST_BASE2,TEST_BASE2+0x1000
                      	     2M 	.set D1_SEG_REAL,TEST_BASE1 >> 4
                      	     3M 	.set D2_SEG_REAL,TEST_BASE2 >> 4
04:00001503 C7C200C4  	     4M 	mov $D1_SEG_REAL,%dx
04:00001507 8EDA      	     5M 	mov %dx,%ds
04:00001509 C7C200C6  	     6M 	mov $D2_SEG_REAL,%dx
04:0000150D 8EC2      	     7M 	mov %dx,%es
                      	   287: 
                      	   288: .include "lea_m.asm"

Source: "lea_m.asm"
                      	     1: #
                      	     2: #   Execs LEA op with 16-bit addressing and compares the result with given value
                      	     3: #   %1 address to calculate
                      	     4: #   %2 value to compare
                      	     5: #   Uses: flags.
                      	     6: #
                      	     7: .macro testLEA16 arg1,arg2
                      	     8: 	push %ax
                      	     9: 	lea \arg1,%ax
                      	    10: 	cmp \arg2,%ax
                      	    11: 	jne error
                      	    12: 	pop %ax
                      	    13: .endm
                      	    14: 
                      	    15: #
                      	    16: #   Execs LEA op with 32-bit addressing and compares the result with given value
                      	    17: #   %1 address to calculate
                      	    18: #   %2 value to compare
                      	    19: #   Uses: flags.
                      	    20: #
                      	    21: .macro testLEA32 arg1,arg2
                      	    22: 	push %eax
                      	    23: 	lea \arg1,%eax
                      	    24: 	cmp \arg2,%eax
                      	    25: 	jne error
                      	    26: 	pop %eax
                      	    27: .endm
                      	    28: 

Source: "t386.asm"
                      	   289: #.include "lea_p.asm"
                      	   290: postD:
                      	   291: 
                      	   292: #-------------------------------------------------------------------------------
                      	   293: 	POST $0x0D
04:0000150F B00D      	     1M 	movb $0x0D,%al
04:00001511 BA9001    	     2M 	movw $POST_PORT,%dx
04:00001514 EE        	     3M 	out %al,%dx
                      	   294: #-------------------------------------------------------------------------------
                      	   295: #
                      	   296: #   16-bit addressing modes (LEA)
                      	   297: #
04:00001515 B80100    	   298: 	mov $1,%ax
04:00001518 BB0200    	   299: 	mov $2,%bx
04:0000151B B90400    	   300: 	mov $4,%cx
04:0000151E BA0800    	   301: 	mov $8,%dx
04:00001521 BE1000    	   302: 	mov $0x10,%si
04:00001524 BF2000    	   303: 	mov $0x20,%di
                      	   304: 	testLEA16 0x4000, $0x4000
04:00001527 50        	     1M 	push %ax
04:00001528 8D060040  	     2M 	lea 0x4000,%ax
04:0000152C 3D0040    	     3M 	cmp $0x4000,%ax
04:0000152F 0F85F702  	     4M 	jne error
04:00001533 58        	     5M 	pop %ax
                      	   305: 	testLEA16 (%bx), $0x0002
04:00001534 50        	     1M 	push %ax
04:00001535 8D07      	     2M 	lea (%bx),%ax
04:00001537 83F802    	     3M 	cmp $0x0002,%ax
04:0000153A 0F85EC02  	     4M 	jne error
04:0000153E 58        	     5M 	pop %ax
                      	   306: 	testLEA16 (%si), $0x0010
04:0000153F 50        	     1M 	push %ax
04:00001540 8D04      	     2M 	lea (%si),%ax
04:00001542 83F810    	     3M 	cmp $0x0010,%ax
04:00001545 0F85E102  	     4M 	jne error
04:00001549 58        	     5M 	pop %ax
                      	   307: 	testLEA16 (%di), $0x0020
04:0000154A 50        	     1M 	push %ax
04:0000154B 8D05      	     2M 	lea (%di),%ax
04:0000154D 83F820    	     3M 	cmp $0x0020,%ax
04:00001550 0F85D602  	     4M 	jne error
04:00001554 58        	     5M 	pop %ax
                      	   308: 	testLEA16 0x40(%bx), $0x0042
04:00001555 50        	     1M 	push %ax
04:00001556 8D4740    	     2M 	lea 0x40(%bx),%ax
04:00001559 83F842    	     3M 	cmp $0x0042,%ax
04:0000155C 0F85CA02  	     4M 	jne error
04:00001560 58        	     5M 	pop %ax
                      	   309: 	testLEA16 0x40(%si), $0x0050
04:00001561 50        	     1M 	push %ax
04:00001562 8D4440    	     2M 	lea 0x40(%si),%ax
04:00001565 83F850    	     3M 	cmp $0x0050,%ax
04:00001568 0F85BE02  	     4M 	jne error
04:0000156C 58        	     5M 	pop %ax
                      	   310: 	testLEA16 0x40(%di), $0x0060
04:0000156D 50        	     1M 	push %ax
04:0000156E 8D4540    	     2M 	lea 0x40(%di),%ax
04:00001571 83F860    	     3M 	cmp $0x0060,%ax
04:00001574 0F85B202  	     4M 	jne error
04:00001578 58        	     5M 	pop %ax
                      	   311: 	testLEA16 0x4000(%bx), $0x4002
04:00001579 50        	     1M 	push %ax
04:0000157A 8D870040  	     2M 	lea 0x4000(%bx),%ax
04:0000157E 3D0240    	     3M 	cmp $0x4002,%ax
04:00001581 0F85A502  	     4M 	jne error
04:00001585 58        	     5M 	pop %ax
                      	   312: 	testLEA16 0x4000(%si), $0x4010
04:00001586 50        	     1M 	push %ax
04:00001587 8D840040  	     2M 	lea 0x4000(%si),%ax
04:0000158B 3D1040    	     3M 	cmp $0x4010,%ax
04:0000158E 0F859802  	     4M 	jne error
04:00001592 58        	     5M 	pop %ax
                      	   313: 	testLEA16 (%bx,%si), $0x0012
04:00001593 50        	     1M 	push %ax
04:00001594 8D00      	     2M 	lea (%bx,%si),%ax
04:00001596 83F812    	     3M 	cmp $0x0012,%ax
04:00001599 0F858D02  	     4M 	jne error
04:0000159D 58        	     5M 	pop %ax
                      	   314: 	testLEA16 (%bx,%di), $0x0022
04:0000159E 50        	     1M 	push %ax
04:0000159F 8D01      	     2M 	lea (%bx,%di),%ax
04:000015A1 83F822    	     3M 	cmp $0x0022,%ax
04:000015A4 0F858202  	     4M 	jne error
04:000015A8 58        	     5M 	pop %ax
                      	   315: 	testLEA16 0x40(%bx,%si), $0x0052
04:000015A9 50        	     1M 	push %ax
04:000015AA 8D4040    	     2M 	lea 0x40(%bx,%si),%ax
04:000015AD 83F852    	     3M 	cmp $0x0052,%ax
04:000015B0 0F857602  	     4M 	jne error
04:000015B4 58        	     5M 	pop %ax
                      	   316: 	testLEA16 0x40(%bx,%di), $0x0062
04:000015B5 50        	     1M 	push %ax
04:000015B6 8D4140    	     2M 	lea 0x40(%bx,%di),%ax
04:000015B9 83F862    	     3M 	cmp $0x0062,%ax
04:000015BC 0F856A02  	     4M 	jne error
04:000015C0 58        	     5M 	pop %ax
                      	   317: 	testLEA16 0x4000(%bx,%si), $0x4012
04:000015C1 50        	     1M 	push %ax
04:000015C2 8D800040  	     2M 	lea 0x4000(%bx,%si),%ax
04:000015C6 3D1240    	     3M 	cmp $0x4012,%ax
04:000015C9 0F855D02  	     4M 	jne error
04:000015CD 58        	     5M 	pop %ax
                      	   318: 	testLEA16 0x4000(%bx,%di), $0x4022
04:000015CE 50        	     1M 	push %ax
04:000015CF 8D810040  	     2M 	lea 0x4000(%bx,%di),%ax
04:000015D3 3D2240    	     3M 	cmp $0x4022,%ax
04:000015D6 0F855002  	     4M 	jne error
04:000015DA 58        	     5M 	pop %ax
                      	   319: 
                      	   320: 
                      	   321: #-------------------------------------------------------------------------------
                      	   322: 	POST $0xE0
04:000015DB B0E0      	     1M 	movb $0xE0,%al
04:000015DD BA9001    	     2M 	movw $POST_PORT,%dx
04:000015E0 EE        	     3M 	out %al,%dx
                      	   323: #-------------------------------------------------------------------------------
                      	   324: 
                      	   325: .shifts386FlagsTest:
                      	   326: 
                      	   327: 	# SHR al,cl - SHR ax,cl
                      	   328: 	# undefined flags:
                      	   329: 	#  CF when cl>7 (byte) or cl>15 (word):
                      	   330: 	#    if byte operand and cl=8 or cl=16 or cl=24 then CF=MSB(operand)
                      	   331: 	#    if word operand and cl=16 then CF=MSB(operand)
                      	   332: 	#  OF when cl>1: set according to result   *** rf386 calc's overflow cl>1
                      	   333: 	#  AF when cl>0: always 1
                      	   334: 	# shift count is modulo 32 so if cl=32 then result is equal to cl=0
                      	   335: 
                      	   336: 	testShiftBFlags shrb, $0x81, $1, $0, $(PS_CF|PS_AF|PS_OF)
04:000015E1 B80000    	     1M 	mov $0,%ax
04:000015E4 50        	     2M 	push %ax
04:000015E5 9D        	     3M 	popf
04:000015E6 B4FF      	     4M 	mov $0xff,%ah
04:000015E8 B081      	     5M 	mov $0x81,%al
04:000015EA B101      	     6M 	mov $1,%cl
04:000015EC D2E8      	     7M 	shrb %cl,%al
04:000015EE 9C        	     8M 	pushf
04:000015EF 58        	     9M 	pop %ax
04:000015F0 25D508    	    10M 	and $PS_ARITH,%ax
04:000015F3 3D1108    	    11M 	cmp $(PS_CF|PS_AF|PS_OF),%ax
04:000015F6 0F853002  	    12M 	jne error
                      	   337: 	testShiftBFlags shrb, $0x82, $2, $0, $(PS_CF|PS_AF|PS_OF)
04:000015FA B80000    	     1M 	mov $0,%ax
04:000015FD 50        	     2M 	push %ax
04:000015FE 9D        	     3M 	popf
04:000015FF B4FF      	     4M 	mov $0xff,%ah
04:00001601 B082      	     5M 	mov $0x82,%al
04:00001603 B102      	     6M 	mov $2,%cl
04:00001605 D2E8      	     7M 	shrb %cl,%al
04:00001607 9C        	     8M 	pushf
04:00001608 58        	     9M 	pop %ax
04:00001609 25D508    	    10M 	and $PS_ARITH,%ax
04:0000160C 3D1108    	    11M 	cmp $(PS_CF|PS_AF|PS_OF),%ax
04:0000160F 0F851702  	    12M 	jne error
                      	   338: 	testShiftBFlags shrb, $0x80, $8, $0, $(PS_CF|PS_PF|PS_AF|PS_ZF|PS_OF)
04:00001613 B80000    	     1M 	mov $0,%ax
04:00001616 50        	     2M 	push %ax
04:00001617 9D        	     3M 	popf
04:00001618 B4FF      	     4M 	mov $0xff,%ah
04:0000161A B080      	     5M 	mov $0x80,%al
04:0000161C B108      	     6M 	mov $8,%cl
04:0000161E D2E8      	     7M 	shrb %cl,%al
04:00001620 9C        	     8M 	pushf
04:00001621 58        	     9M 	pop %ax
04:00001622 25D508    	    10M 	and $PS_ARITH,%ax
04:00001625 3D5508    	    11M 	cmp $(PS_CF|PS_PF|PS_AF|PS_ZF|PS_OF),%ax
04:00001628 0F85FE01  	    12M 	jne error
                      	   339: 	testShiftBFlags shrb, $0x00,   $8,  $PS_CF, $(PS_PF|PS_ZF)
04:0000162C B80100    	     1M 	mov $PS_CF,%ax
04:0000162F 50        	     2M 	push %ax
04:00001630 9D        	     3M 	popf
04:00001631 B4FF      	     4M 	mov $0xff,%ah
04:00001633 B000      	     5M 	mov $0x00,%al
04:00001635 B108      	     6M 	mov $8,%cl
04:00001637 D2E8      	     7M 	shrb %cl,%al
04:00001639 9C        	     8M 	pushf
04:0000163A 58        	     9M 	pop %ax
04:0000163B 25D508    	    10M 	and $PS_ARITH,%ax
04:0000163E 83F844    	    11M 	cmp $(PS_PF|PS_ZF),%ax
04:00001641 0F85E501  	    12M 	jne error
                      	   340: 	testShiftBFlags shrb, $0x80,   $16, $0,     $(PS_PF|PS_ZF|PS_OF)
04:00001645 B80000    	     1M 	mov $0,%ax
04:00001648 50        	     2M 	push %ax
04:00001649 9D        	     3M 	popf
04:0000164A B4FF      	     4M 	mov $0xff,%ah
04:0000164C B080      	     5M 	mov $0x80,%al
04:0000164E B110      	     6M 	mov $16,%cl
04:00001650 D2E8      	     7M 	shrb %cl,%al
04:00001652 9C        	     8M 	pushf
04:00001653 58        	     9M 	pop %ax
04:00001654 25D508    	    10M 	and $PS_ARITH,%ax
04:00001657 3D4408    	    11M 	cmp $(PS_PF|PS_ZF|PS_OF),%ax
04:0000165A 0F85CC01  	    12M 	jne error
                      	   341: 	testShiftBFlags shrb, $0x00,   $16, $PS_CF, $(PS_PF|PS_ZF)
04:0000165E B80100    	     1M 	mov $PS_CF,%ax
04:00001661 50        	     2M 	push %ax
04:00001662 9D        	     3M 	popf
04:00001663 B4FF      	     4M 	mov $0xff,%ah
04:00001665 B000      	     5M 	mov $0x00,%al
04:00001667 B110      	     6M 	mov $16,%cl
04:00001669 D2E8      	     7M 	shrb %cl,%al
04:0000166B 9C        	     8M 	pushf
04:0000166C 58        	     9M 	pop %ax
04:0000166D 25D508    	    10M 	and $PS_ARITH,%ax
04:00001670 83F844    	    11M 	cmp $(PS_PF|PS_ZF),%ax
04:00001673 0F85B301  	    12M 	jne error
                      	   342: 	testShiftBFlags shrb, $0x80,   $24, $0,     $(PS_PF|PS_ZF|PS_OF)
04:00001677 B80000    	     1M 	mov $0,%ax
04:0000167A 50        	     2M 	push %ax
04:0000167B 9D        	     3M 	popf
04:0000167C B4FF      	     4M 	mov $0xff,%ah
04:0000167E B080      	     5M 	mov $0x80,%al
04:00001680 B118      	     6M 	mov $24,%cl
04:00001682 D2E8      	     7M 	shrb %cl,%al
04:00001684 9C        	     8M 	pushf
04:00001685 58        	     9M 	pop %ax
04:00001686 25D508    	    10M 	and $PS_ARITH,%ax
04:00001689 3D4408    	    11M 	cmp $(PS_PF|PS_ZF|PS_OF),%ax
04:0000168C 0F859A01  	    12M 	jne error
                      	   343: 	testShiftBFlags shrb, $0x00,   $24, $PS_CF, $(PS_PF|PS_ZF)
04:00001690 B80100    	     1M 	mov $PS_CF,%ax
04:00001693 50        	     2M 	push %ax
04:00001694 9D        	     3M 	popf
04:00001695 B4FF      	     4M 	mov $0xff,%ah
04:00001697 B000      	     5M 	mov $0x00,%al
04:00001699 B118      	     6M 	mov $24,%cl
04:0000169B D2E8      	     7M 	shrb %cl,%al
04:0000169D 9C        	     8M 	pushf
04:0000169E 58        	     9M 	pop %ax
04:0000169F 25D508    	    10M 	and $PS_ARITH,%ax
04:000016A2 83F844    	    11M 	cmp $(PS_PF|PS_ZF),%ax
04:000016A5 0F858101  	    12M 	jne error
                      	   344: 	testShiftBFlags shrb, $0x80,   $32, $0,     $PS_SF
04:000016A9 B80000    	     1M 	mov $0,%ax
04:000016AC 50        	     2M 	push %ax
04:000016AD 9D        	     3M 	popf
04:000016AE B4FF      	     4M 	mov $0xff,%ah
04:000016B0 B080      	     5M 	mov $0x80,%al
04:000016B2 B120      	     6M 	mov $32,%cl
04:000016B4 D2E8      	     7M 	shrb %cl,%al
04:000016B6 9C        	     8M 	pushf
04:000016B7 58        	     9M 	pop %ax
04:000016B8 25D508    	    10M 	and $PS_ARITH,%ax
04:000016BB 3D8000    	    11M 	cmp $PS_SF,%ax
04:000016BE 0F856801  	    12M 	jne error
                      	   345: 	testShiftWFlags shrw, $0x8000, $16, $0,     $(PS_CF|PS_PF|PS_AF|PS_ZF|PS_OF)
04:000016C2 B80000    	     1M 	mov $0,%ax
04:000016C5 50        	     2M 	push %ax
04:000016C6 9D        	     3M 	popf
04:000016C7 B80080    	     4M 	mov $0x8000,%ax
04:000016CA B110      	     5M 	mov $16,%cl
04:000016CC D3E8      	     6M 	shrw %cl,%ax
04:000016CE 9C        	     7M 	pushf
04:000016CF 58        	     8M 	pop %ax
04:000016D0 25D508    	     9M 	and $PS_ARITH,%ax
04:000016D3 3D5508    	    10M 	cmp $(PS_CF|PS_PF|PS_AF|PS_ZF|PS_OF),%ax
04:000016D6 0F855001  	    11M 	jne error
                      	   346: 	testShiftWFlags shrw, $0x0000, $16, $PS_CF, $(PS_PF|PS_ZF)
04:000016DA B80100    	     1M 	mov $PS_CF,%ax
04:000016DD 50        	     2M 	push %ax
04:000016DE 9D        	     3M 	popf
04:000016DF B80000    	     4M 	mov $0x0000,%ax
04:000016E2 B110      	     5M 	mov $16,%cl
04:000016E4 D3E8      	     6M 	shrw %cl,%ax
04:000016E6 9C        	     7M 	pushf
04:000016E7 58        	     8M 	pop %ax
04:000016E8 25D508    	     9M 	and $PS_ARITH,%ax
04:000016EB 83F844    	    10M 	cmp $(PS_PF|PS_ZF),%ax
04:000016EE 0F853801  	    11M 	jne error
                      	   347: 	testShiftWFlags shrw, $0x8000, $32, $0,     $PS_SF|PS_PF
04:000016F2 B80000    	     1M 	mov $0,%ax
04:000016F5 50        	     2M 	push %ax
04:000016F6 9D        	     3M 	popf
04:000016F7 B80080    	     4M 	mov $0x8000,%ax
04:000016FA B120      	     5M 	mov $32,%cl
04:000016FC D3E8      	     6M 	shrw %cl,%ax
04:000016FE 9C        	     7M 	pushf
04:000016FF 58        	     8M 	pop %ax
04:00001700 25D508    	     9M 	and $PS_ARITH,%ax
04:00001703 3D8400    	    10M 	cmp $PS_SF|PS_PF,%ax
04:00001706 0F852001  	    11M 	jne error
                      	   348: 
                      	   349: 	# SHL al,cl - SHL ax,cl
                      	   350: 	# undefined flags:
                      	   351: 	#  CF when cl>7 (byte) or cl>15 (word):
                      	   352: 	#    if byte operand and cl=8 or cl=16 or cl=24 then CF=LSB(operand)
                      	   353: 	#    if word operand and cl=16 then CF=LSB(operand)
                      	   354: 	#  OF when cl>1: set according to result
                      	   355: 	#  AF when cl>0: always 1
                      	   356: 	# shift count is modulo 32 so if cl=32 then result is equal to cl=0
                      	   357: 
                      	   358: 	testShiftBFlags shlb, $0x81, $1,  $0,     $(PS_CF|PS_OF)
04:0000170A B80000    	     1M 	mov $0,%ax
04:0000170D 50        	     2M 	push %ax
04:0000170E 9D        	     3M 	popf
04:0000170F B4FF      	     4M 	mov $0xff,%ah
04:00001711 B081      	     5M 	mov $0x81,%al
04:00001713 B101      	     6M 	mov $1,%cl
04:00001715 D2E0      	     7M 	shlb %cl,%al
04:00001717 9C        	     8M 	pushf
04:00001718 58        	     9M 	pop %ax
04:00001719 25D508    	    10M 	and $PS_ARITH,%ax
04:0000171C 3D0108    	    11M 	cmp $(PS_CF|PS_OF),%ax
04:0000171F 0F850701  	    12M 	jne error
                      	   359: 	testShiftBFlags shlb, $0x41, $2,  $0,     $(PS_CF|PS_OF)
04:00001723 B80000    	     1M 	mov $0,%ax
04:00001726 50        	     2M 	push %ax
04:00001727 9D        	     3M 	popf
04:00001728 B4FF      	     4M 	mov $0xff,%ah
04:0000172A B041      	     5M 	mov $0x41,%al
04:0000172C B102      	     6M 	mov $2,%cl
04:0000172E D2E0      	     7M 	shlb %cl,%al
04:00001730 9C        	     8M 	pushf
04:00001731 58        	     9M 	pop %ax
04:00001732 25D508    	    10M 	and $PS_ARITH,%ax
04:00001735 3D0108    	    11M 	cmp $(PS_CF|PS_OF),%ax
04:00001738 0F85EE00  	    12M 	jne error
                      	   360: 	testShiftBFlags shlb, $0x01, $8,  $0,     $(PS_CF|PS_PF|PS_ZF|PS_OF)
04:0000173C B80000    	     1M 	mov $0,%ax
04:0000173F 50        	     2M 	push %ax
04:00001740 9D        	     3M 	popf
04:00001741 B4FF      	     4M 	mov $0xff,%ah
04:00001743 B001      	     5M 	mov $0x01,%al
04:00001745 B108      	     6M 	mov $8,%cl
04:00001747 D2E0      	     7M 	shlb %cl,%al
04:00001749 9C        	     8M 	pushf
04:0000174A 58        	     9M 	pop %ax
04:0000174B 25D508    	    10M 	and $PS_ARITH,%ax
04:0000174E 3D4508    	    11M 	cmp $(PS_CF|PS_PF|PS_ZF|PS_OF),%ax
04:00001751 0F85D500  	    12M 	jne error
                      	   361: 	testShiftBFlags shlb, $0x00, $8,  $PS_CF, $(PS_PF|PS_ZF)
04:00001755 B80100    	     1M 	mov $PS_CF,%ax
04:00001758 50        	     2M 	push %ax
04:00001759 9D        	     3M 	popf
04:0000175A B4FF      	     4M 	mov $0xff,%ah
04:0000175C B000      	     5M 	mov $0x00,%al
04:0000175E B108      	     6M 	mov $8,%cl
04:00001760 D2E0      	     7M 	shlb %cl,%al
04:00001762 9C        	     8M 	pushf
04:00001763 58        	     9M 	pop %ax
04:00001764 25D508    	    10M 	and $PS_ARITH,%ax
04:00001767 83F844    	    11M 	cmp $(PS_PF|PS_ZF),%ax
04:0000176A 0F85BC00  	    12M 	jne error
                      	   362: 	testShiftBFlags shlb, $0x01, $16, $0,     $(PS_CF|PS_PF|PS_ZF|PS_OF)
04:0000176E B80000    	     1M 	mov $0,%ax
04:00001771 50        	     2M 	push %ax
04:00001772 9D        	     3M 	popf
04:00001773 B4FF      	     4M 	mov $0xff,%ah
04:00001775 B001      	     5M 	mov $0x01,%al
04:00001777 B110      	     6M 	mov $16,%cl
04:00001779 D2E0      	     7M 	shlb %cl,%al
04:0000177B 9C        	     8M 	pushf
04:0000177C 58        	     9M 	pop %ax
04:0000177D 25D508    	    10M 	and $PS_ARITH,%ax
04:00001780 3D4508    	    11M 	cmp $(PS_CF|PS_PF|PS_ZF|PS_OF),%ax
04:00001783 0F85A300  	    12M 	jne error
                      	   363: 	testShiftBFlags shlb, $0x00, $16, $PS_CF, $(PS_PF|PS_ZF)
04:00001787 B80100    	     1M 	mov $PS_CF,%ax
04:0000178A 50        	     2M 	push %ax
04:0000178B 9D        	     3M 	popf
04:0000178C B4FF      	     4M 	mov $0xff,%ah
04:0000178E B000      	     5M 	mov $0x00,%al
04:00001790 B110      	     6M 	mov $16,%cl
04:00001792 D2E0      	     7M 	shlb %cl,%al
04:00001794 9C        	     8M 	pushf
04:00001795 58        	     9M 	pop %ax
04:00001796 25D508    	    10M 	and $PS_ARITH,%ax
04:00001799 83F844    	    11M 	cmp $(PS_PF|PS_ZF),%ax
04:0000179C 0F858A00  	    12M 	jne error
                      	   364: 	testShiftBFlags shlb, $0x01, $24, $0,     $(PS_CF|PS_PF|PS_ZF|PS_OF)
04:000017A0 B80000    	     1M 	mov $0,%ax
04:000017A3 50        	     2M 	push %ax
04:000017A4 9D        	     3M 	popf
04:000017A5 B4FF      	     4M 	mov $0xff,%ah
04:000017A7 B001      	     5M 	mov $0x01,%al
04:000017A9 B118      	     6M 	mov $24,%cl
04:000017AB D2E0      	     7M 	shlb %cl,%al
04:000017AD 9C        	     8M 	pushf
04:000017AE 58        	     9M 	pop %ax
04:000017AF 25D508    	    10M 	and $PS_ARITH,%ax
04:000017B2 3D4508    	    11M 	cmp $(PS_CF|PS_PF|PS_ZF|PS_OF),%ax
04:000017B5 7573      	    12M 	jne error
                      	   365: 	testShiftBFlags shlb, $0x00, $24, $PS_CF, $(PS_PF|PS_ZF)
04:000017B7 B80100    	     1M 	mov $PS_CF,%ax
04:000017BA 50        	     2M 	push %ax
04:000017BB 9D        	     3M 	popf
04:000017BC B4FF      	     4M 	mov $0xff,%ah
04:000017BE B000      	     5M 	mov $0x00,%al
04:000017C0 B118      	     6M 	mov $24,%cl
04:000017C2 D2E0      	     7M 	shlb %cl,%al
04:000017C4 9C        	     8M 	pushf
04:000017C5 58        	     9M 	pop %ax
04:000017C6 25D508    	    10M 	and $PS_ARITH,%ax
04:000017C9 83F844    	    11M 	cmp $(PS_PF|PS_ZF),%ax
04:000017CC 755C      	    12M 	jne error
                      	   366: 	testShiftBFlags shlb, $0x01, $32, $0,     $0
04:000017CE B80000    	     1M 	mov $0,%ax
04:000017D1 50        	     2M 	push %ax
04:000017D2 9D        	     3M 	popf
04:000017D3 B4FF      	     4M 	mov $0xff,%ah
04:000017D5 B001      	     5M 	mov $0x01,%al
04:000017D7 B120      	     6M 	mov $32,%cl
04:000017D9 D2E0      	     7M 	shlb %cl,%al
04:000017DB 9C        	     8M 	pushf
04:000017DC 58        	     9M 	pop %ax
04:000017DD 25D508    	    10M 	and $PS_ARITH,%ax
04:000017E0 83F800    	    11M 	cmp $0,%ax
04:000017E3 7545      	    12M 	jne error
                      	   367: 	testShiftWFlags shlw, $0x01, $16, $0,     $(PS_CF|PS_PF|PS_ZF|PS_OF)
04:000017E5 B80000    	     1M 	mov $0,%ax
04:000017E8 50        	     2M 	push %ax
04:000017E9 9D        	     3M 	popf
04:000017EA B80100    	     4M 	mov $0x01,%ax
04:000017ED B110      	     5M 	mov $16,%cl
04:000017EF D3E0      	     6M 	shlw %cl,%ax
04:000017F1 9C        	     7M 	pushf
04:000017F2 58        	     8M 	pop %ax
04:000017F3 25D508    	     9M 	and $PS_ARITH,%ax
04:000017F6 3D4508    	    10M 	cmp $(PS_CF|PS_PF|PS_ZF|PS_OF),%ax
04:000017F9 752F      	    11M 	jne error
                      	   368: 	testShiftWFlags shlw, $0x00, $16, $PS_CF, $(PS_PF|PS_ZF)
04:000017FB B80100    	     1M 	mov $PS_CF,%ax
04:000017FE 50        	     2M 	push %ax
04:000017FF 9D        	     3M 	popf
04:00001800 B80000    	     4M 	mov $0x00,%ax
04:00001803 B110      	     5M 	mov $16,%cl
04:00001805 D3E0      	     6M 	shlw %cl,%ax
04:00001807 9C        	     7M 	pushf
04:00001808 58        	     8M 	pop %ax
04:00001809 25D508    	     9M 	and $PS_ARITH,%ax
04:0000180C 83F844    	    10M 	cmp $(PS_PF|PS_ZF),%ax
04:0000180F 7519      	    11M 	jne error
                      	   369: 	testShiftWFlags shlw, $0x01, $32, $0,     $0
04:00001811 B80000    	     1M 	mov $0,%ax
04:00001814 50        	     2M 	push %ax
04:00001815 9D        	     3M 	popf
04:00001816 B80100    	     4M 	mov $0x01,%ax
04:00001819 B120      	     5M 	mov $32,%cl
04:0000181B D3E0      	     6M 	shlw %cl,%ax
04:0000181D 9C        	     7M 	pushf
04:0000181E 58        	     8M 	pop %ax
04:0000181F 25D508    	     9M 	and $PS_ARITH,%ax
04:00001822 83F800    	    10M 	cmp $0,%ax
04:00001825 7503      	    11M 	jne error
                      	   370: 
04:00001827 E9FEFF    	   371: 	jmp _bootrom
                      	   372: 
                      	   373: #	pushl $10
                      	   374: #	call _Fibonacci
                      	   375: 
                      	   376: #
                      	   377: # Default exception handler and error routine
                      	   378: #
                      	   379: DefaultExcHandler:
                      	   380: error:
                      	   381: # CLI and HLT are privileged instructions, don't use them in ring3
04:0000182A 8CC8      	   382: 	mov %cs,%ax
                      	   383: 
                      	   384: # when in real mode, the jnz will be decoded together with test as
                      	   385: # "test eax,0xfe750007" (66A9070075FE)
04:0000182C A90700    	   386: 	test $7,%ax     # 66 A9 07 00
04:0000182F 75FE      	   387: .ring3: jnz .ring3 # 75 FE
04:00001831 FA        	   388: 	cli
04:00001832 F4        	   389: 	hlt
04:00001833 EBF5      	   390: 	jmp error
                      	   391: 
                      	   392: 
                      	   393: .rept 16
                      	   394: 	nop
                      	   395: .endr
04:00001835 90        	     1R 	nop
04:00001836 90        	     1R 	nop
04:00001837 90        	     1R 	nop
04:00001838 90        	     1R 	nop
04:00001839 90        	     1R 	nop
04:0000183A 90        	     1R 	nop
04:0000183B 90        	     1R 	nop
04:0000183C 90        	     1R 	nop
04:0000183D 90        	     1R 	nop
04:0000183E 90        	     1R 	nop
04:0000183F 90        	     1R 	nop
04:00001840 90        	     1R 	nop
04:00001841 90        	     1R 	nop
04:00001842 90        	     1R 	nop
04:00001843 90        	     1R 	nop
04:00001844 90        	     1R 	nop
                      	   396: 	
                      	   397: #	.type	_start,@function
                      	   398: #	.size	_start,$-_start
                      	   399: 
                      	   400: #.include "Fibonacci.asm"
                      	   401: #.include "serial.asm"
                      	   402: #.include "xmodem.asm"
                      	   403: #.include "bootrom.asm"
                      	   404: 
                      	   405: .global _disable_int
                      	   406: .global _restore_int
                      	   407: .extern _start_data
                      	   408: .extern _start_rodata
                      	   409: .extern _start_bss
                      	   410: 


Symbols by name:
.ring3                          04:0000182F
.shifts386FlagsTest             04:000015E1
C_SEG_REAL                       S:00000000
D1_SEG_REAL                      S:0FFFC400
D2_SEG_REAL                      S:0FFFC600
DefaultExcHandler               04:0000182A
ESP_REAL                         S:00007FFC
EXT_NONE                         S:00000000
EX_UD                            S:00000006
IDT_SEG_REAL                     S:00009000
POST_PORT                        S:00000190
PS_AF                            S:00000010
PS_ARITH                         S:000008D5
PS_CF                            S:00000001
PS_OF                            S:00000800
PS_PF                            S:00000004
PS_SF                            S:00000080
PS_ZF                            S:00000040
S_SEG_REAL                       S:0000C000
TEST_BASE                        S:FFFC0000
TEST_BASE1                       S:FFFC4000
TEST_BASE2                       S:FFFC6000
_Fibonacci                      external EXP
_bootrom                        external EXP
_disable_int                    external EXP
_restore_int                    external EXP
_start                          04:00000000
_start1                         04:0000005B
_start_bss                      external EXP
_start_data                     external EXP
_start_rodata                   external EXP
aloop7                          04:00000076
b                                S:00000000
bytes                            S:00000100
continue25                      04:0000054D
continue28                      04:000005C2
cs                               S:00000000
d                                S:00000002
ds                               S:00000001
err110                          04:000000C7
err111                          04:00000209
err210                          04:0000013C
err211                          04:00000394
error                           04:0000182A
es                               S:00000002
exit10                          04:0000014B
exit11                          04:000003A9
exit52                          04:0000135D
farfn1652                       04:00001304
farfn3252                       04:00001323
fs                               S:00000003
gs                               S:00000004
header                          04:00000002
idt_addr                        03:00000000
items                            S:00000040
ja10                            04:000000EE
ja11                            04:00000242
jaok10                          04:000000FE
jaok11                          04:000002DD
jcok10                          04:000000C8
jcok11                          04:0000020A
jcxz10                          04:00000120
jcxz11                          04:00000311
jcxzok10                        04:00000147
jecxz10                         04:00000130
jecxze10                        04:0000013A
jecxzok10                       04:00000149
jl10                            04:00000117
jl11                            04:00000304
jle10                           04:0000011D
jle11                           04:0000030C
jleok10                         04:00000145
jleok11                         04:000003A5
jlok10                          04:00000143
jlok11                          04:000003A1
jna10                           04:000000BE
jna11                           04:0000017B
jnaok10                         04:000000D0
jnaok11                         04:0000021A
jnc10                           04:000000D2
jnc11                           04:0000021E
jncok10                         04:000000F6
jncok11                         04:000002CD
jnl10                           04:0000010D
jnl11                           04:000002F2
jnle10                          04:00000112
jnle11                          04:000002FB
jnleok10                        04:00000141
jnleok11                        04:0000039D
jnlok10                         04:0000013F
jnlok11                         04:00000399
jnp10                           04:000000E2
jnp11                           04:00000232
jnpok10                         04:000000FA
jnpok11                         04:000002D5
jns10                           04:000000E8
jns11                           04:0000023A
jnsok10                         04:000000FC
jnsok11                         04:000002D9
jnz10                           04:000000DC
jnz11                           04:0000022A
jnzok10                         04:000000F8
jnzok11                         04:000002D1
jo10                            04:00000100
jo11                            04:000002E1
jook10                          04:0000013D
jook11                          04:00000395
jp10                            04:000000AE
jp11                            04:00000163
jpok10                          04:000000CC
jpok11                          04:00000212
js10                            04:000000B6
js11                            04:0000016F
jsok10                          04:000000CE
jsok11                          04:00000216
jz10                            04:000000A6
jz11                            04:00000157
jzok10                          04:000000CA
jzok11                          04:0000020E
m161652                         04:00001336
m163252                         04:00001348
nearfn1651                      04:000012A9
nearfn32                        external
nearfn3251                      04:000012C9
next110                         04:000000C5
next111                         04:00000186
next210                         04:000000F4
next211                         04:0000024A
o3252                           04:00001317
off_cmp                          S:0001FFFF
off_mask                         S:0000FFFF
off_value                        S:000100FF
postD                           04:0000150F
realmd_mask                      S:0000FFFF
rel1651                         04:0000129E
rel3251                         04:000012BD
rm1651                          04:000012DD
rm3251                          04:000012E8
rodata_seg                       S:0FFFA000
sp                               S:00000000
ss                               S:00000005
start_rodata                     S:FFFA0000
test25                          04:00000548
test28                          04:000005BB
val_mask                         S:FFFFFFFF
val_size                         S:00000004
value                            S:12345678
w                                S:00000001

Symbols by value:
FFFA0000 start_rodata
FFFC0000 TEST_BASE
FFFC4000 TEST_BASE1
FFFC6000 TEST_BASE2
FFFFFFFF val_mask
00000000 sp
00000000 cs
00000000 C_SEG_REAL
00000000 b
00000000 EXT_NONE
00000000 idt_addr
00000000 _start
00000001 ds
00000001 w
00000001 PS_CF
00000002 header
00000002 d
00000002 es
00000003 fs
00000004 val_size
00000004 PS_PF
00000004 gs
00000005 ss
00000006 EX_UD
00000010 PS_AF
00000040 PS_ZF
00000040 items
0000005B _start1
00000076 aloop7
00000080 PS_SF
000000A6 jz10
000000AE jp10
000000B6 js10
000000BE jna10
000000C5 next110
000000C7 err110
000000C8 jcok10
000000CA jzok10
000000CC jpok10
000000CE jsok10
000000D0 jnaok10
000000D2 jnc10
000000DC jnz10
000000E2 jnp10
000000E8 jns10
000000EE ja10
000000F4 next210
000000F6 jncok10
000000F8 jnzok10
000000FA jnpok10
000000FC jnsok10
000000FE jaok10
00000100 jo10
00000100 bytes
0000010D jnl10
00000112 jnle10
00000117 jl10
0000011D jle10
00000120 jcxz10
00000130 jecxz10
0000013A jecxze10
0000013C err210
0000013D jook10
0000013F jnlok10
00000141 jnleok10
00000143 jlok10
00000145 jleok10
00000147 jcxzok10
00000149 jecxzok10
0000014B exit10
00000157 jz11
00000163 jp11
0000016F js11
0000017B jna11
00000186 next111
00000190 POST_PORT
00000209 err111
0000020A jcok11
0000020E jzok11
00000212 jpok11
00000216 jsok11
0000021A jnaok11
0000021E jnc11
0000022A jnz11
00000232 jnp11
0000023A jns11
00000242 ja11
0000024A next211
000002CD jncok11
000002D1 jnzok11
000002D5 jnpok11
000002D9 jnsok11
000002DD jaok11
000002E1 jo11
000002F2 jnl11
000002FB jnle11
00000304 jl11
0000030C jle11
00000311 jcxz11
00000394 err211
00000395 jook11
00000399 jnlok11
0000039D jnleok11
000003A1 jlok11
000003A5 jleok11
000003A9 exit11
00000548 test25
0000054D continue25
000005BB test28
000005C2 continue28
00000800 PS_OF
000008D5 PS_ARITH
0000129E rel1651
000012A9 nearfn1651
000012BD rel3251
000012C9 nearfn3251
000012DD rm1651
000012E8 rm3251
00001304 farfn1652
00001317 o3252
00001323 farfn3252
00001336 m161652
00001348 m163252
0000135D exit52
0000150F postD
000015E1 .shifts386FlagsTest
0000182A error
0000182A DefaultExcHandler
0000182F .ring3
00007FFC ESP_REAL
00009000 IDT_SEG_REAL
0000C000 S_SEG_REAL
0000FFFF realmd_mask
0000FFFF off_mask
000100FF off_value
0001FFFF off_cmp
0FFFA000 rodata_seg
0FFFC400 D1_SEG_REAL
0FFFC600 D2_SEG_REAL
12345678 value
